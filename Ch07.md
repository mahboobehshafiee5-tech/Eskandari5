# ุฌุฒููู ูุนูุงุฑ ฺูุฏโูุณุชูโุง ู ูุนูุงุฑ GPU + CUDA  

ุจุฑ ุงุณุงุณ ุงุณูุงุฏูุง ุฏุฑุณ:  
- Multi-Core Architecture, Part II (Latency/Bandwidth + ISPC) :contentReference[oaicite:0]{index=0}  
- GPU Architecture & CUDA Programming :contentReference[oaicite:1]{index=1}  

ูุฏุฑุณ ุฏุฑุณ: **ุฏฺฉุชุฑ ุงูู ุงุณฺฉูุฏุฑ**  
ุชูู ู ุชุฏูู ุฌุฒูู:

---

## ูุตู ฑ โ ููุฏููโุง ุจุฑ ูุนูุงุฑโูุง ููุงุฒ

### ฑ.ฑ. ฺุฑุง ุจู ูุนูุงุฑโูุง ููุงุฒ ูุงุฒ ุฏุงุฑูุ

ุฏุฑ ุฏููโูุง ฺฏุฐุดุชูุ ูพุดุฑูุช ุนููฺฉุฑุฏ ูพุฑุฏุงุฒูุฏูโูุง ุนูุฏุชุงู ุจุง **ุงูุฒุงุด ูุฑฺฉุงูุณ** (Clock Frequency) ู ุจูุจูุฏ ูุนูุงุฑโูุง ุงุณฺฉุงูุฑ ุชฺฉโูุณุชูโุง ุญุงุตู ูโุดุฏ. ุงูุง:

- ุงูุฒุงุด ูุฑฺฉุงูุณ ุจุด ุงุฒ ุญุฏ ุจุงุนุซ:
  - ูุตุฑู ุชูุงู ุจุณุงุฑ ุจุงูุง
  - ุชููุฏ ฺฏุฑูุง ุฒุงุฏ
  - ูุงุฒ ุจู ุณุณุชูโูุง ุฎูฺฉโฺฉููุฏูู ูพฺุฏูโุชุฑ  
  ูโุดูุฏ.

- ููุงูุฑ ุณุงุฎุช ุชุฑุงุดู (CMOS scaling) ุจู ุฌุง ุฑุณุฏู ฺฉู ุงูุฒุงุด ูุฑฺฉุงูุณ ุฏฺฏุฑ ุจูโุณุงุฏฺฏ ฺฏุฐุดุชู ููฺฉู ูุณุช (ูุญุฏูุฏุช ยซุฏูุงุฑ ุชูุงูยป / Power Wall).

ุฏุฑ ุนู ุญุงูุ ูุงุฒ ุจุฑูุงููโูุง ุจู ุชูุงู ูุญุงุณุจุงุช ุฑูุฒุจูโุฑูุฒ ุจุดุชุฑ ุดุฏู ุงุณุช:

- **ุงุฏฺฏุฑ ุนูู (Deep Learning)**
- **ูพุฑุฏุงุฒุด ุชุตูุฑ ู ูุฏุฆู**
- **ุฑูุฏุฑ ฺฏุฑุงูฺฉ ูุญุธูโุง (Real-time Rendering)**
- **ุดุจูโุณุงุฒโูุง ุนูู ุฏุฑ ููุงุณ ุจุฒุฑฺฏ**
- **ุขูุงูุฒ ุฏุงุฏูโูุง ุนุธู (Big Data)**

ุฑุงูโุญู ุงุตู ุตูุนุช:  
> ุจูโุฌุง ุณุฑุนโุชุฑ ฺฉุฑุฏู ฺฉ ูุณุชูุ ุชุนุฏุงุฏ ูุณุชูโูุง ู ูุงุญุฏูุง ูุญุงุณุจุงุช ููุงุฒ ุฑุง ุงูุฒุงุด ุจุฏู!

ุงุฒ ุงูโุฌุง ุฏู ุฑููุฏ ุงุตู ุดฺฉู ูโฺฏุฑุฏ:

1. **ูพุฑุฏุงุฒูุฏูโูุง ฺูุฏโูุณุชูโุง (Multi-Core CPUs)**  
   - ฺูุฏ ูุณุชูู ุนููู (General-Purpose)  
   - ูุฑ ูุณุชู ูุณุจุชุงู ูพฺุฏูุ ุจุง cacheูุง ุจุฒุฑฺฏุ ูุงุญุฏูุง branch prediction ูู ู...  

2. **ุดุชุงุจโุฏููุฏูโูุง ุฏุงุฏูโูุญูุฑุ ูุฎุตูุตุงู GPUูุง**  
   - ุชุนุฏุงุฏ ุจุณุงุฑ ุฒุงุฏ ูุงุญุฏ ูุญุงุณุจุงุช ุณุงุฏูโุชุฑ  
   - ุทุฑุงุญโุดุฏู ุจุฑุง ุงุฌุฑุง ููโุฒูุงู ฺฉ ุจุฑูุงูู ุฑู ุฏุงุฏูโูุง ุฒุงุฏ (Data Parallelism)


### ฑ.ฒ. ูุฏูโูุง ูุฎุชูู ููุงุฒโุณุงุฒ

ุฏุฑ ุณุทุญ ูููููุ ููุช ุงุฒ ยซูพุฑุฏุงุฒุด ููุงุฒยป ุตุญุจุช ูโฺฉููุ ูุนูููุงู ุจุง ฺูุฏ ูุฏู ูุนุฑูู ููุงุฌู ูโุดูู:

- **ูุฏู ฺูุฏุฑุณูุงู (Multithreading)**  
  ุจุฑูุงูู ุจู ฺูุฏ thread ุชูุณู ูโุดูุฏ ฺฉู ูุฑฺฉุฏุงู ุจุฎุด ุงุฒ ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏููุฏ.

- **ูุฏู ุฏุงุฏูโููุงุฒ (Data Parallel)**  
  ฺฉ ุนููุงุช ฺฉุณุงู ุฑู ุชุนุฏุงุฏ ุฒุงุฏ ุนูุตุฑ ุฏุงุฏู ุงุนูุงู ูโุดูุฏ.  
  ูุซุงู: ุถุฑุจ ุงุณฺฉุงูุฑ ุฏุฑ ฺฉ ุจุฑุฏุงุฑุ ููุชุฑ ฺฉุฑุฏู ุชุตูุฑุ ูุญุงุณุจูู sin ุจุฑุง ฺฉ ุขุฑุงู ุจุฒุฑฺฏ ู...

- **ูุฏู SPMD (Single Program, Multiple Data)**  
  ฺฉ ุจุฑูุงูู (ฺฉุฏ) ููุดุชู ูโุดูุฏุ ุงูุง ููโุฒูุงู ุชูุณุท ฺูุฏ ยซูููููยป (instance) ุฑู ุฏุงุฏูโูุง ูุฎุชูู ุงุฌุฑุง ูโุดูุฏ.  
  ISPC ู CUDA ูุฑ ุฏู ุจู ููุน SPMD ูุณุชูุฏ. :contentReference[oaicite:2]{index=2}

- **ูุฏู SIMD (Single Instruction, Multiple Data)**  
  ฺฉ ุฏุณุชูุฑ ูุงุญุฏ (Instruction) ุจูโุตูุฑุช ุจุฑุฏุงุฑ ุฑู ฺูุฏ ุฏุงุฏู ุงุนูุงู ูโุดูุฏ (ูุงููุฏ ุฏุณุชูุฑูุง AVX ุฑู CPUุ ุง ุงุฌุฑุง warp ุฏุฑ GPU). :contentReference[oaicite:3]{index=3}

ุฏุฑ ุงุฏุงููู ุฌุฒููุ ุฎูุงูู ุฏุฏ:

- ISPC ุฑู CPU ฺฺฏููู SPMD ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ SIMD ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ.
- CUDA ุฑู GPU ฺฺฏููู ฺฉ ูุฏู SPMD ูุจุชู ุจุฑ **thread / block / grid** ุงุฑุงุฆู ูโุฏูุฏ.


### ฑ.ณ. ููุงุณูู ฺฉู CPU ฺูุฏโูุณุชูโุง ู GPU

ุจู ุดฺฉู ุฎู ุฎูุงุตู:

| ูฺฺฏ | CPU ฺูุฏโูุณุชูโุง | GPU ูุฏุฑู |
|-------|------------------|----------|
| ุชุนุฏุงุฏ ูุณุชู | ฺฉู (ูุซูุงู ด ุชุง ถด) | ุฒุงุฏ (ุฏูโูุง SMุ ูุฑ SM ุจุง ุตุฏูุง ALU) |
| ููุน ูุณุชู | ูพฺุฏูุ ูููโููุธูุฑู | ุณุงุฏูโุชุฑุ ุชุฎุตุต ุจุฑุง ูุญุงุณุจุงุช ุฏุงุฏูโููุงุฒ |
| ูุฑฺฉุงูุณ | ูุณุจุชุงู ุจุงูุง | ฺฉู ฺฉูุชุฑุ ูู ููุงุฒโุณุงุฒ ุดุฏุฏ |
| ููุงุณุจ ุจุฑุง | ููุทู ูพฺุฏูุ branch ุฒุงุฏุ ฺฉุงุฑูุง sequence-heavy | ูุญุงุณุจุงุช ุชฺฉุฑุงุฑ ุฑู ุฏุงุฏูู ุฒุงุฏุ ูุซู ูุงุชุฑุณโุถุฑุจุ ฺฉุงููููุดูุ ุดุฏูฺฏ |
| ูพููุง ุจุงูุฏ ุญุงูุธู | ูุนูููุงู ุฏูโูุง GB/s | ุฏุฑ GPUูุง ูุฏุฑู ุชุง ุตุฏูุง GB/s :contentReference[oaicite:4]{index=4} |

ูฺฉุชู ููู ุงู ุงุณุช ฺฉู:

> **GPU ุฌุง CPU ุฑุง ููโฺฏุฑุฏ**ุ ุจูฺฉู ูฺฉูู ุขู ุงุณุช.  
> CPU ุจุฑุง ฺฉูุชุฑูุ ููุทู ูพฺุฏู ู ูุฏุฑุชุ ู GPU ุจุฑุง ฺฉุงุฑูุง ุนุฏุฏ ุนุธู ู ุชฺฉุฑุงุฑ ููุงุณุจโุชุฑ ุงุณุช.

---

## ูุตู ฒ โ ุชุฃุฎุฑ (Latency) ู ูพููุง ุจุงูุฏ (Bandwidth)

ฺฉ ุงุฒ ฺฉูุฏโุชุฑู ููุงูู ฺฉู ุฏุฑ ุงู ุฏุฑุณ ุจุงุฏ ุนููุงู ุฏุฑฺฉ ุดูุฏุ ุชูุงูุช ุจู:

- **Latency (ุชุฃุฎุฑ)**  
- **Bandwidth (ูพููุง ุจุงูุฏ)** :contentReference[oaicite:5]{index=5}  

ุงฺฏุฑ ุงู ุฏู ุฑุง ุฎูุจ ุจููููุ ุจุณุงุฑ ุงุฒ ุฑูุชุงุฑูุง ุนุฌุจ ุณุณุชู ุญุงูุธูุ GPU ู Multi-core ุจุฑุงูุงู ูุงุจูโุฏุฑฺฉ ูโุดูุฏ.

---

### ฒ.ฑ. ุชุนุฑู ุชุฃุฎุฑ (Latency)

**ุชุฃุฎุฑ** = ูุฏุช ุฒูุงู ฺฉู ุทูู ูโฺฉุดุฏ ุชุง ฺฉ ุนููุงุช ูุงุญุฏ ฺฉุงูู ุดูุฏ.

ฺูุฏ ูุซุงู:

- ุฒูุงู ุฑูุชโูุขูุฏ ฺฉ ูุงุดู ุงุฒ ุดูุฑ A ุจู ุดูุฑ B  
- ุฒูุงู ูุงุฒู ุจุฑุง ุฎูุงูุฏู ฺฉ ุฏุงุฏู ุงุฒ ุญุงูุธูู ุงุตู (DRAM)  
- ุฒูุงู ูุงุฒู ุจุฑุง ุงุฌุฑุง ฺฉ ุฏุณุชูุฑ multiply ุฏุฑ ALU  

ุงฺฏุฑ ุจฺฏูู:

- ยซLatency ุฏุณุชุฑุณ ุจู ุญุงูุธู ุงุตู โ ฑฐฐ ูุงููุซุงููยป  
ุนู ฺฉ Load ุงุฒ DRAM ุญุฏูุฏุงู ฑฐฐ ns ุทูู ูโฺฉุดุฏ ุชุง ุฏุงุฏู ุฑุง ุจุฑฺฏุฑุฏุงูุฏ.

---

### ฒ.ฒ. ุชุนุฑู ูพููุง ุจุงูุฏ (Bandwidth)

**ูพููุง ุจุงูุฏ** = ุชุนุฏุงุฏ ูุงุญุฏ ฺฉุงุฑ ฺฉู ูโุชูุงูู ุฏุฑ ฺฉ ุจุงุฒูู ุฒูุงู ูุนู ูพุฑุฏุงุฒุด ุง ููุชูู ฺฉูู.

ูุซุงูโูุง:

- ยซุงู ุจุฒุฑฺฏุฑุงู ูโุชูุงูุฏ ฒฐฐ ูุงุดู ุฏุฑ ุณุงุนุช ุนุจูุฑ ุฏูุฏยป  
- ยซูพููุง ุจุงูุฏ ุญุงูุธู = ฒฐ GB/sยป  
  ุนู ุฏุฑ ูุฑ ุซุงูู ูโุชูุงู ฒฐ ฺฏฺฏุงุจุงุช ุฏุงุฏู ุฑุง ุฌุงุจุฌุง ฺฉุฑุฏ.

ุจู ุนุจุงุฑุช ุฏฺฏุฑ:

> Latency = *ุฒูุงู ุจุฑุง ุชฺฉูู ฺฉ ฺฉุงุฑ*  
> Bandwidth = *ุชุนุฏุงุฏ ฺฉุงุฑูุง ฺฉู ุฏุฑ ูุงุญุฏ ุฒูุงู ูโุชูุงู ุงูุฌุงู ุฏุงุฏ*


---

### ฒ.ณ. ูุซุงู: ุจุฒุฑฺฏุฑุงู ุจู ุณุงูโูุฑุงูุณุณฺฉู ู ุงุณุชูููุฑุฏ

ุฏุฑ ุงุณูุงุฏูุง ูุซุงู ุงุฒ ฺฉ ุจุฒุฑฺฏุฑุงู ุจู San Francisco ู Stanford ุขูุฏู ุงุณุช: :contentReference[oaicite:6]{index=6}  

ูุฑุถ ฺฉูุฏ:

- ูุงุตููู ุฏู ุดูุฑ: ตฐ ฺฉูููุชุฑ  
- ุณุฑุนุช ูุงุดู: ฑฐฐ km/h  
- ููุท ฺฉ ูุงู ูุฌูุฏ ุฏุงุฑุฏ  
- ุฏุฑ ูุฑ ูุญุธู ููุท ฺฉ ูุงุดู ุฑู ุฌุงุฏู ุงุณุชุ ู ุชุง ููุช ุจู ููุตุฏ ูุฑุณุฏูุ ูุงุดู ุจุนุฏ ุงุฌุงุฒูู ุญุฑฺฉุช ูุฏุงุฑุฏ.

ุฏุฑ ุงู ุญุงูุช:

- **Latency** ุญุฑฺฉุช ฺฉ ูุงุดู:
  - ุฒูุงู = ูุงุตูู / ุณุฑุนุช = ตฐ / ฑฐฐ = ฐูซต ุณุงุนุช
- **Throughput (ุชูุฑุจุงู ูุนุงุฏู Bandwidth ุฏุฑ ุงู ูุซุงู):**
  - ุฏุฑ ูุฑ ุณุงุนุช ฒ ูุงุดู ูโุชูุงููุฏ ุฑูุชโูุขูุฏ ฺฉููุฏ  
  (ฺฉ ูุงุดู ุฏุฑ ฐูซต ุณุงุนุชุ ูพุณ ุฏุฑ ฑ ุณุงุนุช = ฒ ูุงุดู)

ุญุงูุง ุงฺฏุฑ:

#### ุฑูุด ฑ โ ุงูุฒุงุด ุณุฑุนุช ูุงุดูโูุง
ุณุฑุนุช ุฑุง ุฏู ุจุฑุงุจุฑ ูโฺฉูู: ฒฐฐ km/h  

- Latency: ูโุดูุฏ ฐูซฒต ุณุงุนุช  
- Throughput: ูุฑ ุณุงุนุช ด ูุงุดู  

#### ุฑูุด ฒ โ ุงูุฒุงุด ุชุนุฏุงุฏ ูุงูโูุง
ุณุฑุนุช ููุงู ฑฐฐ km/h ุจูุงูุฏ ุงูุง ด ูุงู ุจุณุงุฒู:

- Latency ููุงู ฐูซต ุณุงุนุช  
- ุงูุง ูโุชูุงูู ุฏุฑ ูุฑ ุณุงุนุชุ ธ ูุงุดู ุนุจูุฑ ุฏูู (ุงฺฏุฑ ูุฑ ูุงู ูุซู ุญุงูุช ูุจู ุนูู ฺฉูุฏ).

**ูุชุฌูู ููู:**

- ุจุฑุง ฺฉุงูุด Latencyุ ุณุฑุนุช ุฑุง ุจุงูุง ูโุจุฑู.  
- ุจุฑุง ุงูุฒุงุด Bandwidthุ ุชุนุฏุงุฏ ยซูุงูยปูุง ููุงุฒ ุฑุง ุจุดุชุฑ ูโฺฉูู.

ุฏุฑ ูพุฑุฏุงุฒูุฏูโูุง:

- ุงูุฒุงุด ูุฑฺฉุงูุณ (ุง ุจูููโฺฉุฑุฏู pipeline) ุจุดุชุฑ ุฑู **Latency** ุงุซุฑ ูโฺฏุฐุงุฑุฏ.  
- ุงูุฒุงุด ุชุนุฏุงุฏ ูุณุชูโูุงุ ุชุนุฏุงุฏ ALUูุงุ ุชุนุฏุงุฏ ฺฉุงูุงูโูุง ุญุงูุธู ู... ุฑู **Bandwidth** ุงุซุฑ ูโฺฏุฐุงุฑุฏ.

---

### ฒ.ด. ุงุณุชูุงุฏูู ฺฉุงุฑุขูุฏุชุฑ ุงุฒ ุจุฒุฑฺฏุฑุงู: Pipeline

ุฏุฑ ุงุณูุงุฏูุง ุณูุงุฑู ูุทุฑุญ ูโุดูุฏ ฺฉู ูุงุดูโูุง ุฑุง ุจุง ูุงุตููู ฑ ฺฉูููุชุฑ ูพุดุช ุณุฑ ูู ูุงุฑุฏ ุจุฒุฑฺฏุฑุงู ฺฉููุ ูู ุงู ฺฉู ููุชุธุฑ ุจูุงูู ูุฑ ูุงุดู ุชูุงู ูุณุฑ ุฑุง ุจุฑูุฏ ู ุจุฑฺฏุฑุฏุฏ. :contentReference[oaicite:7]{index=7}  

ุจุง ุงู ฺฉุงุฑ:

- Latency *ูุฑ ูุงุดู* ููฺูุงู ุชูุฑุจุงู ฐูซต ุณุงุนุช ุงุณุช.  
- ุงููุง Throughput ุจุณุงุฑ ุจุงูุง ูโุฑูุฏ (ุชุนุฏุงุฏ ุฒุงุฏ ูุงุดู ุฏุฑ ุญุงู ุญุฑฺฉุช ูุณุชูุฏ).

ุงู ุฏููุงู ุดุจู **Pipeline** ุฏุฑ ูุนูุงุฑ ูพุฑุฏุงุฒูุฏู ุงุณุช:

- ฺฉ ุฏุณุชูุฑ ููฺฉู ุงุณุช ุจุฑุง ุชฺฉููุ ูุซูุงู ด ุง ฒฐ ูุฑุญูู (Stage) ุท ฺฉูุฏ.  
- Latency ุงุฌุฑุง ฺฉ ุฏุณุชูุฑ = ูุฌููุน ุฒูุงู ุงู ูุฑุงุญู.  
- ูู ุงฺฏุฑ ูพุฑุฏุงุฒูุฏู ุงุฌุงุฒู ุฏูุฏ ูุฑ ูุฑุญูู ุจูโุทูุฑ ููโุฒูุงู ุฑู ุฏุณุชูุฑูุง ูุฎุชูู ฺฉุงุฑ ฺฉูุฏุ ุฏุฑ ูุฑ ุณฺฉู ูโุชูุงู ฺฉ ูุชุฌูู ุฌุฏุฏ ุชุญูู ุฏุงุฏ โ Throughput ุจุงูุงุ ุญุช ุงฺฏุฑ Latency ฺฉ ุฏุณุชูุฑ ุฒุงุฏ ุจุงุดุฏ.

---

### ฒ.ต. ูุซุงู: ฺฉุงุฑูุง ุฑูุฒูุฑูุ ูุซู ุดุณุชู ูุจุงุณโูุง

ุฏุฑ ุงุณูุงุฏูุง ูุซุงู ุดุณุชู ูุจุงุณโูุง ุขูุฏู ุงุณุช: :contentReference[oaicite:8]{index=8}  

- ุดุณุชู: ดต ุฏููู  
- ุฎุดฺฉโฺฉุฑุฏู: ถฐ ุฏููู  
- ุชุง ฺฉุฑุฏู: ฑต ุฏููู  

ุงฺฏุฑ ุจูโุตูุฑุช ฺฉุงููุงู ุชุฑุชุจ ุนูู ฺฉูู:

1. ูุจุงุณโูุง ุฑุง ุฏุฑ ูุงุดู ูุจุงุณุดู ูโฺฏุฐุงุฑู (ดต ุฏููู)  
2. ุจุนุฏ ุฏุฑ ุฎุดฺฉโฺฉู (ถฐ ุฏููู)  
3. ุจุนุฏ ุชุง ูโฺฉูู (ฑต ุฏููู)  

**Latency ฺฉ ยซุฏูุนู ุดุณุชโูุดูยป = ฒ ุณุงุนุช** (ุชูุฑุจุงู ููุงู ูุซุงู ุงุณูุงุฏ).

ุงฺฏุฑ ููุท ฺฉ ุณุช ูุจุงุณ ู ฺฉ ููุฑ/ฺฉ ูุงุดู ุฏุงุฑูุ ููู ุงุณุช.

ุงูุง ุงฺฏุฑ **ุจุงุฑูุง ูุชุนุฏุฏ ูุจุงุณ** ุฏุงุดุชู ุจุงุดู ู ุจุฎูุงูู ุญุฏ ุงฺฉุซุฑ **Throughput (ุชุนุฏุงุฏ ุจุงุฑ ุฏุฑ ุณุงุนุช)** ุฑุง ุจุงูุง ุจุจุฑูุ ูโุชูุงูู ุขู ุฑุง **Pipeline** ฺฉูู:

- ููุช ุจุงุฑ ุงูู ุฏุฑ ุฎุดฺฉโฺฉู ุงุณุชุ ุจุงุฑ ุฏูู ุฑุง ุฏุฑ ูุงุดู ูโุดูู.  
- ููุช ุจุงุฑ ุฏูู ุฏุฑ ุฎุดฺฉโฺฉู ุงุณุชุ ุจุงุฑ ุณูู ุฑุง ูโุดูู ู ููโุฒูุงู ุจุงุฑ ุงูู ุฑุง ุชุง ูโฺฉูู.

ูุชุฌู:

- Latency ูุฑ ุจุงุฑ ุชูุฑุจุงู ููุงู ุงุณุช.  
- ุงูุง ุฏุฑ ูุฑ ุณุงุนุช ูโุชูุงูู ุชุนุฏุงุฏ ุจุดุชุฑ ุจุงุฑ ูุจุงุณ ุฑุง ุชูุงู ฺฉูู โ Throughput ุจุดุชุฑ.


---

### ฒ.ถ. ูุซุงู: ุฏู ููููู ูุชุตู ุจู ูู (ฺฏููฺฏุงู ูพููุง ุจุงูุฏ)

ุฏุฑ ุงุณูุงุฏูุง ูุซุงู ุงุฒ ุฏู ููููู ุขุจ ุฏุงุฑู: :contentReference[oaicite:9]{index=9}  

- ููููู ุงูู: ุญุฏุงฺฉุซุฑ ฑฐฐ ูุชุฑ/ุซุงูู  
- ููููู ุฏูู: ุญุฏุงฺฉุซุฑ ตฐ ูุชุฑ/ุซุงูู  

ุงฺฏุฑ ุงู ุฏู ุฑุง ุจู ูู ูุตู ฺฉููุ ุญุฏุงฺฉุซุฑ **Flow** ฺูุฏุฑ ุงุณุชุ

> ุญุฏุงฺฉุซุฑ ุฌุฑุงู ฺฉู ุณุณุชู = ฺฉูุชุฑู ุธุฑูุช ุฏุฑ ูุณุฑ  
> ุนู **ตฐ ูุชุฑ/ุซุงูู** (ููููู ุฏูู ฺฏููฺฏุงู ุงุณุช).

ุฏุฑ ุณุณุชูโ ฺฉุงููพูุชุฑ ูุฒ:

- ุงฺฏุฑ ALU ุจุชูุงูุฏ ุฎู ุณุฑุน ุนูู ฺฉูุฏุ ุงูุง ุญุงูุธู ูุชูุงูุฏ ุจูโูููุน ุฏุงุฏู ุฑุง ุจุฑุณุงูุฏุ **ุญุงูุธู ฺฏููฺฏุงู ูโุดูุฏ**.  
- ุงฺฏุฑ ุญุงูุธู ุจุณุงุฑ ูพุฑุณุฑุนุช ุจุงุดุฏุ ุงูุง ูุงุญุฏ ูุญุงุณุจุงุช ฺฉูโุชุนุฏุงุฏ ุจุงุดุฏุ ูุฏุฑุช ุฎุงู ูุญุงุณุจุงุช ฺฏููฺฏุงู ูโุดูุฏ.

ุฏุฑ GPUูุง:

- ุชุนุฏุงุฏ ALUูุง ุจุณุงุฑ ุฒุงุฏ ุงุณุช.  
- ุญุงูุธูโูุง ูพููโุจุงูุฏ (ูุซู HBM2 ุฑู V100) ุงุณุชูุงุฏู ูโุดูุฏ. :contentReference[oaicite:10]{index=10}  
- ุจุง ุงู ุญุงูุ **ุฏุฑ ุจุณุงุฑ ุงุฒ ูุณุงุฆูุ ูููุฒ ูู ูพููุง ุจุงูุฏ ุญุงูุธูุ ูุญุฏูุฏุช ุงุตู ฺฉุงุฑุง ุงุณุช.**


---

### ฒ.ท. ูุซุงู ููู: ุถุฑุจ ุนุถู ุจู ุนุถู ุฏู ุจุฑุฏุงุฑ (Bandwidth-bound ุจูุฏู)

ุฏุฑ ุงุณูุงุฏูุง Multi-coreุ ูุฑุถ ูโุดูุฏ ฺฉุงุฑ ุฏุงุฑู ูุซู: :contentReference[oaicite:11]{index=11}  

> ุจุฑุง ูุฑ i:  
> C[i] = A[i] ร B[i]

ุจุฑุง ูุฑ ุนูุตุฑ:

- Load A[i]  โ ุฎูุงูุฏู ุงุฒ ุญุงูุธู  
- Load B[i]  โ ุฎูุงูุฏู ุงุฒ ุญุงูุธู  
- Compute A[i] ร B[i]  โ ฺฉ ุนูู ุถุฑุจ  
- Store C[i] โ ููุดุชู ุฏุฑ ุญุงูุธู

ุงฺฏุฑ ูุฑุถ ฺฉูู ุงุนุฏุงุฏ float (ด ุจุงุช) ุจุงุดูุฏ:

- ฒ Load (ฒ ร ด = ธ ุจุงุช)  
- ฑ Store (ด ุจุงุช)  
- ูุฌููุน: **ฑฒ ุจุงุช ุชุฑุงูฺฉ ุญุงูุธู** ุจุฑุง ูุฑ ุถุฑุจ ุณุงุฏู.

ุฏุฑ ุงุณูุงุฏูุง ูุดุงู ุฏุงุฏู ูโุดูุฏ ฺฉู:

- ฺฉ GPU ูุซู V100 ูโุชูุงูุฏ ุญุฏูุฏ **ตฑฒฐ ุถุฑุจ float ุฏุฑ ูุฑ ุณฺฉู** ุงูุฌุงู ุฏูุฏ. :contentReference[oaicite:12]{index=12}  
- ุจุฑุง ุงูฺฉู ุชูุงู ุงู ูุงุญุฏูุง ูุญุงุณุจุงุช ููุดู ูุดุบูู ุจุงุดูุฏุ ุจู ูพููุงโุจุงูุฏ ุฏุฑ ุญุฏ **ุฏูโูุง ุชุฑุงุจุงุช ุจุฑ ุซุงูู** ูุงุฒ ุงุณุช.  
- ุงูุง ูุงูุนุงู ูพููุง ุจุงูุฏ ุญุงูุธู ุญุฏูุฏ **นฐฐ GB/s** ุงุณุช. :contentReference[oaicite:13]{index=13}  

ูุชุฌูู ููู:

> ุฏุฑ ุงู ููุน ูุณุฆููุ **ุชูุงู ูุญุงุณุจุงุช GPU ุงุตูุงู ฺฏููฺฏุงู ูุณุช**ุ  
> **ูพููุง ุจุงูุฏ ุญุงูุธู** ฺฏููฺฏุงู ุงุณุช.  
> ุนู GPU ยซูโุชูุงูุฏยป ุฎู ุจุดุชุฑ ูุญุงุณุจู ฺฉูุฏุ ุงูุง ุฏุชุง ฺฉุงู ุจูโูููุน ุจู ุขู ููโุฑุณุฏ.

ุงู ุฑุง ูโฺฏูู:

> ุจุฑูุงูู **Bandwidth-bound** ุงุณุชุ ูู **Compute-bound**.

---

### ฒ.ธ. ุฎูุงุตูู ูุตู ฒ

1. **Latency**: ุฒูุงู ุงูุฌุงู ฺฉ ฺฉุงุฑ ูุงุญุฏ (ูุซู ุณูุฑ ฺฉ ูุงุดู ุง Load ุงุฒ DRAM).  
2. **Bandwidth**: ุชุนุฏุงุฏ ฺฉุงุฑูุง ุงูุฌุงูโุดุฏู ุฏุฑ ูุงุญุฏ ุฒูุงู (ูุงุดู ุฏุฑ ุณุงุนุชุ ุจุงุช ุฏุฑ ุซุงูู).  
3. ุจุง ุงูุฒุงุด ุณุฑุนุช (ูุฑฺฉุงูุณ) ูโุชูุงู Latency ุฑุง ฺฉู ฺฉุฑุฏุ ูู ุจุฑุง ุงูุฒุงุด Bandwidth ุจุงุฏ **ููุงุฒโุณุงุฒ** ุฑุง ุงูุฒุงุด ุฏุงุฏ (ูุงู ุจุดุชุฑุ ูุณุชูโ ุจุดุชุฑุ ฺฉุงูุงู ุญุงูุธูโ ุจุดุชุฑ).  
4. **Pipeline** ูโุชูุงูุฏ Throughput ุฑุง ุจุงูุง ุจุจุฑุฏ ุจุฏูู ุขูฺฉู Latency ูุฑ ฺฉุงุฑ ุฑุง ฺฉุงูุด ุฏูุฏ.  
5. ุฏุฑ ุณุณุชูโูุง ูุฏุฑูุ ุจูโุฎุตูุต GPUูุงุ ุจุณุงุฑ ุงุฒ ุจุฑูุงููโูุง **ุจู ูพููุง ุจุงูุฏ ุญุงูุธู ูุญุฏูุฏ ูุณุชูุฏ**.  
6. ุจุฑุง ููุดุชู ุจุฑูุงููโูุง ฺฉุงุฑุขูุฏ ุฑู Multi-core ู GPUุ ุจุงุฏ:
   - ุฏุงุฏูโูุง ุฑุง ููุดููุฏุงูู ุณุงุฒูุงูโุฏู ฺฉููุ  
   - ุชุนุฏุงุฏ Load/Storeูุง ุฑุง ฺฉุงูุด ุฏููุ  
   - ู **Locality** ุฑุง ุชุง ุญุฏ ููฺฉู ุจุงูุง ุจุจุฑู (ุฏุฑ ูุตูโูุง ุจุนุฏ ููุตูโุชุฑ ุจุฑุฑุณ ูโุดูุฏ).

---


---

# ```markdown

# ูุตู ณ โ ฺุฑุง ูพุฑุฏุงุฒูุฏูโูุง ุฏุฑ ุนูู ฺฉูุชุฑ ุงุฒ ุชูุงู ุชุฆูุฑฺฉุดุงู ฺฉุงุฑ ูโฺฉููุฏุ

ุฏุฑ ุฏู ูุตู ูุจู ููุงูู ยซุชุฃุฎุฑ / Latencyยป ู ยซูพููุง ุจุงูุฏ / Bandwidthยป ุฑุง ูุนุฑู ฺฉุฑุฏู.
ุฏุฑ ุงู ูุตู ูโุฎูุงูู ุจุจูู **ุงู ููุงูู ุฏููุงู ฺฺฏููู ุฑู ุนููฺฉุฑุฏ CPU ู GPU ุงุซุฑ ูโฺฏุฐุงุฑูุฏ**.

ุจุณุงุฑ ุงุฒ ุฏุงูุดุฌูุงู ูฺฉุฑ ูโฺฉููุฏ ุฏูู ฺฉูุฏ ุจุฑูุงููโูุง ุงู ุงุณุช ฺฉู ยซูพุฑุฏุงุฒูุฏูโุดุงู ฺฉูุฏ ุงุณุชยป.
ุงูุง ุญููุช ุงู ุงุณุช ฺฉู **ุงฺฉุซุฑ ูพุฑุฏุงุฒูุฏูโูุง ูุฏุฑู ุจโููุงุช ุณุฑุนโุชุฑ ุงุฒ ุจุฑูุงููโูุง ูุณุชูุฏ**.
ุจู ุนุจุงุฑุช ุฏฺฏุฑ:

> ุฏุฑ ุจุณุงุฑ ุงุฒ ุจุฑูุงููโูุงุ **ูพุฑุฏุงุฒูุฏู ููุชุธุฑ ุญุงูุธู** ุงุณุชุ ูู ุจุฑุนฺฉุณ.

ุจุงุฏ ูุฑุญููโุจูโูุฑุญูู ุงู ููุถูุน ุฑุง ุจูููู.

---

# ณ.ฑ. ุญุงูุธูู ุงุตู ุจุณุงุฑ ฺฉูุฏุชุฑ ุงุฒ ูพุฑุฏุงุฒูุฏู ุงุณุช

ูุฑุถ ฺฉูุฏ ฺฉ ูพุฑุฏุงุฒูุฏูู ณ ฺฏฺฏุงูุฑุชุฒ ุฏุงุฑุฏ.

* ณ ฺฏฺฏุงูุฑุชุฒ ุนู ุชูุฑุจุงู **ณ ููุงุฑุฏ ุณฺฉู ุฏุฑ ุซุงูู**
* ุนู ูุฑ ุณฺฉู โ **ฐูซณ ูุงููุซุงูู**

ุฏุฑ ููุงุจู:

### ุณุฑุนุช ุฏุณุชุฑุณ ุจู DRAM:

* ุจู **ตฐ ุชุง ฑตฐ ูุงููุซุงูู**

ุงู ุนู:

> ุจุฑุง ุขูุฑุฏู ฺฉ ุนุฏุฏ ุงุฒ DRAMุ ูพุฑุฏุงุฒูุฏู ุจุงุฏ ุญุฏูุฏ **ฒฐฐ ุชุง ตฐฐ ุณฺฉู ุตุจุฑ ฺฉูุฏ**.

ุงู ููุงู **Latency ุญุงูุธู** ุงุณุช.

ูู ฺุฑุง ุงู ููุถูุน ููู ุงุณุชุ

ฺูู ูพุฑุฏุงุฒูุฏู ูโุชูุงูุฏ **ุฏุฑ ูุฑ ุณฺฉู** ฺูุฏู ุนููุงุช ุฌูุน/ุถุฑุจ ุงูุฌุงู ุฏูุฏุ ุงูุง ุงฺฏุฑ ุฏุงุฏู ูุงุฒู ูููุฒ ุงุฒ ุญุงูุธู ูุงูุฏู ุจุงุดุฏุ ฺูุ
๐ ูฺโฺฉุงุฑ ููโุชูุงูุฏ ุจฺฉูุฏ.

ุงู ุญุงูุช ุฑุง **Stall (ุงุณุชุง)** ูโฺฏูู.

---

# ณ.ฒ. ูุซุงู ุฏูู ุงุฒ ุงุณูุงุฏูุง: Load + Add + Add

ุฏุฑ ุงุณูุงุฏูุง ูุนูุงุฑ ฺูุฏโูุณุชูโุงุ ูุซุงู ุฏุงุฑู: 

ฺฉ Thread ูุฑุงุฑ ุงุณุช ณ ฺฉุงุฑ ุงูุฌุงู ุฏูุฏ:

1. Load: ุฎูุงูุฏู ถด ุจุงุช ุงุฒ ุญุงูุธู
2. Add: ูุญุงุณุจู X + X
3. Add: ูุญุงุณุจู X + Y

ูพุฑุฏุงุฒูุฏู ูุฑุถ ูุง:

* ูโุชูุงูุฏ **ุฏุฑ ูุฑ ุณฺฉู ฑ ุนูู ุฑุงุถ** ุงูุฌุงู ุฏูุฏ
* ูโุชูุงูุฏ Load ู Add ุฑุง *ููโุฒูุงู* ุตุงุฏุฑ ฺฉูุฏ
* ูพููุง ุจุงูุฏ ุญุงูุธู = **ธ ุจุงุช ุฏุฑ ูุฑ ุณฺฉู**

ุฎูุงุตูู ููู:

* ฺฉ Load = ถด ุจุงุช
* ุญุงูุธู = ธ ุจุงุช/ุณฺฉู โ **ธ ุณฺฉู ุทูู ูโฺฉุดุฏ ุชุง ุฏุงุฏู ุจุฑุณุฏ**
* ูพุฑุฏุงุฒูุฏู ุฏุฑ ุงู ูุฏุช ุจฺฉุงุฑ ุงุณุช โ **Stall**

ุงู ูพุฏุฏู ุจู ูุงู ุฒุฑ ุดูุงุฎุชู ูโุดูุฏ:

> **Memory Bandwidth-bound Execution**
> ุง
> **ูุญุฏูุฏุช ุนููฺฉุฑุฏ ุจูโุฏูู ูุงุชูุงู ุญุงูุธู**

---

# ณ.ณ. ฺุฑุง ุญุงูุธู ููโุชูุงูุฏ ุณุฑุนโุชุฑ ุฏุงุฏู ุฑุง ุชุญูู ุฏูุฏุ

ุญุงูุธูู ุงุตู (DRAM) ุจุง ูุฌูุฏ ูพููุงโุจุงูุฏ ุจุงูุงุ ุจูโุทูุฑ ุฐุงุช:

* ุณุงุฎุชุงุฑ ฺฉูุฏุชุฑ ูุณุจุช ุจู ALU ุฏุงุฑุฏ
* ูุงุตููโุงุด ุงุฒ ูพุฑุฏุงุฒูุฏู ุฒุงุฏ ุงุณุช
* ูุงุฒููุฏ ุงูุฑฺ ู ุดุงุฑฺ/ุฏุดุงุฑฺ ุฎุงุฒูโูุง ูุฒฺฉ ุงุณุช
* ูุญุฏูุฏุชโูุง ูุฒฺฉ ุณุฑุนุช ุงูุชูุงู ุฏุงุฑุฏ

ุงุฒ ุงูโุฑู:

### ูพุฑุฏุงุฒูุฏู: ููุงุฑุฏูุง ุนููุงุช ุฏุฑ ุซุงูู

### ุญุงูุธู: ฺูุฏ ุตุฏ ูููู ุฏุณุชุฑุณ ุฏุฑ ุซุงูู

**ุชูุงุณุจ ูุฏุงุฑูุฏ.**

---

# ณ.ด. ฺฉุดโูุง (Cache) ฺฺฏููู ฺฉูฺฉ ูโฺฉููุฏุ

ุจุฑุง ฺฉุงูุด Latencyุ ฺฉ ุณูุณููโูุฑุงุชุจ ุญุงูุธูโุง ุงุฌุงุฏ ุดุฏู:

| ุณุทุญ  | ุงูุฏุงุฒู          | ุณุฑุนุช       | ููุด                |
| ---- | --------------- | ---------- | ------------------ |
| L1   | ฺูุฏ ุฏู ฺฉููุจุงุช | ุจุณุงุฑ ุณุฑุน | ูฺฏูุฏุงุฑ ุฏุงุฏูู ุฏุงุบ  |
| L2   | ุตุฏูุง KB         | ุณุฑุน       | ูุงูโฺฏุฑ           |
| L3   | ฺูุฏ MB          | ูุชูุณุท      | ุฏุงุฏูโูุง ูุดุชุฑฺฉ     |
| DRAM | ฺูุฏ GB          | ฺฉูุฏ        | ุฐุฎุฑูโุณุงุฒ ุจููุฏูุฏุช |

ุงฺฏุฑ ุฏุงุฏู ุฏุฑ Cache ุจุงุดุฏ (hit):

* Latency ุจุณุงุฑ ฺฉู (ฑโฑฐ ุณฺฉู)

ุงฺฏุฑ ุฏุงุฏู ุฏุฑ Cache ูุจุงุดุฏ (miss):

* Load ุจุงุฏ ุงุฒ DRAM ุจุงุฏ (ฒฐฐโตฐฐ ุณฺฉู)

ุจูุงุจุฑุงู:

> **ุจุฑูุงููโูุง ฺฉู ุญุงูุธูู ุณูุณููโูุฑุงุชุจ ุฑุง ุฏุฑุณุช ุงุณุชูุงุฏู ููโฺฉููุฏ ุจู ุดุฏุช ฺฉูุฏ ุนูู ูโฺฉููุฏ.**

ู GPUูุง ุงู ุฑุง ุดุฏุฏุชุฑ ุญุณ ูโฺฉููุฏุ ฺูู ุญุฌู ุฏุงุฏูู ูพุฑุฏุงุฒุดโุดุงู ุจุณุงุฑ ุฒุงุฏ ุงุณุช.

---

# ณ.ต. ฺุฑุง ุงุฌุฑุง ููุงุฒ ุฒุงุฏ ูุดฺฉู ุฑุง ุชุดุฏุฏ ูโฺฉูุฏุ

ุงฺฏุฑ ุชููุง **ฺฉ** Thread ูุนุงู ุจุงุดุฏ:

* ููู ฺฉ Thread ุจู ุญุงูุธู ุฏุฑุฎูุงุณุช ูโุฏูุฏ โ ุญุงูุธู ุงุญุชูุงูุงู ุฌูุงุจ ูโุฏูุฏ.

ุงูุง:

ุฏุฑ ูพุฑุฏุงุฒูุฏูโูุง ฺูุฏโูุณุชูโุง ุง GPUูุง ฺฉู **ุตุฏูุง ุง ูุฒุงุฑุงู Thread** ูุนุงู ูุณุชูุฏ:

* ุฏุฑุฎูุงุณุชโูุง ููโุฒูุงู ุฒุงุฏ
* ุตู ุฏุณุชุฑุณ ุจู ุญุงูุธู ุจุฒุฑฺฏโุชุฑ
* ูพููุงโุจุงูุฏ ูุญุฏูุฏ
* ุชุฑุงฺฉู ุจุดุชุฑ โ **Stall ุจุดุชุฑ**

ุฏุฑ GPUูุง ูุฒุงุฑุงู Thread ูุนุงู ูุณุชูุฏ ู ฺฏุงู ููููโูุง ุฏุฑุฎูุงุณุช Load/Store ูุฌูุฏ ุฏุงุฑุฏ.
ุงฺฏุฑ ุญุงูุธู ูุชูุงูุฏ ุฏุงุฏู ุฑุง ุจูโูููุน ุจุฑุณุงูุฏ:

> ูุงุญุฏูุง ูุญุงุณุจุงุช (ALUs) ุจฺฉุงุฑ ูโุดููุฏ.
> ุงู ุนู GPU ุจุง ตฐฐฐ ูุณุชู ูุฒ ููุท ยซฺูุฏ ุฏุฑุตุฏยป ฺฉุงุฑุง ุฏุงุฑุฏ.

---

# ณ.ถ. ูุชุฌูู ููู

ุจุฑุง ุงูุฒุงุด ฺฉุงุฑุง ุฏุฑ ุณุณุชูโูุง ููุงุฒุ ุงุจุชุฏุง ุจุงุฏ:

* **Load/Storeูุง ุบุฑุถุฑูุฑ ุฑุง ุญุฐู ฺฉูู**
* **ุฏุงุฏู ุฑุง ุชุง ุฌุง ููฺฉู reuse ฺฉูู**
* **Locality ุฑุง ุจุงูุง ุจุจุฑู**
* **ุจูโุฌุง ุงูฺฉู ุฏุงุฏู ุฒุงุฏ ููุชูู ฺฉููุ ุจุดุชุฑ ูุญุงุณุจู ฺฉูู**

ุฏุฑ ูุตู ุจุนุฏ ุชูุงู ุงู ุงุฏูโูุง ุฑุง ฺฉุงูู ุชูุถุญ ูโุฏูู.

---

# ูุตู ด โ ุจูููโุณุงุฒ ุญุงูุธู: Locality ู Data Reuse

ุงู ูุตู ุดุงุฏ ูููโุชุฑู ูุตู ุจุฑุง ูุฑฺฉุณ ุจุงุดุฏ ฺฉู ูโุฎูุงูุฏ:

* ุจุฑูุงููโูุง ุณุฑุน ุฑู CPU/Multicore ุจููุณุฏ
* ุจุง CUDA ุฑู GPU ฺฉุฏููุณ ฺฉูุฏ
* ุจุง ุญุงูุธูู Cacheุ Shared memory ู ูพููุงโุจุงูุฏ ุณุฑูฺฉุงุฑ ุฏุงุฑุฏ

---

# ด.ฑ. ฺุฑุง ููู Locality ููู ุงุณุชุ

Locality ุนู **ูุฒุฏฺฉ ุฏุฑ ุงุณุชูุงุฏู ุงุฒ ุฏุงุฏูโูุง**. ุงู ูุฒุฏฺฉ ูโุชูุงูุฏ ุฏู ููุน ุจุงุดุฏ:

### โฑ) Locality ุฒูุงู (Temporal Locality)

ุงฺฏุฑ ุจุฑูุงูู **ุฏุงุฏูโุง ุฑุง ฺูุฏ ุจุงุฑ ุจุง ูุงุตููู ุฒูุงู ฺฉู ุงุณุชูุงุฏู ฺฉูุฏ**:

* ุขู ุฏุงุฏู ุงุญุชูุงูุงู ุฏุฑ Cache ุจุงู ูโูุงูุฏ
* ูุฑ ุงุณุชูุงุฏูู ุจุนุฏ ุจุณุงุฑ ุณุฑุน ุฎูุงูุฏ ุจูุฏ.

ูุซุงู ุณุงุฏู:

```c
sum += A[i];
sum += A[i];   // ุงุณุชูุงุฏูู ุฏูุจุงุฑู ุงุฒ ููุงู ุฏุงุฏู
```

### โฒ) Locality ูฺฉุงู (Spatial Locality)

ุงฺฏุฑ ุจุฑูุงูู **ุฏุงุฏูโูุง ูุฌุงูุฑ ุฏุฑ ุญุงูุธู** ุฑุง ุงุณุชูุงุฏู ฺฉูุฏ:

* ูพุฑุฏุงุฒูุฏู ุฎุทโูุง Cache (Cache Lines) ุฑุง ุจุงุฑฺฏุฐุงุฑ ูโฺฉูุฏ
* ู ุฏุงุฏูโูุง ููุณุงู ูุฒ ููุฑุงู ุขู ูุงุฑุฏ Cache ูโุดููุฏ.

ูุซุงู:

```c
for (int i = 0; i < N; i++) {
    process(A[i]);
}
```

ุฏุฑ ุงู ุญูููุ A[i]ุ A[i+1]ุ A[i+2] โฆ ููฺฏ ูพุดุชโุณุฑูู ูุณุชูุฏ.
ุงู ุจุณุงุฑ efficient ุงุณุช.

---

# ด.ฒ. ุงฺฏุฑ Locality ุฑุง ุฑุนุงุช ูฺฉูู ฺู ุงุชูุงู ูโุงูุชุฏุ

ุงฺฏุฑ ฺฉุฏ ุจููุณู ฺฉู:

* ุฏุงุฏูโูุง ุฑุง ุงุฒ ููุงุท ูพุฑุงฺฉูุฏู ุจุฎูุงูุฏ
* ุฏูุจุงุฑูโฺฉุงุฑ ูฺฉูุฏ
* ุฏุงุฏูโูุง ุฑุง ูุจู ุงุฒ reuse ุงุฒ ุฏุณุช ุจุฏูุฏ (evict)

ุขูโููุช:

* Cache Miss ุฒุงุฏ
* ุฏุณุชุฑุณ ุจู DRAM ุฒุงุฏ
* Stall ุฒุงุฏ
* ฺฉุงุฑุง ูพุงู

ุฏููุงู ููุงู ูุดฺฉู ฺฉู ุฏุฑ GPU ุจู ูููุฑ ุฑุฎ ูโุฏูุฏ.

---

# ด.ณ. ูุซุงู ุนุฏุฏ ุณุงุฏู

ูุฑุถ ฺฉูุฏ:

* ูพุฑุฏุงุฒูุฏู ุดูุง ูโุชูุงูุฏ **ฑฐฐ ููุงุฑุฏ ุนููุงุช** ุฏุฑ ุซุงูู ุงูุฌุงู ุฏูุฏ
* ูู ุชููุง **ฒฐ GB/s** ูพููุง ุจุงูุฏ ุญุงูุธู ุฏุงุฑุฏ
* ุดูุง ุจุฑูุงููโุง ุฏุงุฑุฏ ฺฉู ุจุฑุง ูุฑ ุนููุงุช ุจุงุฏ **ธ ุจุงุช** Load ฺฉูุฏ

ุณุคุงู:
ุฏุฑ ุจูุชุฑู ุญุงูุช ฺูุฏุฑ ุนููุงุช ุฏุฑ ุซุงูู ุงูุฌุงู ูโุดูุฏุ

```text
(20 GB/s) / (8 B per operation) = 2.5 billion operations per second
```

ุจุง ุงูฺฉู CPU ูุงุฏุฑ ุงุณุช ฑฐฐ ููุงุฑุฏ ุนูู ุงูุฌุงู ุฏูุฏุ ุญุงูุธู ุงุฌุงุฒู ููโุฏูุฏ ุจุด ุงุฒ **ฒูซตูช ุชูุงู ุชุฆูุฑฺฉ** ุจูโฺฉุงุฑ ฺฏุฑูุชู ุดูุฏ.

ุงู ูุซุงู ูุดุงู ูโุฏูุฏ ฺุฑุง:

> **ุจุดุชุฑ ุจุฑูุงููโูุง Memory-Bound ูุณุชูุฏุ ูู Compute-Bound.**

---

# ด.ด. ุชฺฉูฺฉโูุง ฺฉูุฏ ุจุฑุง ุจูุจูุฏ Locality ู ฺฉุงูุด ูุดุงุฑ ุญุงูุธู

ุงูุฌุง ููุฑุณุช ูููโุชุฑู ุชฺฉูฺฉโูุง ฺฉู ุฏุฑ CPU ู ุญุช GPU ุถุฑูุฑ ูุณุชูุฏ ุฑุง ูโุขูุฑู:

---

### โ ุชฺฉูฺฉ ฑ โ ุงุณุชูุงุฏูู ูุฌุฏุฏ ุงุฒ ุฏุงุฏู (Data Reuse)

ูุฏู:
ูุฑ ุฏุงุฏูโุง ฺฉู Load ฺฉุฑุฏูุ **ุชุง ุฌุง ฺฉู ูโุชูุงูู ฺูุฏ ุจุงุฑ** ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉููุ ูู ุงูฺฉู ุฏูุจุงุฑู Load ฺฉูู.

ูุซุงู:

ุจุฏ:

```c
y = A[i] + B[i];
z = A[i] * 3;    // ุฏูุจุงุฑู Load ฺฉุฑุฏู A[i]
```

ุจูุชุฑ:

```c
float t = A[i];  // ููุท ฺฉ Load
y = t + B[i];
z = t * 3;
```

---

### โ ุชฺฉูฺฉ ฒ โ ูพุฑุฏุงุฒุด ุจููฺฉ (Blocking / Tiling)

ุฏุฑ ุงูฺฏูุฑุชูโูุง ูุงููุฏ ูุงุชุฑุณโุถุฑุจ ุง ฺฉุงููููุดู:

* ุงฺฏุฑ ฺฉู ุฏุงุฏู ุฑุง ฺฉโุฌุง ุงุณุชูุงุฏู ฺฉููุ Cache ุฌูุงุจ ููโุฏูุฏ
* ุงฺฏุฑ ุฏุงุฏู ุฑุง ุจู **Block**ูุง ฺฉูฺฺฉ ุชูุณู ฺฉููุ ูุณุท ฺฉุงุฑ ุงุฒ Cache ุจุฑูู ููโุฑูุฏ

ุงู ุชฺฉูฺฉ ุงุณุงุณ **ุจูููโุณุงุฒ ูพุฑุฏุงุฒุด ุชุตูุฑุ ูุงุชุฑุณโูุงุ CNN ู GPU kernels** ุงุณุช.

---

### โ ุชฺฉูฺฉ ณ โ ุงุฌุชูุงุจ ุงุฒ ุฏุงุฏูโูุง ูพุฑุงฺฉูุฏู

ุฏุณุชุฑุณ ูพุฑุงฺฉูุฏู (ูุซูุงู A[index[i]]) ุจุณุงุฑ ูพุฑูุฒูู ุงุณุชุ ฺูู:

* Cache ููโุชูุงูุฏ ูพุดโุจู ฺฉูุฏ
* Locality ูฺฉุงู ุงุฒ ุจู ูโุฑูุฏ
* DRAM ูุฌุจูุฑ ุงุณุช ูุฏุงู ุชฺฉูโูุง ุฌุฏุฏ ุจุงูุฑุฏ

GPUูุง ุดุฏุฏุงู ูุณุจุช ุจู ุงู ููุถูุน ุญุณุงุณโุงูุฏ.

---

### โ ุชฺฉูฺฉ ด โ ุงูุฒุงุด ูุญุงุณุจูู ุงุถุงู ุจูโุฌุง Load ุจุดุชุฑ

ุงู ุงุตู ููู ุฏุฑ GPU ุงุณุช:

> ุฏุฑ GPUุ ูุญุงุณุจู ุจุณุงุฑ ุงุฑุฒุงูโุชุฑ ุงุฒ Load ุงุณุช.

ุงฺฏุฑ ุงูุชุฎุงุจ ุจู ยซูุญุงุณุจู ุฏูุจุงุฑูู ฺฉ ููุฏุงุฑยป ู ยซLoad ุฏูุจุงุฑูู ุขูยป ุจุงุดุฏุ
GPU ูุนูููุงู ุจูุชุฑ ุงุณุช **ุฏูุจุงุฑู ูุญุงุณุจู ฺฉูุฏ**.

---

# ด.ต. ฺุฑุง GPUูุง ุจู Locality ุดุฏุฏุงู ูุงุจุณุชูโุงูุฏุ

ุงุฒ ุงุณูุงุฏูุง: ุญุงูุธูู GPU ูพููุง ุจุงูุฏ ุจุณุงุฑ ุจุงูุง ุฏุงุฑุฏุ ูุซูุงู:

* HBM2 ุฏุฑ NVIDIA V100 = ุญุฏูุฏ **นฐฐ GB/s** 

ุงูุง:

* GPU ูุฒุงุฑุงู Thread ุฏุงุฑุฏ
* ูููู Threadูุง ุฏุงุฆูุงู Load/Store ูโุฒููุฏ
* ุงฺฏุฑ Locality ุถุนู ุจุงุดุฏุ ุญุช นฐฐ GB/s ูู ฺฉุงู ูุณุช

ุฏุฑ ูุชุฌู:

### ุงฺฏุฑ Locality ุฎูุจ ุจุงุดุฏ:

* GPU ุณุฑุน ูโุดูุฏ
* ALUูุง ููุดู ูพุฑฺฉุงุฑ ูุณุชูุฏ

### ุงฺฏุฑ Locality ุจุฏ ุจุงุดุฏ:

* GPU ุจฺฉุงุฑ ูโุดูุฏ
* ALUูุง ุตุจุฑ ูโฺฉููุฏ
* ุญุงูุธู ฺฏููฺฏุงู ูโุดูุฏ

ุฏุฑ ูุตูโูุง CUDA ุฏููุงู ูโุจูู ฺฺฏููู Shared Memory ุงู ูุดฺฉู ุฑุง ุญู ูโฺฉูุฏ.

---

# ด.ถ. ุฌูุนโุจูุฏ ูุตู ด

1. Locality ูููโุชุฑู ุงุตู ุทุฑุงุญ ุงูฺฏูุฑุชูโูุง ุณุฑุน ุงุณุช.
2. ุงุบูุจ ุจุฑูุงููโูุง Memory-Bound ูุณุชูุฏุ ูู Compute-Bound.
3. ุจุง ุฑุนุงุช Locality:

   * ูโุชูุงูู ุงุฒ Cache ุจูุชุฑ ุงุณุชูุงุฏู ฺฉูู
   * ูพููุงโุจุงูุฏ ุฑุง ุญูุธ ฺฉูู
   * Stallูุง ุฑุง ฺฉุงูุด ุฏูู
   * GPU/CPU ุฑุง ุจุง ุธุฑูุช ูุฒุฏฺฉ ุจู ุญุฏุงฺฉุซุฑ ุงุฌุฑุง ฺฉูู
4. ูพุฑุฏุงุฒูุฏูู ุณุฑุน ุจุฏูู ุฏุงุฏูู ุณุฑุน = **ฺฉุงููุงู ุจโูุงุฏู**
   (ูุซู ุงูฺฉู ุฑุงููุฏู ูุฑุงุฑ ุฏุงุฑุฏ ูู ุฎุงุจุงู ููุท ฑ ูุงู ุฏุงุฑุฏ!)
5. GPUูุง ุจู Locality ุดุฏุฏุงู ุญุณุงุณโุงูุฏุ CUDA ุงุจุฒุงุฑูุง ูุฑุงูุงู ุจุฑุง ฺฉูุชุฑู ุขู ุฏุงุฑุฏ.

---



---

# ```markdown

# ูุตู ต โ ISPC ู ูุฏู ุจุฑูุงููโููุณ SPMD ุฑู CPU

ุงู ูุตู ุจู ุฒุจุงู ุจุณุงุฑ ุณุงุฏู ู ุงุฒ ูพุงู ุชูุถุญ ูโุฏูุฏ ฺฉู:

* ISPC ฺุณุช ู ฺุฑุง ุณุงุฎุชู ุดุฏูุ
* ุชูุงูุช SPMD ุจุง SIMD ฺุณุชุ
* programCount ู programIndex ุนู ฺูุ
* ISPC ฺฺฏููู ุฑู CPU ฺฉุงุฑ ูโฺฉูุฏุ
* ฺุฑุง ุงุฌุฑุง ุขู ุจุณุงุฑ ุดุจู CUDA ุฑู GPU ุงุณุชุ
* ู ฺุทูุฑ ุจุงุฏ ูุซู ฺฉ ฺฉุงุฑุดูุงุณุ ฺฉุฏ ISPC ุฑุง ุชุญูู ฺฉููุ

---

# ต.ฑ. ูุดฺฉู ุงุตู CPUูุง: SIMD ูุณุชุ ูู ุงุณุชูุงุฏู ุงุฒ ุขู ุณุฎุช ุงุณุช

ุงฺฉุซุฑ CPUูุง ูุฏุฑู ุฏุงุฑุง ูุฌููุนูโุฏุณุชูุฑูุง ุจุฑุฏุงุฑ (SIMD) ูุณุชูุฏ:

* SSE
* AVX
* AVX2
* AVX-512
  ู โฆ

ุงู ุฏุณุชูุฑูุง ูโุชูุงููุฏ ฺฉ ุนููุงุช ุฑุง ุฑู 4ุ 8ุ ุง 16 ุนูุตุฑ ููุฒูุงู ุงูุฌุงู ุฏููุฏ.

ูุซูุงู ุฏุณุชูุฑ AVX:

```
_mm256_add_ps(a, b)
```

ูโุชูุงูุฏ **ธ ุนุฏุฏ float** ุฑุง ุฏุฑ ฺฉ ุฏุณุชูุฑ ุฌูุน ฺฉูุฏ.

### ูุดฺฉู:

ุงุณุชูุงุฏูู ูุณุชูู ุงุฒ ุงู ุฏุณุชูุฑูุง **ุฏุดูุงุฑ** ุงุณุช:

* ูุงุฒ ุจู Intrinsics
* ฺฉุฏ ูพฺุฏู ู ุบุฑ ูุงุจูโุฎูุงูุฏู
* ูุงุฒ ุจู ูุฏุฑุช ุฏูู Masking ุฏุฑ ุดุฑุงุท if
* ุชุฑุงุฒุจูุฏ ุญุงูุธู (Alignment)
  ูโฆ

ุฏุฑ ูุชุฌูุ ุจุณุงุฑ ุงุฒ ุจุฑูุงููโููุณุงู ุงุฒ SIMD ุงุณุชูุงุฏู ููโฺฉููุฏ โ CPU ุจุฎุด ุจุฒุฑฺฏ ุงุฒ ุชูุงู ุฎูุฏ ุฑุง ุจโุงุณุชูุงุฏู ุฑูุง ูโฺฉูุฏ.

---

# ต.ฒ. ISPC ฺุณุช ู ฺู ูุดฺฉู ุฑุง ุญู ูโฺฉูุฏุ

ISPC ุนู:

> **Intel SPMD Program Compiler**

* ูุฎุตูุต **ุจุฑูุงููโููุณ ุฏุงุฏูโููุงุฒ** ุฑู CPU
* ุฒุจุงูุด ุดุจู C
* ุงุฒ ูุฏู SPMD ุงุณุชูุงุฏู ูโฺฉูุฏ
* ูู ุฎุฑูุฌ ุขู **ฺฉุฏ SIMD** ุงุณุช

ูฺฉุชูู ููู:

> ุดูุง ุจุฑูุงูู ุฑุง ุทูุฑ ูโููุณุฏ ฺฉู ุงูฺฏุงุฑ ุจุฑุง ฺูุฏ Thread ูุณุชูู ุงุณุช (SPMD)
> ูู ISPC ุขู ุฑุง ุชุจุฏู ูโฺฉูุฏ ุจู ฺฉ ุงุฌุฑุง ุจุฑุฏุงุฑ (SIMD)

ุงู ุฏููุง ููุงู ฺฉุงุฑ ุงุณุช ฺฉู CUDA ุจุฑุง GPU ุงูุฌุงู ูโุฏูุฏ.

---

# ต.ณ. SPMD ฺุณุชุ (ุจู ุฒุจุงู ุจุณุงุฑ ุณุงุฏู)

SPMD = Single Program, Multiple Data

ุนู:

* ฺฉ ุจุฑูุงูู ูโููุณ
* ูู ุงู ุจุฑูุงูู ฺูุฏ ุจุงุฑ (ุจุง ูุฑูุฏ ูุชูุงูุช) **ููุฒูุงู** ุงุฌุฑุง ูโุดูุฏ

ูุซู:

```c
foreach (i = 0 ... N) {
    y[i] = f(x[i]);
}
```

ุฏุฑ ุงูุฌุง ฑฐุ ฑฐฐ ุง ฑฐฐฐ ูุณุฎู ุงุฒ ุงู ุชุงุจุน ููุฒูุงู ุงุฌุฑุง ูโุดูุฏ.

ุฏุฑ ISPCุ ุงู ูุณุฎูโูุง ุฑุง **program instances** ูโูุงูู.

---

# ต.ด. programCount ู programIndex ฺู ูุณุชูุฏุ

ุฏุฑ ISPCุ ููุช ฺฉ ุชุงุจุน ุฑุง ุงุฌุฑุง ูโฺฉูุฏ:

* ISPC **ฺฉ "gang" (ฺฏุฑูู)** ุงุฒ *program instance*ูุง ูโุณุงุฒุฏ
* ุชุนุฏุงุฏ instanceูุง ุจุฑุงุจุฑ ุงุณุช ุจุง **ุนุฑุถ SIMD** CPU

ูุซูุงู:

* AVX2 = 8 ุนุฏุฏ float ููุฒูุงู โ programCount = 8
* AVX-512 = 16 ุนุฏุฏ float ููุฒูุงู โ programCount = 16

ุงู ููุฏุงุฑ **ุฏุฑ ุฒูุงู ุงุฌุฑุง ุซุงุจุช ุงุณุช**.

### โ programCount

ุชุนุฏุงุฏ ุจุฑูุงููโูุง ฺฉู ููุฒูุงู ุงุฌุฑุง ูโุดููุฏ
(ูุซู ุงูุฏุงุฒูู Warp ุฏุฑ CUDA)

### โ programIndex

ุดูุงุฑูู ูุฑ instance (ฐ ุชุง programCount-1)

ุงฺฏุฑ programCount = 8:

| programIndex | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
| ------------ | - | - | - | - | - | - | - | - |

ูุฑฺฉุฏุงู ุงุฒ ุงูโูุง ฺฉ ูุณุฑ ุงุฌุฑุง ุฏุงุฑุฏุ ูู ููู ุจุง ูู ุงุฌุฑุง ูโุดููุฏ (ุจู ุตูุฑุช SIMD).

ุงู ุฏููุงู ุดุจู **warp** ุฏุฑ GPU ุงุณุชุ ููุท ุฑู CPU.

---

# ต.ต. ูุซุงู ุณุงุฏู: ูุญุงุณุจูู sin(x) ุจุฑุง ฺฉ ุขุฑุงู

ุฏุฑ ุงุณูุงุฏูุง ุชุงุจุน ุณุงุฏูโุง ุจุฑุง ูุญุงุณุจูู sin ุจุง ุณุฑ ุชููุฑ ุขูุฏู ุงุณุช.
ูุณุฎูู C++:

```cpp
for (int i = 0; i < N; i++) {
    float value = x[i];
    ...
    result[i] = value;
}
```

ูุณุฎูู ISPC:

```cpp
foreach (i = 0 ... N) {
    float value = x[i];
    ...
    result[i] = value;
}
```

ุจู ูุธุฑ ุณุงุฏู ุงุณุชุ ุงูุง ุงุชูุงู ููู ูพุดุช ูพุฑุฏู ุฑุฎ ูโุฏูุฏ:

### โ ุฏุฑ C++

ุญููู *ุจูโุตูุฑุช ุชุฑุชุจ* ุงุฌุฑุง ูโุดูุฏุ ูฺฏุฑ ฺฉุงููพุงูุฑ ุฎูุฏุด vectorize ฺฉูุฏ (ฺฉู ููุดู ูููู ูุณุช).

### โ ุฏุฑ ISPC

ุญููู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุชูุณู ูโุดูุฏ ูุงู program instances:

* ุงฺฏุฑ programCount = 8
* ุฏุฑ ูุฑ iteration ุงุฒ ุญูููู ุงุตูุ 8 ุนูุตุฑ ูพุฑุฏุงุฒุด ูโุดูุฏ

ูุซู CUDAุ ุฏุงุฏูโูุง **ุจู threadูุง (program instances)** ุชูุณู ูโุดูุฏ.

---

# ต.ถ. ุฑูุด ุชูุณู ฺฉุงุฑ: Interleaved vs Blocked

ISPC ูโุชูุงูุฏ ุฏู ุดูู ุจุฑุง ุชูุฒุน ุฏุงุฏูโูุง ุจู program instances ุงุณุชูุงุฏู ฺฉูุฏ.

## โฑ) Interleaved (ูพุดโูุฑุถ)

ุงูฺฏู:

* instance 0 โ i = 0, 8, 16, 24 โฆ
* instance 1 โ i = 1, 9, 17, 25 โฆ
* instance 2 โ i = 2, 10, 18, 26 โฆ
  ูโฆ

ุงู ุงูฺฏู **ุจุฑุง SIMD ุนุงู ุงุณุช** ฺูู ุฏุงุฏูโูุง ูพุดุชโุณุฑูู ูุณุชูุฏ
โ ฺฉ ุฏุณุชูุฑ ูุงุญุฏ ุจูโูุงู vector load ฺฉุงู ุงุณุช.

(ุงุณูุงุฏ 39โ40) 

---

## โฒ) Blocked

ุฏุฑ ุงู ุญุงูุช:

* ูุฑ instance ฺฉ ุจูุงฺฉ ุจุฒุฑฺฏ ูพุดุชโุณุฑูู ุงุฒ ุฏุงุฏูโูุง ูโฺฏุฑุฏ:

  * instance 0 โ 0 ุชุง N/8
  * instance 1 โ N/8 ุชุง 2N/8
  * โฆ

ุงูฺฏู ููุงุณุจ ุจุฑุง cache locality ุงุณุชุ
ุงูุง ฺูู ุฏุงุฏูโูุง ุจูโุตูุฑุช ุฌุฏุฏ ุชูุณู ุดุฏูโุงูุฏุ ุจุนุถ loadูุง ูุงุฒ ุจู **gather** ุฏุงุฑูุฏ
โ ฺฉู ุฏุฑ SIMD ุจุณุงุฑ ฺฉูุฏ ุงุณุช.

(ุงุณูุงุฏ 41) 

---

# ต.ท. foreach ฺฉ abstraction ุงุณุชุ ูู implementation

ISPC ูุงููุฏ CUDA ฺฉ ยซุงูุชุฒุงุนยป ุชุนุฑู ูโฺฉูุฏ:

```cpp
foreach (i = 0 ... N) {
    // ฺฉุงุฑ ูุณุชูู ุฑู ูุฑ ุนูุตุฑ
}
```

ูุนู ุงู ุงุณุช:

> ยซูู ุจูโุนููุงู ุจุฑูุงููโููุณ ููุท ูโุฎูุงูู ุงู ุญููู ุฑุง ููุงุฒ ฺฉููุ
> ุชุตูู ุงูฺฉู ุงู iterations ฺฺฏููู ุจู program instances ุฏุงุฏู ุดูุฏุ
> ุจุฑุนูุฏูู ฺฉุงููพุงูุฑ ุงุณุช.ยป

ุฏุฑ CUDA ูู ุฏููุงู ููู ุงุณุชุ ููุท ุฏุฑ ุขูุฌุง abstraction ุจู ุดฺฉู:

```
gridDim, blockDim, threadIdx
```

ููุงุด ุฏุงุฏู ูโุดูุฏ.

---

# ต.ธ. ูุดฺฉู ฺฉุฏูุง ูุงุฏุฑุณุช (Race conditions)

ISPC ูุซู CUDA ูุดุฏุงุฑ ููโุฏูุฏ ฺฉู:

```cpp
if (i >= 1 && x[i] < 0)
    y[i-1] = x[i];
else
    y[i] = x[i];
```

ููฺฉู ุงุณุช **ุฏู instance ุฑู ฺฉ ุฎุงููู y ุจููุณูุฏ**.
ุฏุฑ ุงุณูุงุฏูุง ุขูุฏู ุงุณุช:

> ุฎุฑูุฌ ุงู ุจุฑูุงูู **ุชุนุฑู ูุดุฏู** ุงุณุช. 

ฺูู SPMD โ ุชุถูู memory safety.

ุจุฑูุงููโููุณ ุจุงุฏ ุฎูุฏุด ูุฑุงูุจ ุจุงุดุฏ.

ุงู ููุถูุน ฺฉ ุงุฒ ุจุฒุฑฺฏโุชุฑู ูุดฺฉูุงุช ฺฉุฏูุง ููุงุฒ ุงุณุช.

---

# ต.น. ุนููุงุช Cross-instance (ูุซู reduce_add)

ุฏุฑ ISPC ุจุฑูุงููโููุณ ูโุชูุงูุฏ ุฏุงุฏูโูุง ุฑุง ุจู instances ููุชูู ฺฉูุฏ:
(ูุดุงุจู Warp Primitives ุฏุฑ CUDA)

* reduce_add
* reduce_min
* broadcast
* shuffle / rotate

ูุซูุงู ุฌูุน ฺฉู ุขุฑุงู:

```cpp
float partial = 0;
foreach(i = 0..N) {
    partial += x[i];
}
float result = reduce_add(partial);
```

ุฏุฑ ุงูุฌุง:

* ูุฑ instance ฺฉ partial sum ุชููุฏ ูโฺฉูุฏ
* reduce_add ููู ุฑุง ุฌูุน ูโฺฉูุฏ
* ุฎุฑูุฌ ฺฉ ููุฏุงุฑ uniform ุงุณุช (ูุดุชุฑฺฉ ุจู ุจุฑูุงููโูุง)

ุงู ุฏููุงู ูุดุงุจู:

* CUDA warp shuffle
* ู AVX horizontal add

ุงุณุช.

(ุงุณูุงุฏ 47โ48) 

---

# ต.ฑฐ. ุชูุงูุช ISPC ุจุง CUDA

| ููููู              | ISPC                        | CUDA                           |
| ------------------ | --------------------------- | ------------------------------ |
| Platform           | CPU                         | GPU                            |
| mapping            | SIMD                        | SIMT                           |
| program instance   | thread                      | CUDA thread                    |
| gang               | thread block (ุงุฒ ูุธุฑ ููุณู) | warpุ (ุงุฒ ูุธุฑ ูพุงุฏูโุณุงุฒ)      |
| memory model       | ููุท RAM/Cache               | global/local/shared/texture    |
| cross-instance ops | reduce_add, rotate          | warp shuffle, intrinsics       |
| ุนููฺฉุฑุฏ             | ูุญุฏูุฏ ุจู ูพููุง ุจุงูุฏ CPU     | ุจุณุงุฑ ููุงุฒุ ูุงูุชโูุฒุงุฑ thread |

ูููโุชุฑู ูฺฉุชู:

> ISPC ุจุฑูุงููโููุณ GPU-style ุฑุง ุจู CPU ูโุขูุฑุฏ.

---

# ต.ฑฑ. ุฎูุงุตูู ูุตู ต

1. ISPC ุฑุงู ุณุงุฏู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ SIMD CPU ุงุณุช.
2. model ุงุฌุฑุง ุขู SPMD ุงุณุช: ฺูุฏ instance ููุฒูุงู ฺฉ ุจุฑูุงูู ุฑุง ุงุฌุฑุง ูโฺฉููุฏ.
3. programIndex ู programCount ูุดุงุจู warp/threadIndex ุฏุฑ CUDA ูุณุชูุฏ.
4. foreach abstraction ุงุณุชุ ฺฉุงููพุงูุฑ ุชุตูู ูโฺฏุฑุฏ iterations ฺฺฏููู ุชูุฒุน ุดูุฏ.
5. ุจุงุฏ ูุฑุงูุจ race conditionูุง ุจูุฏ.
6. reduce_add ู ุณุงุฑ ุนููฺฉุฑุฏูุง cross-instance ุดุจู warp operations ูุณุชูุฏ.
7. ISPC ูพู ูุงู ูพุฑุฏุงุฒูุฏูู ฺูุฏโูุณุชูโุง ู ุณุจฺฉ GPU-style ุจุฑูุงููโููุณ ุงุณุช.

---

# ูุตู ถ โ GPUูุง ฺฺฏููู ุงุฒ ูพุฑุฏุงุฒูุฏูู ฺฏุฑุงูฺฉ ุจู ุงุจุฑุฑุงุงูู ุชุจุฏู ุดุฏูุฏุ

ุงู ูุตู ฺฉ ุงุฒ ูููโุชุฑู ูุตูโูุง ุงุณุช.
ุฏุฑ ุงูโุฌุง ฺฉ ุฏุงุณุชุงู ฒฐ ุณุงูู ุฑุง ุฎู ุณุงุฏู ุชุนุฑู ูโฺฉูู:

**ฺฺฏููู GPUูุง ุงุฒ ฺฉ ุชุฑุงุดูู ูุฎุตูุต ุจุงุฒุ ุชุจุฏู ุดุฏูุฏ ุจู ุงุตูโุชุฑู ุงุจุฒุงุฑ ุนูู ู ูููุฏุณุ**

---

# ถ.ฑ. GPU ุงุตูุงู ุจุฑุง ฺู ุณุงุฎุชู ุดุฏู ุจูุฏุ

ุงูุงู ุฏููู ฒฐฐฐ:

GPU = ฺฉุงุฑุช ฺฏุฑุงูฺฉ ุจุงุฒ

* ูุฃููุฑุช: ุงุฌุฑุง ุจุงุฒโูุงุ ุฑูุฏุฑ ุชุตุงูุฑ ุณูโุจุนุฏุ ุณุงูโุฒูุ ููุฑูพุฑุฏุงุฒโฆ
* ุณุงุฎุชุงุฑ: pipeline ฺฏุฑุงูฺฉ
* ููุน workload: ุฏุงุฏูโููุงุฒ ุดุฏุฏ
  (ุฏุฑ ูุฑ ูุฑู ููููโูุง ูพฺฉุณู ู ูุซูุซ ุจุงุฏ ูพุฑุฏุงุฒุด ุดูุฏ)

ุฏุฑ ุงุณูุงุฏูุง ุงุฏูู ุฑูุฏุฑ ุณูโุจุนุฏ ุขูุฏู ุงุณุช:
(ูุซู ุดุฏุฑ fragment) 

GPUูุง ุจุฑุง ุงู ฺฉุงุฑ ุนุงู ุจูุฏูุฏ ฺูู:

* ุจุฑุง ูุฑ ูพฺฉุณู ฺฉ ูุญุงุณุจูู ูุดุงุจู ุงูุฌุงู ูโุดุฏ
* Shaderูุง pure function ุจูุฏูุฏ
  (= ุจุฏูู ุญุงูุช ูุดุชุฑฺฉุ ุจุฏูู Mutable State)
* ุฏุงุฏูู ูพฺฉุณูโูุง ูุณุชูู ุจูุฏ

ุงู ููุงู **Data Parallelism ุฎุงูุต** ุงุณุช.

---

# ถ.ฒ. ุฏุฑฺฉ workload ฺฏุฑุงูฺฉ ููู ุงุณุช ฺููโฆ

GPU ุงุฒ ุงุจุชุฏุง ูุฎุตูุต workloadูุง ุทุฑุงุญ ุดุฏู ุจูุฏ ฺฉู:

* branch ฺฉู ุฏุงุฑูุฏ
* ุนููุงุช ุณุงุฏู ู ุชฺฉุฑุงุฑ ุฑู ุฏุงุฏู ุฒุงุฏ ุงูุฌุงู ูโุดูุฏ
* ุฏุงุฏูโูุง ุณุงุฎุชุงุฑุงูุชู ูุณุชูุฏ
* ุญุงูุธู ุจูโุตูุฑุช streaming ุงุณุชูุงุฏู ูโุดูุฏ
* parallelism ุจุณุงุฑ ุฒุงุฏ ุงุณุช
* ูุฑ ูุงุญุฏ ฺฉุงุฑ ฺฉูฺฺฉ ู ูุณุชูู ุงุณุช

ุงู ูฺฺฏโูุง GPU ุฑุง ุชุจุฏู ูโฺฉูุฏ ุจู ฺฉ **ูุงุดู ูุญุงุณุจุงุช ููุงุฑุฏ-ุฏุฑ-ุซุงูู**.

ุจูุงุจุฑุงู GPU ุชููุง ุจุฑุง ฺฏุฑุงูฺฉ ุฎูุจ ูุณุชุ
ุจูฺฉู ุจุฑุง ูุฑ **ุงูฺฏูุฑุชู ุนูู ุฏุงุฏูโูุญูุฑ** ุฎูุจ ุงุณุช:

* ูุงุชุฑุณโุถุฑุจ
* ฺฉุงููููุดู
* ุญู ูุนุงุฏูุงุช
* ูุงุดู ูุฑููฺฏ
* Ray tracing
* ุดุจูโุณุงุฒ ูููฺฉูู

---

# ถ.ณ. ฺฉุดู ุจุฒุฑฺฏ (ุญุฏูุฏ ุณุงู ฒฐฐ2โ2004): GPU = ุงุจุฑุฑุงุงูู

ุฏุฑ ุงูุงู ุฏููู ฒฐฐฐ ูุญููู ูุชูุฌู ุดุฏูุฏ ฺฉู:

> ุงฺฏุฑ ุจุชูุงูู GPU ุฑุง ูุฌุจูุฑ ฺฉูู ฺฉ ุชุงุจุน ุฏูุฎูุงู ุฑุง ุงุฌุฑุง ฺฉูุฏุ
> ูโุชูุงูู ุงุฒ ุขู ุจุฑุง ูุญุงุณุจุงุช ุนูู ุงุณุชูุงุฏู ฺฉูู.

ูุซูุงู:

* ฺฉ ุชุตูุฑ ุจุง ุงูุฏุงุฒู 512ร512 ุชูู ูโฺฉูู
* ุฏู ูุซูุซ ุฑู ฺฉู ุชุตูุฑ ุฑุณู ูโฺฉูู
* ฺฉ shader ุณุงุฏู ูโููุณู ฺฉู f(x) ุฑุง ุจุฑุง ูุฑ ูพฺฉุณู ุญุณุงุจ ฺฉูุฏ
* ุฎุฑูุฌ ุชุตูุฑ = ุฎุฑูุฌ ูุญุงุณุจู!

ุงู ุงุฏู ุจู ูุงู:

> **GPGPU**
> (General Purpose GPU)

ูุนุฑูู ุดุฏ.

ุฏุฑ ุงุณูุงุฏูุง ูููููโูุง ุงุฒ ูพฺููุดโูุง 2002โ2003 ุขูุฏู:


---

# ถ.ด. ูุญุฏูุฏุชโูุง ุฌุฏ GPGPU ุงููู

ุฏุฑ ุงู ุฏูุฑุงู GPU:

* ููุท ูโุชูุงูุณุช shader ุงุฌุฑุง ฺฉูุฏ
* ููโุชูุงูุณุช ุญูููู ุฏูุฎูุงู ุง pointer ุฏุงุดุชู ุจุงุดุฏ
* ุณุงุฎุชุงุฑ pipeline ฺฉโุทุฑูู ุจูุฏ
* ุจุงุฏ ูููโฺุฒ ุฑุง ุจู ุตูุฑุช ุจุงูุช (texture) ูุฏู ูโฺฉุฑุฏุฏ
* ูุฑูุฏ ู ุฎุฑูุฌ shader ุงุฌุจุงุฑ ุจูุฏ
* ฺฉูุชุฑู ฺฉู ุจุฑ ุญุงูุธู ุฏุงุดุชุฏ
* ูฺ ุงูฺฏู ูุซู thread/block ูุฌูุฏ ูุฏุงุดุช

ุจูโุทูุฑ ุฎูุงุตู:

> GPU ุณุฑุน ุจูุฏุ ุงูุง ุชูุฑุจุงู ุงุณุชูุงุฏู ุงุฒ ุขู ุจุฑุง ฺฉุงุฑูุง ุนูู ุบุฑููฺฉู ุจูุฏ.

---

# ถ.ต. ุงุฑุงุฆูู ุฒุจุงู Brook ุฏุฑ ุณุงู ฒฐฐด โ ุงููู ูุฏู ุจู ุณูุช CUDA

Brook (ุณุงุฎุชูู Stanford ู ูุญููู ฺฏุฑุงูฺฉ) ฺฉ ุงุฏูู ุงูููุงุจ ุฏุงุดุช:

* GPU ุฑุง ุจู ุดฺฉู ฺฉ **stream processor** ุจุจูู
* ุขูพุฑุงุชูุฑูุง stream ูุซู mapุ reduceุ scatterุ gather ุชุนุฑู ฺฉูู
* Shaderูุง ุฑุง ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุชููุฏ ฺฉูู

ูุซุงู Brook ุงุฒ ุงุณูุงุฏูุง: 

```cpp
kernel void scale(float amount, float a<>, out float b<>) {
    b = amount * a;
}
```

ุฎุฑูุฌ Brook:

* ุจู ุฒุจุงู shader ุชุจุฏู ูโุดูุฏ
* ุณูพุณ GPU ุขู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ

Brook ุงููู ุจุงุฑ:

* ฺฉ ูุฏู SPMD ุจุฑุง GPU ูุนุฑู ฺฉุฑุฏ
* ฺฉุงุฑ GPU ุฑุง ุงุฒ ฺฏุฑุงูฺฉ ุฌุฏุง ฺฉุฑุฏ
* ุฑุงู ุฑุง ุจุฑุง CUDA ุจุงุฒ ฺฉุฑุฏ

ุงูุง ูููุฒ ูุญุฏูุฏุชโูุง shader ุจุงู ุจูุฏ.

---

# ถ.ถ. ุณุงู ฒฐฐท: ุฒูุฒููู CUDA

NVIDIA ูพุฑุฏุงุฒูุฏูู **Tesla** ุฑุง ูุนุฑู ฺฉุฑุฏ:

* GPU ุฏุงุฑุง ุญุงูุช **Compute Mode**
* ุฏุฑ ุงู ุญุงูุชุ GPU ุฏฺฏุฑ ฺฉ ฺฏุฑุงูฺฉโูพุฑุฏุงุฒ ูุจูุฏ
* ุจูฺฉู ฺฉ **ูพุฑุฏุงุฒูุฏูู ูุณุชูู SPMD** ุดุฏ

CUDA ูฺฺฏโูุง ูุนุฑู ฺฉุฑุฏ ฺฉู ูุจูุงู ุฏุฑ GPU ูุฌูุฏ ูุฏุงุดุช:

* **Kernel Function** ูุณุชูู ุงุฒ ฺฏุฑุงูฺฉ
* **thread**, **block**, **grid**
* ุญุงูุธูู **shared**, **local**, **global**
* ูุฏู ุงุฌุฑุง SPMD
* ุฒูุงูโุจูุฏ ูพูุง
* Debugging ู ุงุจุฒุงุฑ profiling
* ุงูฺฉุงู ููุดุชู ุจุฑูุงููโูุง ุนูู ุจุฏูู shader

ุงู ุงูููุงุจ ุจุงุนุซ ุดุฏ GPU:

> ุงุฒ ฺฉ ฺฉุงุฑุช ุจุงุฒ โ ุจู ูพูุชูุฑู ูุญุงุณุจุงุช ุนูู ุชุจุฏู ุดูุฏ.

ุงูุฑูุฒ:

* ุงุฏฺฏุฑ ุนูู
* ุฑูุฏุฑ ุณููุง
* ุดุจูโุณุงุฒ
* ฺฏุฑุงูฺฉ
* Cloud computing
* HPC
* ุดุจฺฉูโูุง ุนุตุจ
* ููุด ูุตููุน

ููู ู ููู ุชูุฑุจุงู ฑฐฐูช ูุงุจุณุชู ุจู CUDA/GPU ูุณุชูุฏ.

---

# ถ.ท. ฺุฑุง GPU ุจุฑุง SPMD ุงุฏูโุขู ุงุณุชุ

ุฒุฑุง ุชูุงู ุงุฌุฑุง ฺูุฏ ูุฒุงุฑ Thread ุฑุง ุฏุงุฑุฏ:

* ูุฑ Thread ูุณุชูู
* ููู ฺฉ kernel ุฑุง ุงุฌุฑุง ูโฺฉููุฏ
* ุญุงูุธูู ุงุดุชุฑุงฺฉ ุฏุงุฑูุฏ
* warpูุง ุจู ุตูุฑุช SIMD ุงุฌุฑุง ูโุดููุฏ
* Scheduler ุจุณุงุฑ ุณุจฺฉ
* latency ุฑุง ุจุง **ูพููุงูโุณุงุฒ** (Latency Hiding) ูุฏุฑุช ูโฺฉูุฏ

ุฏุฑ GPUุ ุงฺฏุฑ ฺฉ warp ููุชุธุฑ ุญุงูุธู ุจุงุดุฏ:

* warp ุฏฺฏุฑ ููุฑุงู ุฒูุงูโุจูุฏ ูโุดูุฏ

ุฏุฑ ูุชุฌู GPU ุชูุฑุจุงู ููุดู ูุดุบูู ุงุณุช.

---

# ถ.ธ. ุชูุงูุช GPU ู CPU ุฏุฑ ุงุฌุฑุง SPMD

| ูฺฺฏ             | CPU (ุจุง ISPC)   | GPU (ุจุง CUDA)               |
| ----------------- | --------------- | --------------------------- |
| ุชุนุฏุงุฏ ูุณุชู        | ฺฉู              | ุฒุงุฏ                        |
| ุชุนุฏุงุฏ thread ูุนุงู | ฺฉู (ุฏูโูุง)      | ุฒุงุฏ (ูุฒุงุฑุงู)               |
| Bandwidth ุญุงูุธู   | ฺฉู              | ุจุณุงุฑ ุฒุงุฏ                  |
| latency hiding    | ุณุฎุช             | ุจุณุงุฑ ุฎูุจ                   |
| SIMD control      | explicit (mask) | implicit (warp execution)   |
| ุนูุงูููุฏ ุจู        | ูุญุงุณุจุงุช ูพฺุฏู  | ูุญุงุณุจุงุช ุณุงุฏู ุฑู ุฏุงุฏูู ุฒุงุฏ |
| ุฒูุงูโุจูุฏ         | ุณูฺฏู           | ุณุจฺฉ ู ููุงุฒ                 |

GPU ุจุฑุง ุดุฑุงุท ุฒุฑ ุนุงู ุงุณุช:

* ุงฺฏุฑ ุนููุงุช ุฒุงุฏ ู ุดุจูโุจูโูู ุฏุงุฑู
* ุงฺฏุฑ ุฏุงุฏูู ุจุณุงุฑ ุฒุงุฏ ุฏุงุฑู
* ุงฺฏุฑ ูุญุงุณุจุงุช ุณุงุฏู ู ุชฺฉุฑุงุฑ ูุณุชูุฏ
* ุงฺฏุฑ memory access ุงูฺฏู ููุธู ุฏุงุฑุฏ

---

# ถ.น. ุฌูุนโุจูุฏ ูุตู ถ

1. GPUูุง ุงุฒ ุงุจุชุฏุง ุจุฑุง ฺฏุฑุงูฺฉ ู shader ุทุฑุงุญ ุดุฏูุฏ.
2. workload ฺฏุฑุงูฺฉ ุฏุงุฏูโููุงุฒ ุดุฏุฏ ุฏุงุฑุฏุ ูพุณ GPU ุฐุงุชุงู ุจุฑุง SPMD ููุงุณุจ ุงุณุช.
3. ฺฉุดู GPGPU ูุดุงู ุฏุงุฏ GPU ุฑุง ูโุชูุงู ุจูโุนููุงู ฺฉ ุงุจุฑุฑุงุงูู ุงุณุชูุงุฏู ฺฉุฑุฏ.
4. Brook ุงููู ุฒุจุงู ุบุฑฺฏุฑุงูฺฉ ุจุฑุง GPU ุจูุฏ.
5. CUDA ุฏุฑ ฒฐฐท ูุญุฏูุฏุชโูุง ุฑุง ุญุฐู ฺฉุฑุฏ ู GPU ุฑุง ุจู ฺฉ ูพุฑุฏุงุฒูุฏูู ุนููู SPMD ุชุจุฏู ฺฉุฑุฏ.
6. GPU ุงูุฑูุฒ ูพุงูู ุงุฏฺฏุฑ ุนููุ ุฑูุฏุฑ ุณููุง ู HPC ุงุณุช.
7. ุชูุงูุช ISPC/CPU ู CUDA/GPU ููุงู ุชูุงูุช SIMD/SIMT ุงุณุช.
8. GPU ุฏุฑ hiding latencyุ parallelism ู memory bandwidth ุจุณุงุฑ ูู ุงุณุช.

---


ุ
```


---

# ```markdown

# ูุตู ท โ ูุนูุงุฑ GPU ูุฏุฑู: ุฏุฑฺฉ ุนูู ฺฉ ูพุฑุฏุงุฒูุฏูู ุบููโูพฺฉุฑ (ููููู: NVIDIA V100)

ุฏุฑ ุงู ูุตูุ GPU ุฑุง ุงุฒ ุฒุงู ูุนูุงุฑ ูพุงูโุณุทุญ ุจุฑุฑุณ ูโฺฉูู.
ูุฏู ุงู ุงุณุช ฺฉู **ุจูโุตูุฑุช ุชุตูุฑ ู ุดููุฏ** ูุชูุฌู ุดูุฏ:

* GPU ุงุฒ ฺู ุงุฌุฒุง ุชุดฺฉู ุดุฏู ุงุณุชุ
* ูุงุญุฏ SM ฺุณุชุ
* warp ฺุณุช ู ฺุฑุง ุงูโูุฏุฑ ููู ุงุณุชุ
* ฺุฑุง GPU ุชุนุฏุงุฏ ุจุณุงุฑ ุฒุงุฏ thread ุฑุง ูฺฏู ูโุฏุงุฑุฏุ
* ฺุฑุง GPU ุฏุฑ ูพููุงูโุณุงุฒ ุชุฃุฎุฑ (Latency Hiding) ุฎุงุฑูโุงูุนุงุฏู ุงุณุชุ

ุงู ูุตู ฺฉ ุงุฒ ุจูุงุฏโุชุฑู ูุตูโูุงุณุชุ ุฏุฑฺฉ ุขู ฺฉู CUDA ุฑุง ุจุฑุง ุดูุง ูุนูุงโุฏุงุฑ ูโฺฉูุฏ.

---

# ท.ฑ. GPU = ูุฌููุนูโุง ุงุฒ ฺูุฏู ูพุฑุฏุงุฒูุฏูู ฺฉูฺฺฉ (SM)

ุฏุฑ ฺฉ GPU ูุฏุฑู ูุซู **NVIDIA V100**ุ ุชุฑุงุดู ุดุงูู:

* **ธฐ ูุงุญุฏ SM** (Streaming Multiprocessor) ุงุณุช.

* ูุฑ SM ุดุจู ฺฉ ูพุฑุฏุงุฒูุฏูู ูุณุชูู ุงุณุช.
* ูุฑ SM ุฎูุฏุด ุดุงูู:

  * ุตุฏูุง ALU
  * ฺูุฏ warp scheduler
  * Register file ุจุฒุฑฺฏ
  * Shared memory
  * L1 cache
    ุงุณุช.

### ูพุณ GPU โ ฺฉ ูพุฑุฏุงุฒูุฏูู ูุงุญุฏ

GPU โ ธฐ ูพุฑุฏุงุฒูุฏูู ฺฉูฺฺฉ + ุญุงูุธ ูุดุชุฑฺฉ

ูุฑ SM kernelูุง CUDA ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.

---

# ท.ฒ. ุณุงุฎุชุงุฑ SM ฺุณุชุ (ููู ุฏูู ุจุฑ ุงุณุงุณ ุงุณูุงุฏ)

ุฏุฑ ุงุณูุงุฏูุง ูุนูุงุฑ ฺฉ SM ููุงุด ุฏุงุฏู ุดุฏู ุงุณุช:


ฺฉ SM ุดุงูู:

1. **Warp schedulers**
   ุงูุชุฎุงุจ ูโฺฉูุฏ ฺฉุฏุงู warp ุฏุฑ ุงู ูุญุธู ุงุฌุฑุง ุดูุฏ.

2. **ูุงุญุฏูุง SIMD ุงุฒ ููุน ูุฎุชูู**

   * FP32 units (ุจุฑุง float)
   * FP64 units
   * INT32 units
   * Tensor cores (ุจุฑุง ูุงุชุฑุณโุถุฑุจโูุง ุณุฑุน)
   * Load/Store units

3. **Register file** (ุจุณุงุฑ ุจุฒุฑฺฏ)

   * ูุฑ SM ุฏุฑ V100 ุฏุงุฑุง **ฒตถ KB** ุฑุฌุณุชุฑ ุงุณุช


4. **Shared memory (128 KB)**

   * ุญุงูุธูู on-chip ุจุง ุชุฃุฎุฑ ุจุณุงุฑ ฺฉู
   * ุจู threadูุง ฺฉ block ูุดุชุฑฺฉ ุงุณุช

5. **L1 Data Cache**

   * ุจุฑุง ุฏุณุชุฑุณ ุณุฑุนโุชุฑ ุจู global memory

6. **ูพุดุชุจุงู ุงุฒ ถด warp ูุนุงู ููุฒูุงู**
   (ูุฑ warp = ณฒ thread)

ุงู ุจุฎุด ููู ุงุณุช:

> GPU ุจุฑุง ูุฑ Thread ุงุฒ ูุจู ูุถุง ุฑุฌุณุชุฑ ูฺฏู ูโุฏุงุฑุฏุ
> ู ุจู ุงู ุฏูู ุงุณุช ฺฉู ูโุชูุงูุฏ ูุฒุงุฑุงู Thread ุฑุง ููุฑุงูโุจุง state ุขูโูุง ูฺฏู ุฏุงุฑุฏ.

ุงู ุจุฑุฎูุงู CPU ุงุณุช ฺฉู ููุท ฺูุฏ Thread ุณุฎุชโุงูุฒุงุฑ ุฏุงุฑุฏ.

---

# ท.ณ. warp ฺุณุชุ ฺุฑุง ณฒุ

ุฏุฑ CUDA:

* **Thread** = ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ุงูุชุฒุงุน
* **Warp** = ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ูุงูุนู ุงุฌุฑุง ุฏุฑ ุณุฎุชโุงูุฒุงุฑ

### Warp = ฺฏุฑูู ุงุฒ ณฒ thread

ุจู ุจุงู ุณุงุฏู:

> GPU ุจูโุฌุง ุงูฺฉู ฑ thread ุฑุง ุงุฌุฑุง ฺฉูุฏุ ููุดู ณฒ thread ุฑุง ุจุง ูู ุงุฌุฑุง ูโฺฉูุฏ.

ุฏุฑ ุณุทุญ ุณุฎุชโุงูุฒุงุฑ:

* ุชูุงู ณฒ thread ฺฉ warp **ุฏุณุชูุฑ ฺฉุณุงู** ุฑุง ุงุฌุฑุง ูโฺฉููุฏ
  (SIMT: Single Instruction, Multiple Threads)


* ุชูุงูุช warp ุจุง SIMD ฺฉูุงุณฺฉ ุงู ุงุณุช ฺฉู warp *ฺฉ abstraction ุณุทุญ ุจุงูุง* ุฏุงุฑุฏุ ูู ููุท ฺูุฏ ุงูุณุชุฑฺฉุดู ุจุฑุฏุงุฑ.

### ฺุฑุง ณฒุ

ุฏูู ุชุงุฑุฎ ู ุณุฎุชโุงูุฒุงุฑ ุฏุงุฑุฏ:

* ุชุนุงุฏู ุจู ุงูุฏุงุฒูู ุจุฑุฏุงุฑ ู ูพฺุฏฺฏ ฺฉูุชุฑู
* ุณุงุฒุด ุจู latency hiding ู ุชูุงู ูุญุงุณุจุงุช
* ุทุฑุงุญ ูุณูโูุง ุงูููู GPU

ุงูุฑูุฒู ุงู ููุฏุงุฑ ุงุณุชุงูุฏุงุฑุฏ NVIDIA ุงุณุช.

---

# ท.ด. ุงุฌุฑุง warp ฺฺฏููู ุงุณุชุ (SIMT vs SIMD)

### ุฏุฑ SIMD (ูุซู AVX)

* ฺฉ ุฏุณุชูุฑ add ุฑู ธ ุนูุตุฑ float
* ููู ุฏุฑ ฺฉ ุฑุฌุณุชุฑ 256 ุจุช ุฐุฎุฑู ุดุฏูโุงูุฏ

### ุฏุฑ SIMT (CUDA)

* warp = ณฒ thread
* ูุฑ thread **ุฑุฌุณุชุฑ ู context ูุณุชูู** ุฏุงุฑุฏ
* ุงูุง ููุช ฺฉ warp ุฏุณุชูุฑ `add.f32` ุงุฌุฑุง ูโฺฉูุฏ:

  * ุขู ุฏุณุชูุฑ ุฑู ณฒ ููุฏุงุฑ ูุฎุชูู (ฺฉ ุจุฑุง ูุฑ thread) ุงุฌุฑุง ูโุดูุฏ

ูพุณ SIMT:

> ูุซู SIMD ุฑูุชุงุฑ ูโฺฉูุฏุ ุงูุง abstraction ุจุฑุง ุจุฑูุงููโููุณ **ฺฉุงููุงู ูุณุชููู thread** ุงุณุช.

ุงฺฏุฑ ุดุฑุท ูุซู:

```cuda
if (x[i] > 0) { ... }
```

ุฏุฑ warp ุฏู ุดุงุฎู ุดูุฏุ warp ุจุงุฏ ูุฑ ุฏู ูุณุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

* ฺฉ subset threadูุง ูุนุงู
* ุณูพุณ subset ุฏฺฏุฑ

ุงู ูพุฏุฏู **divergence** ูุงู ุฏุงุฑุฏ.

---

# ท.ต. ฺุฑุง GPU ูุฒุงุฑุงู thread ุฑุง ูฺฏู ูโุฏุงุฑุฏุ

ุงู ฺฉ ุงุฒ ฺฉูุฏูุง ุงุตู ฺฉุงุฑุง GPU ุงุณุช:

## ุชุฃุฎุฑ ุญุงูุธู (DRAM latency) ุจุณุงุฑ ุฒุงุฏ ุงุณุช

ูุซูุงู ณฐฐโถฐฐ ุณฺฉู

ูพุฑุฏุงุฒูุฏูู CPU:

* ููุท ฒโธ thread ุณุฎุชโุงูุฒุงุฑ ุฏุงุฑุฏ
* ููุช ฺฉ thread ุฏุฑ ุงูุชุธุงุฑ DRAM ูโูุงูุฏุ CPU ุจฺฉุงุฑ ูโุดูุฏ (ุงฺฏุฑ thread ุฏฺฏุฑ ูุจุงุดุฏ)

GPU:

* ุชูุงูุง ูฺฏูโุฏุงุฑ **ดฐูฌฐฐฐ ุชุง ฑถฐูฌฐฐฐ thread** ุฑุง ุฑู ุชุฑุงุดู ุฏุงุฑุฏ!
  (ุจุณุชู ุจู GPU)
  ุฏุฑ V100: ุชุง **ฑถณูฌธดฐ thread** 

ุงู ุนู:

> ููุช ฺฉ warp ููุชุธุฑ ุญุงูุธู ุงุณุชุ warp ุฏฺฏุฑ ููุฑุงู ุฌุงฺฏุฒู ูโุดูุฏ.
> ุจูุงุจุฑุงู ALUูุง ุชูุฑุจุงู ูฺโููุช ุจฺฉุงุฑ ููโูุงููุฏ.

ุงู ุชฺฉูฺฉ ุฑุง **latency hiding** ูโูุงูู.

CPU ุงู ฺฉุงุฑ ุฑุง ููโุชูุงูุฏ ุงูุฌุงู ุฏูุฏุ ฺูู switching ูุฒูู ุฏุงุฑุฏ.

GPU ุงู ฺฉุงุฑ ุฑุง ุณุฎุชโุงูุฒุงุฑ ู ุจุฏูู overhead ุงูุฌุงู ูโุฏูุฏ.

---

# ท.ถ. Memory Hierarchy ุฏุฑ GPU

GPU ฺูุงุฑ ููุน ุญุงูุธู ุฏุงุฑุฏ (ุจู ุชุฑุชุจ ุณุฑุนุช):

### ฑ) Register

ุณุฑุนโุชุฑูุ ูุฎุตูุต ูุฑ threadุ ูุฒุฏฺฉ ALU
(ุฏุฑ V100 ุจุณุงุฑ ุจุฒุฑฺฏ ุงุณุช)

### ฒ) Shared Memory

* ูุดุชุฑฺฉ ุจู threadูุง ฺฉ block
* ุชุฃุฎุฑ ุจุณุงุฑ ูพุงู
* ุจุฑุง ุงูฺฏูุฑุชูโูุง tile-based ุนุงู ุงุณุช
* ุดุจู L1 cache *ูุงุจู ุจุฑูุงููโุฑุฒ*

### ณ) L2 Cache

* ฺูุฏ MB
* ูุงูโฺฏุฑ ุจู SMูุง ู DRAM

### ด) Global Memory (HBM2)

* ูพููุงโุจุงูุฏ ุจุณุงุฑ ุจุงูุง
* ูู latency ุฒุงุฏ
* ูฺ warp ุจุฏูู ุตู ุทููุงู ููโุชูุงูุฏ ูุณุชูู ุงุฒ DRAM ุณุฑุน ุงุณุชูุงุฏู ฺฉูุฏ

---

# ท.ท. ูฺฉุชูู ุจุณุงุฑ ููู:

## GPU ุงุฒ ูพููุง ุจุงูุฏ ุจุงูุง ุงุณุชูุงุฏู ูโฺฉูุฏุ ุงูุง latency ููฺูุงู ุฒุงุฏ ุงุณุช

ูุซูุงู:

* HBM2 โ 900 GB/s
* ุงูุง latency DRAM ููฺูุงู ุจุงูุงุณุช

ูพุณ GPU ุงูโฺฏููู ุทุฑุงุญ ุดุฏู:

* ุจูโุฌุง ฺฉุงูุด latency (ฺฉู ุฏุดูุงุฑ ุงุณุช)
* ุขู ุฑุง **ูพููุงู ฺฉูุฏ**
* ุจุง ุงุณุชูุงุฏู ุงุฒ ุชุนุฏุงุฏ ุฒุงุฏ warp

ุงู ููุณููู ุทุฑุงุญ GPU ุงุณุช.

---

# ท.ธ. ูุดุงุจูุช warp ุจุง ISPC program instance

| ููููู            | ISPC              | CUDA                    |
| ---------------- | ----------------- | ----------------------- |
| program instance | thread            | thread                  |
| gang             | vector unit (AVX) | warp                    |
| uniform          | shared ุจุฑุง warp  | ูุดุชุฑฺฉ ูุงู laneูุง SIMD |
| varying          | thread-specific   | per-thread execution    |

Warp โ ฺฏุฑูู ุงุฒ program instances ฺฉู ุจุง ูู ุงุฌุฑุง ูโุดููุฏ.

---

# ท.น. ูุนูุงุฑ ฺฉู ฺฉ GPU V100 ุจูโุตูุฑุช ุณุงุฏู

```
+-------------------------------------------+
| GPU (chip)                                |
|                                           |
|  +----------+   +----------+   ...        |
|  |   SM 0   |   |   SM 1   |             |
|  +----------+   +----------+             |
|       \              /                   |
|        \            /                    |
|         ---- L2 Cache ----               |
|                |                          |
|           HBM2 Memory                     |
+-------------------------------------------+
```

ูุฑ SM:

```
+-----------------------------------------------+
| SM                                            |
|   - 64 warps resident                         |
|   - Register file 256KB                       |
|   - Shared memory 128KB                       |
|   - 4 warp schedulers                         |
|   - FP32/FP64/INT/Tensor cores                |
|   - L1 cache                                  |
+-----------------------------------------------+
```

GPU โ CPU ุจุฒุฑฺฏ
GPU = ธฐ CPU ฺฉูฺฺฉ + ุญุงูุธูู ุงุดุชุฑุงฺฉ + ุฒูุงูโุจูุฏ ููุงุฒ

---

# ท.ฑฐ. ุฌูุนโุจูุฏ ูุตู ท

1. GPU ุงุฒ ุฏูโูุง SM ุชุดฺฉู ุดุฏู ุงุณุชุ ูุฑ SM ุดุจู ฺฉ ูพุฑุฏุงุฒูุฏูู ฺฉูฺฺฉ ุงุณุช.
2. warp = ณฒ thread ฺฉู ุจุง ูู ุฏุฑ SIMD ุงุฌุฑุง ูโุดููุฏ (SIMT).
3. GPU ูุฒุงุฑุงู thread ูฺฏู ูโุฏุงุฑุฏ ุชุง ุชุฃุฎุฑ ุญุงูุธู ุฑุง ูพููุงู ฺฉูุฏ.
4. Register file ุนุธู GPU ุงูฺฉุงู ูฺฏูโุฏุงุฑ state ูุฒุงุฑุงู thread ุฑุง ูโุฏูุฏ.
5. Shared memory ุณุฑุนโุชุฑู ุญุงูุธูู ูุงุจู ุจุฑูุงููโุฑุฒ ุฏุฑ GPU ุงุณุช.
6. SMูุง ูุณุชููโุงูุฏ ู CUDA blockูุง ุฑู SMูุง ุฒูุงูโุจูุฏ ูโุดููุฏ.
7. GPU ุฐุงุชุงู ูุญุงุณุจุงุช ุฏุงุฏูโููุงุฒ ุฑุง ุจูโุฎูุจ accelerate ูโฺฉูุฏ.

---

# ูุตู ธ โ ูุจุงู CUDA: ูุฏู ุงุฌุฑุง SPMD ุฑู GPU

ุฏุฑ ุงู ูุตู ุจุงูุงุฎุฑู CUDA ุฑุง ุจูโุทูุฑ ุนูู (ุงูุง ุฏูู ู ุณุงุฏู) ูุนุฑู ูโฺฉูู.

ูุฏู:

* ููู thread / block / grid
* ุชูุงูุช host ู device
* ูุญู ุชุนุฑู kernel
* ูุฏู ุญุงูุธู
* ุฒูุงูโุจูุฏ threadูุง
* ู ุงุตูู ุงุฌุฑุง ููุงุฒ

---

# ธ.ฑ. CUDA = SPMD + GPU Hardware

CUDA ฺฉ ุฒุจุงู ูุณุชุ ฺฉ **ูุฏู ุจุฑูุงููโููุณ** + ูุฌููุนูู ุงุจุฒุงุฑ ุงุณุช.

ุจุฑูุงููู CUDA ุดุงูู ุฏู ุจุฎุด ุงุณุช:

### ฑ) Host Code

ุจุฑ ุฑู CPU ุงุฌุฑุง ูโุดูุฏ.

### ฒ) Device Code (Kernel)

ุจุฑ ุฑู GPU ุงุฌุฑุง ูโุดูุฏ.

host:

* ุญุงูุธูู GPU ุฑุง ููุฏุงุฑุฏู ูโฺฉูุฏ
* ุฏุงุฏูโูุง ุฑุง ุจุง cudaMemcpy ููุชูู ูโฺฉูุฏ
* kernel ุฑุง launch ูโฺฉูุฏ

device:

* kernel ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
* Threadูุง CUDA compute ุงูุฌุงู ูโุฏููุฏ

---

# ธ.ฒ. ุชุนุฑู ฺฉ kernel ุณุงุฏู

```cuda
__global__
void add(float *A, float *B, float *C) {
    int i = blockIdx.x * blockDim.x + threadIdx.x;
    C[i] = A[i] + B[i];
}
```

ูฺฉุงุช:

* `__global__` ุนู kernel ุฑู GPU ุงุฌุฑุง ูโุดูุฏ.
* ูุฑ thread ฺฉ index ูุญุงุณุจู ูโฺฉูุฏ.
* blockDim.x ุงูุฏุงุฒูู ฺฉ ุจููฺฉ ุงุณุช.
* blockIdx.x ุดูุงุฑูู ุจููฺฉ ุฏุฑ grid ุงุณุช.

---

# ธ.ณ. ุณุงุฒูุงูโุฏู threadูุง: grid ู block

CUDA ุณู ุณุทุญ ุงูุชุฒุงุน ุฏุงุฑุฏ:

1. **Thread**
   ฺฉ ูุงุญุฏ ุงุฌุฑุง ูุณุชูู

2. **Block**
   ูุฌููุนูโุง ุงุฒ threadูุง ฺฉู:

   * ุญุงูุธูู shared ูุดุชุฑฺฉ ุฏุงุฑูุฏ
   * ูโุชูุงููุฏ `__syncthreads()` ุงุณุชูุงุฏู ฺฉููุฏ
   * ุญุชูุงู ุฑู ฺฉ SM ุงุฌุฑุง ูโุดููุฏ

3. **Grid**
   ูุฌููุนูโุง ุงุฒ blockูุง ฺฉ kernel

ูุซุงู:

```cpp
dim3 threadsPerBlock(256);
dim3 numBlocks(N / 256);
add<<<numBlocks, threadsPerBlock>>>(A, B, C);
```

launch ุงู kernel:

* ุชุนุฏุงุฏ block = numBlocks
* ูุฑ block = 256 thread
* ูุฌููุน thread = N

---

# ธ.ด. ูุฑ thread ฺฺฏููู index ุฎูุฏ ุฑุง ูพุฏุง ูโฺฉูุฏุ

ุชุงุจุน add:

```cuda
i = blockIdx.x * blockDim.x + threadIdx.x
```

ูุซุงู:

* threadsPerBlock = 256
* blockIdx.x = 2
* threadIdx.x = 10

ูพุณ:

```
i = 2 * 256 + 10 = 522
```

ุณุงุฏู ู ฺฏูุงุณุช.

---

# ธ.ต. ุงุจุนุงุฏ ุฏู ุจุนุฏ ู ุณูโุจุนุฏ

CUDA ุงุฌุงุฒู ูโุฏูุฏ block ู grid ุชุง **ณ ุจุนุฏ** ุจุงุดูุฏ.

ูุซุงู 2D:

```cuda
dim3 threads(32, 32);
dim3 blocks(N/32, M/32);
```

ุฏุฑ kernel:

```cuda
int x = threadIdx.x + blockIdx.x * blockDim.x;
int y = threadIdx.y + blockIdx.y * blockDim.y;
```

ุงู ุจุฑุง ุชุตูุฑุ ูุงุชุฑุณ ู ูุฏุฆู ุนุงู ุงุณุช.

---

# ธ.ถ. Model ุญุงูุธู ุฏุฑ CUDA

GPU ฺูุฏ ููุน ุญุงูุธู ุฏุงุฑุฏ:

| ููุน ุญุงูุธู          | scope      | ุณุฑุนุช       | ฺฉุงุฑุจุฑุฏ                  |
| ------------------ | ---------- | ---------- | ----------------------- |
| Register           | per-thread | ุจุณุงุฑ ุณุฑุน | ูุชุบุฑูุง ูุญู           |
| Shared Memory      | per-block  | ุณุฑุน       | ุงูฺฏูุฑุชูโูุง tile-based |
| Global Memory      | ฺฉู GPU     | ฺฉูุฏุชุฑ      | ุฏุงุฏูู ุงุตู              |
| Constant / Texture | read-only  | cache ุดุฏู  | lookup ุณุฑุน             |

### ูฺฉุชูู ููู

Global memory ฺฉูุฏ ุงุณุชุ
shared memory ุจุฑุง ุจูููโุณุงุฒ performance ุถุฑูุฑ ุงุณุช.

---

# ธ.ท. ูุซุงู ููู: 1D Convolution

ูุณุฎูู ุณุงุฏู:

```cuda
output[i] = (input[i] + input[i+1] + input[i+2]) / 3;
```

ฺุงูุด:

* ูุฑ thread 3 Load ุงุฒ global memory ุฏุงุฑุฏ
* ูุตุฑู ูพููุงโุจุงูุฏ ุฒุงุฏ

### ูุณุฎูู ุจููู ุจุง shared memory

```cuda
__shared__ float tile[128+2];

tile[threadIdx.x] = input[i];
if (threadIdx.x < 2)
    tile[128 + threadIdx.x] = input[i + 128];

__syncthreads();

output[i] = (tile[threadIdx.x] 
           + tile[threadIdx.x+1] 
           + tile[threadIdx.x+2]) / 3;
```

ูุฒุช:

* ุจูโุฌุง 3 * 128 Loadุ ุชููุง **130 Load** ุงูุฌุงู ูโุดูุฏ
  (ุฎู ุจููู!)

ุงู ุงูฺฏู ุฏุฑ GPU ุญุงุช ุงุณุช.

---

# ธ.ธ. ุฒูุงูโุจูุฏ blockูุง ุฑู SMูุง

ุฏุฑ V100:

* ูุฑ SM ูโุชูุงูุฏ ฺูุฏู block ููุฒูุงู ุงุฌุฑุง ฺฉูุฏ
* ูุญุฏูุฏุช ุชูุณุท:

  * ุชุนุฏุงุฏ ุฑุฌุณุชุฑูุง
  * ุญุฌู shared memory
  * ุชุนุฏุงุฏ warps
    ุชุนู ูโุดูุฏ

blockูุง ูุณุชููโุงูุฏ:

> GPU ูโุชูุงูุฏ blockูุง ุฑุง ุฏุฑ ูุฑ ุชุฑุชุจ ุงุฌุฑุง ฺฉูุฏ.

(ุงุณูุงุฏ 44โ45) 

ุงู ุทุฑุงุญ ฺฉูฺฉ ูโฺฉูุฏ kernel:

* ุฑู GPUูุง ฺฉูโูุณุชู
* ุง GPUูุง ูพุฑูุณุชู

ฺฉุณุงู ฺฉุงุฑ ฺฉูุฏ (scalable).

---

# ธ.น. __syncthreads() ู ุนูุช ููู ุขู

ุงู ุฏุณุชูุฑ:

* ูููู threadูุง ฺฉ block ุฑุง **ุณูฺฉ** ูโฺฉูุฏ
* ุชุง ูุจู ุงุฒ ุขูุ ูฺ thread ุงุฏุงูู ููโุฏูุฏ

ฺุฑุง ุจูุงฺฉโูุง ุจุงุฏ ุฑู ฺฉ SM ุงุฌุฑุง ุดููุฏุ

ฺูู:

* shared memory ููุท ุฏุฑูู ฺฉ SM ุงุณุช
* syncthreads ููุท ูุงู threadูุง ููุงู SM ููฺฉู ุงุณุช

ูพุณ block โ ูุงุจู ุชูุณู ุจู ฺูุฏ SM

---

# ธ.ฑฐ. ููููู ุจุณุงุฑ ููู: ุงุณุชููุงู blockูุง

CUDA ุชุถูู ูโฺฉูุฏ:

> blockูุง ูุณุชูู ูุณุชูุฏ
> ู GPU ูโุชูุงูุฏ ุขูโูุง ุฑุง ุฏุฑ ูุฑ ุชุฑุชุจ ุงุฌุฑุง ฺฉูุฏ.

ุงูุง:

* threadูุง ฺฉ block ููฺฉู ุงุณุช ูุงุจุณุชฺฏ ุฏุงุดุชู ุจุงุดูุฏ
* ูพุณ block ุจู ุนููุงู ฺฉ ูุงุญุฏ ุบุฑูุงุจู ุชูุณู ุงุณุช

ุฏุฑ ููุงุจู:

* grid ูโุชูุงูุฏ ุจุฒุฑฺฏ ุจุงุดุฏ
* blockูุง ููุงุฒุ ูุณุชูู ู ุจุฏูู ุชุฑุชุจ ุฎุงุต ุงุฌุฑุง ูโุดููุฏ

ุงู ฺฉ ุงุฒ ููุงุท ููุช CUDA ุงุณุช.

---

# ธ.ฑฑ. ุฌูุนโุจูุฏ ูุตู ธ

1. CUDA ฺฉ ูุฏู SPMD ุจุฑุงุณุงุณ thread/block/grid ุงุฑุงุฆู ูโุฏูุฏ.
2. block ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ุงุณุช ฺฉู scheduler ูโุชูุงูุฏ ุฑู SM ุจฺฏุฐุงุฑุฏ.
3. thread ุณุงุฎุชุงุฑ ููุทู ุงุณุชุ ุงูุง warp ูุงุญุฏ ูุงูุนู ุงุฌุฑุง ุงุณุช.
4. global memory ฺฉูุฏ ุงุณุชุ shared memory ุจุฑุง performance ุญุงุช ุงุณุช.
5. __syncthreads ููุท ุฏุฑูู block ูุนุชุจุฑ ุงุณุช.
6. blockูุง ูุณุชูู ู ุขุฒุงุฏูุฏุ ุชุฑุชุจ ุงุฌุฑุง ููู ูุณุช (ุชุง ุฒูุงู ฺฉู atomic ูุจุงุดุฏ).
7. ูุฏู 1D/2D/3D ุจุฑุง mapping ูุณุงุฆู ุนูู ู ฺฏุฑุงูฺฉ ุงุณุชูุงุฏู ูโุดูุฏ.
8. ุจูููโุณุงุฒ ุญุงูุธู (tiling, coalescing, reuse) ฺฉูุฏ ููููุช CUDA ุงุณุช.

---

```

# โ๏ธ ุงฺฏุฑ ุชุฃุฏ ฺฉูุฏุ  
ุฏุฑ ูพุงู ุจุนุฏ **ูุตู น ู ฑฐ** ุฑุง ุงุฑุงุฆู ูโฺฉูู:

### โูุตู น โ ุจูููโุณุงุฒ ุญุงูุธู ุฏุฑ CUDA  
- coalesced memory access  
- shared memory bank conflict  
- tiling  
- reuse  
- occupancy  
- warp divergence

### โูุตู ฑฐ โ ุฒูุงูโุจูุฏ GPU ู ูุญููู ุงุฌุฑุง ูุงูุน kernel  
- thread scheduling  
- warp switching  
- occupancy  
- register pressure  
- shared memory pressure  
- launch configuration  
```


---

# ```markdown

# ูุตู น โ ุจูููโุณุงุฒ ุญุงูุธู ุฏุฑ CUDA: ุงุตูู ุทูุง ุจุฑุง ฺฉุงุฑุง ุจุงูุง

ุงู ูุตู ููุจ ุงุตู ุจุฑูุงููโููุณ CUDA ุงุณุช.
นฐูช ุณุฑุนุช GPU **ูุณุชููุงู** ูุงุจุณุชู ุจู ูุญููู ูุฏุฑุช ุญุงูุธู ู ุฏุณุชุฑุณ ุจู ุฏุงุฏูโูุงุณุช.

ุฏุฑ ุงู ูุตู ุจุง ุฌุฒุฆุงุช ฺฉุงูู ุงุฏ ูโฺฏุฑู:

* ฺุฑุง ุนููฺฉุฑุฏ GPU ูุงุจุณุชู ุจู ุญุงูุธู ุงุณุชุ
* ฺุฑุง Load/Store ฺฉูุฏ ุงุณุชุ
* ฺฺฏููู GPU ูพููุงโุจุงูุฏ ุฑุง ุจูโุทูุฑ ูุคุซุฑ ูุตุฑู ูโฺฉูุฏุ
* coalesced memory access ฺุณุชุ
* shared memory ฺฺฏููู ุณุฑุนุช ุฑุง ฑฐx ุงูุฒุงุด ูโุฏูุฏุ
* bank conflict ฺุณุช ู ฺฺฏููู ุงุฒ ุขู ุฌููฺฏุฑ ฺฉููุ
* warp divergence ฺฺฏููู ุณุฑุนุช ุฑุง ูุงุจูุฏ ูโฺฉูุฏุ
* occupancy ุนู ฺู ู ฺุฑุง ููู ุงุณุชุ
* register pressure ฺุณุชุ
* shared memory pressure ฺุณุชุ

ูููโ ุงู ููุงูู ุจุฑุง ููุดุชู CUDA ุญุฑููโุง ุถุฑูุฑโุงูุฏ.

---

# น.ฑ. GPU = ูุฒุงุฑุงู ูุณุชู + ฺฉ ุญุงูุธ ูุณุจุชุงู ฺฉูุฏ

GPU ุชูุงู ูุญุงุณุจุงุช ุจุณุงุฑ ุจุงูุง ุฏุงุฑุฏุ ูุซูุงู V100:

* ตฑฒฐ ALU ุจุฑุง float
* ฑต ุชุฑุงููุงูพุณ FP32
* ธฐ SM
* ุตุฏูุง warp

ุงูุง ุญุงูุธ global memory:

* ุจุณุงุฑ ูพููโุจุงูุฏ (HBM2 โ 900 GB/s)
* ุงูุง latency ุจุณุงุฑ ุจุงูุง (ุตุฏูุง ุณฺฉู)

ูพุณ ุงฺฏุฑ ุฏุงุฏูโูุง ุฑุง inefficient load ฺฉูู:

> ALUูุง ุจฺฉุงุฑ ูโุดููุฏ
> GPU slow down ูโุดูุฏ
> ฺฉุงุฑุง ูุงูุน ููฺฉู ุงุณุช ููุท ตโฑฐูช ุชูุงู ุชุฆูุฑฺฉ ุจุงุดุฏ

ุจูุงุจุฑุงู:

> **ูุงููู ุทูุง CUDA:**
> ุญุงูุธู ุฑุง ุณุฑุน ู ุฏุฑุณุช ุงุณุชูุงุฏู ฺฉูุ GPU ุฎูุฏุด ุณุฑุน ุฎูุงูุฏ ุจูุฏ.

---

# น.ฒ. ููููู ยซุฏุณุชุฑุณ ููโุชุฑุงุฒยป (Coalesced Memory Access)

ุงู ุดุงุฏ ูููโุชุฑู ููููู CUDA ุจุงุดุฏ.

ูุฑุถ ฺฉูุฏ ฺฉ warp (ณฒ thread) ุงู ฺฉุฏ ุฑุง ุงุฌุฑุง ูโฺฉูุฏ:

```cuda
float x = A[ threadIdx.x ];
```

ุงฺฏุฑ A ุฏุฑ ุญุงูุธู ูพุดุช ุณุฑ ูู ุจุงุดุฏ:

| Thread | index |
| ------ | ----- |
| 0      | A[0]  |
| 1      | A[1]  |
| 2      | A[2]  |
| ...    | ...   |
| 31     | A[31] |

ุฏุฑ ุงู ุญุงูุช:

* GPU ูโุชูุงูุฏ ูุฑ ณฒ Load ุฑุง ุฏุฑ **ฺฉ ุนููุงุช** ุชุฑฺฉุจ ฺฉูุฏ
* ู **ฺฉ ุฏุฑุฎูุงุณุช ุญุงูุธู** ุจูุฑุณุชุฏ
* ุจุง ฺฉุงุฑุง ุนุงู

ุจู ุงู ุญุงูุช ูโฺฏููุฏ:

> **Coalesced Access**
> (ุฏุณุชุฑุณ ููโุชุฑุงุฒ)

### ฺุฑุง ููู ุงุณุชุ

ฺูู ุงฺฏุฑ ณฒ thread ูุฑฺฉุฏุงู ุฏุฑุฎูุงุณุช ุฌุฏุงฺฏุงูู ุจุฏููุฏ:

* ณฒ ุฏุฑุฎูุงุณุช ุญุงูุธู
* ณฒx latency
* bandwidth ูุฏุฑ ูโุฑูุฏ

ุงูุง ุงฺฏุฑ Coalesced ุจุงุดุฏ:

* ฑ ุฏุฑุฎูุงุณุช
* latency + bandwidth ุจุณุงุฑ ฺฉูุชุฑ
* ุณุฑุนุช warp ุจุณุงุฑ ุฒุงุฏ

---

# น.ณ. ูุซุงู ุจุฏ: ุฏุณุชุฑุณ ุบุฑ ููโุชุฑุงุฒ

```cuda
float x = A[ threadIdx.x * 2 ];   // ูพุฑุด 2 ุชุง
```

ููุงุฏุฑ warp:

| Thread | index |
| ------ | ----- |
| 0      | A[0]  |
| 1      | A[2]  |
| 2      | A[4]  |
| ...    | ...   |
| 31     | A[62] |

ุงู ุนู warp ุจุงุฏ ุฏู ุจุฑุงุจุฑ ุฏุงุฏู ุจุฎูุงูุฏ:

* ถด ุนุฏุฏ (ุจูโุฌุง ณฒ ุนุฏุฏ)
* ุง ุญุช ุฏุฑ ุญุงูุช ุจุฏ ณฒ ุฏุฑุฎูุงุณุช ุฌุฏุงฺฏุงูู

ฺฉุงุฑุง = ูุงุจูุฏ

---

# น.ด. ูุซุงู ูุงุฌุนูโุจุงุฑ: ุฏุณุชุฑุณ ุชุตุงุฏู

```cuda
float x = A[ randomIndex[threadIdx.x] ];
```

ุฏุฑ ุงู ุญุงูุช:

* warp 32 ุฏุฑุฎูุงุณุช random ุฏุงุฑุฏ
* ูฺ coalescing ุงูุฌุงู ููโุดูุฏ
* ฺฉุงุฑุง ููฺฉู ุงุณุช **ุฏูโูุง ุจุฑุงุจุฑ** ฺฉุงูุด ุงุจุฏ

GPU ุงุฒ ุฏุณุช ูโุฑูุฏุ
load/store latency ุจุณุงุฑ ุฒุงุฏ ูโุดูุฏ.

---

# น.ต. ฺฉุงููููุดู ู Shared Memory: ุงูุฒุงุด ุณุฑุนุช 10x

ุฏุฑ ุงุณูุงุฏูุง ุดูุง ฺฉ ูุซุงู ุนุงู ุงุฒ ุจูููโุณุงุฒ ฺฉุงููููุดู ุขูุฏู ุงุณุช:


### ูุณุฎูู ุณุงุฏู CUDA:

ูุฑ thread ุจุงุฏ:

* input[i]
* input[i+1]
* input[i+2]

ุฑุง ุจุฎูุงูุฏ

ฺฉ warp 128 thread ุฏุงุฑุฏ โ 3 * 128 = **384 load**

### ูุณุฎูู Shared Memory:

```cuda
__shared__ float support[128+2];
```

ูุฑ thread ููุท:

```
support[threadIdx.x] = input[i];
```

ูโุฎูุงูุฏ
ู 2 ุชุง thread ุขุฎุฑ ูู ุฏู ููุฏุงุฑ ุงุถุงูู ุฑุง ูโุฎูุงููุฏ

**ุฌูุน loadูุง = 128 + 2 = 130**

### ูุชุฌู:

```
384 โ 130  (ุชูุฑุจุงู 3 ุจุฑุงุจุฑ ุจูุชุฑ)
```

ู ุงู ุชููุง ฺฉ ูุซุงู ฺฉูฺฺฉ ุงุณุช.
ุฏุฑ ูุณุงุฆู ูุงูุน ุงู ุจูุจูุฏ ููฺฉู ุงุณุช 10x ุง ุจุดุชุฑ ุจุงุดุฏ.

---

# น.ถ. Shared Memory ุงุฒ ฺฉุฌุง ุณุฑุน ุงุณุชุ

Shared memory:

* ุฏุฑูู SM ูุฑุงุฑ ุฏุงุฑุฏ
* ุชุฃุฎุฑ ุจุณุงุฑ ฺฉู
* ูพููุงโุจุงูุฏ ุฏุงุฎู ุจุณุงุฑ ุจุงูุง (ฺูุฏู TB/s)
* ูุงููุฏ ฺฉ scratchpad ุนูู ูโฺฉูุฏ
* ฺฉูุชุฑู ุขู ุฏุฑ ุฏุณุช ุจุฑูุงููโููุณ ุงุณุช

ุงูุง ฺฉ ูุญุฏูุฏุช ููู ุฏุงุฑุฏ:

### Shared memory ุจู ุจุงูฺฉโูุง ุชูุณู ุดุฏู ุงุณุช (Banking)

ูุซูุงู:

* 32 ุจุงูฺฉ
* ูุฑ ุจุงูฺฉ ูโุชูุงูุฏ ฺฉ ุฏุณุชุฑุณ ููุฒูุงู ุงุฑุงุฆู ุฏูุฏ

ุงฺฏุฑ ุฏู thread ฺฉ warp:

* ุจู ุฏู ุขุฏุฑุณ ูุฎุชูู ุฏุฑ ุจุงูฺฉ ฺฉุณุงู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ
  โ **Bank conflict**

ุณูพุณ ุฏุณุชุฑุณโูุง sequential ูโุดูุฏ โ ฺฉูุฏ ุดุฏุฏ

---

# น.ท. Bank Conflict ฺุณุชุ

ูุฑุถ ฺฉูุฏ shared memory ุจู 32 ุจุงูฺฉ ุชูุณู ุดุฏู ุจุงุดุฏ:

ุญุงูุช ุฎูุจ:

| Thread | Address | Bank |
| ------ | ------- | ---- |
| 0      | 0       | 0    |
| 1      | 1       | 1    |
| 2      | 2       | 2    |
| ...    | ...     | ...  |
| 31     | 31      | 31   |

ูุฑ thread ุจู ุจุงูฺฉ ูุฎุชุต ุฎูุฏุด ูโุฑูุฏ
โ ุจุฏูู conflict
โ ุณุฑุน

ุญุงูุช ุจุฏ:

ูููู threadูุง ุงุฒ ฺฉ ุจุงูฺฉ ุจุฎูุงููุฏ:

| Thread | Address | Bank |
| ------ | ------- | ---- |
| 0      | 0       | 0    |
| 1      | 32      | 0    |
| 2      | 64      | 0    |
| โฆ      | โฆ       | 0    |

ุงู ุนู:

* ุจุงูฺฉ 0 ุจุงุฏ 32 ุจุงุฑ ูพุงุณุฎ ุฏูุฏ
* warp 32 ุจุฑุงุจุฑ ฺฉูุฏุชุฑ ูโุดูุฏ

---

# น.ธ. warp divergence ฺุณุช ู ฺุฑุง ุงููุช ุฏุงุฑุฏุ

ููุช threadูุง ฺฉ warp ุดุฑุท ูุชูุงูุช ุจฺฏุฑูุฏ:

```cuda
if (A[i] > 0)
    ...
else
    ...
```

ูุซูุงู:

* 17 thread ุดุฑุท ุฑุง true ุฏุงุฑูุฏ
* 15 thread ุดุฑุท ุฑุง false ุฏุงุฑูุฏ

GPU ุจุงุฏ:

* ูุณุฑ true ุฑุง ุงุฌุฑุง ฺฉูุฏ (15 thread mask ุดุฏูโุงูุฏ)
* ุณูพุณ ูุณุฑ false ุฑุง ุงุฌุฑุง ฺฉูุฏ (17 thread mask ุดุฏูโุงูุฏ)

ูุชุฌู:

* warp ูุตู ุณุฑุนุช ูโุดูุฏ
* ุง ุจุฏุชุฑ

Rule:

> ูุฑฺู warp divergence ฺฉูุชุฑ ุจุงุดุฏุ GPU ุณุฑุนโุชุฑ ุงุณุช.

---

# น.น. Occupancy ฺุณุช ู ฺุฑุง ููู ุงุณุชุ

Occupancy = ูุฒุงู ูพุฑุดุฏู SM ุงุฒ warpูุง.

ูุซุงู:

* ฺฉ SM ูโุชูุงูุฏ 64 warp ูฺฏู ุฏุงุฑุฏ
* ุงฺฏุฑ ุฏุฑ practice ููุท 16 warp ูุนุงู ุจุงุดูุฏ
  โ occupancy = 25ูช

Occupancy ฺฉู ุนู:

* ุงฺฏุฑ warp ููุชุธุฑ ุญุงูุธู ุจูุงูุฏ
* warp ุฏฺฏุฑ ุจุฑุง ุงุฌุฑุง ููโุฒูุงู ูุฌูุฏ ูุฏุงุฑุฏ

ูุงููู:

> occupancy ุจุงูุง โ latency hiding ุฎูุจ โ ุณุฑุนุช ุจุดุชุฑ

ุงูุง:

* ุฒุงุฏ ุฒุงุฏ ูู ูุงุฒู ูุณุช
* ุจุนุฏุงู ุจุดุชุฑ ุชูุถุญ ูโุฏูู

---

# น.ฑฐ. Register Pressure ฺุณุชุ

ูุฑ thread ุชุนุฏุงุฏ ุซุงุจุช Register ูุงุฒู ุฏุงุฑุฏ.

* ุงฺฏุฑ kernel ุดูุง Register ุฒุงุฏ ุงุณุชูุงุฏู ฺฉูุฏ
* ุชุนุฏุงุฏ threadูุง ูุงุจู ุฑุฒุฑู ุฏุฑ SM ฺฉุงูุด ูโุงุจุฏ
* occupancy ูพุงู ูโุขุฏ
* ฺฉุงุฑุง ฺฉู ูโุดูุฏ

ูพุณ ุจูุชุฑ ุงุณุช:

* Registerูุง ุบุฑุถุฑูุฑ ุฑุง ฺฉู ฺฉูู
* ูุชุบุฑูุง ุจุฒุฑฺฏ ุฑุง ุจู shared memory ููุชูู ฺฉูู (ุงฺฏุฑ ููุงุณุจ ุจูุฏ)

---

# น.ฑฑ. Shared Memory Pressure

ูุฑ block ููุฏุงุฑ ูุดุฎุต shared memory ูุงุฒ ุฏุงุฑุฏ.

ุงฺฏุฑ:

* shared memory per SM = 128 KB
* kernel ุดูุง per block = 64 KB ูุตุฑู ฺฉูุฏ

ูพุณ ุชุนุฏุงุฏ blockูุง ูุงุจู ุงุฌุฑุง:

```
128 / 64 = 2 block per SM
```

ุงฺฏุฑ ุงู ููุฏุงุฑ ุฒุงุฏ ุดูุฏุ occupancy ูพุงู ูโุขุฏ.

ุจู register pressure ู shared memory pressure ุจุงุฏ ุชุนุงุฏู ุจุฑูุฑุงุฑ ฺฉูู.

---

# น.ฑฒ. ุฌูุนโุจูุฏ ูุตู น

1. GPU ูุงุฒ ุจู ุฏุณุชุฑุณ ููโุชุฑุงุฒ (coalesced) ุฏุงุฑุฏ.
2. ุฏุณุชุฑุณ ุชุตุงุฏู ุง ุบุฑููุธู ุจุณุงุฑ ฺฉูุฏ ุงุณุช.
3. shared memory ุณุฑุนุช ุฑุง 3โ10x ุงูุฒุงุด ูโุฏูุฏ.
4. bank conflict ุจุงุฏ ุงุฌุชูุงุจ ุดูุฏ.
5. warp divergence ุจุงุนุซ ฺฉูุฏ ูโุดูุฏ.
6. occupancy ุจุงุฏ ููุงุณุจ ุจุงุดุฏ ุชุง GPU latency ุฑุง ูพููุงู ฺฉูุฏ.
7. register pressure ู shared memory pressure ุนุงูู ุชุนูโฺฉููุฏูู ุชุนุฏุงุฏ warpูุง ูุนุงู ูุณุชูุฏ.

ุงฺฏุฑ ุงู ููุงูู ุฑุง ุงุฏ ุจฺฏุฑุฏุ 80ูช ูุณุฑ ุจูููโุณุงุฒ CUDA ุฑุง ุท ฺฉุฑุฏูโุงุฏ.

---

# ูุตู ฑฐ โ GPU ฺฺฏููู ฺฉ kernel CUDA ุฑุง ุงุฌุฑุง ูโฺฉูุฏุ

ุฏุฑ ุงู ูุตู ุดูุง ุงุฏ ูโฺฏุฑุฏ:

* kernel ุงุฒ ูุญุธูโ launch ุชุง ุงุฌุฑุง ฺู ูุฑุงุญู ุฑุง ุท ูโฺฉูุฏุ
* thread blockูุง ฺฺฏููู ุฑู SMูุง ูุฑุงุฑ ูโฺฏุฑูุฏุ
* warp ฺฺฏููู ุฒูุงูโุจูุฏ ูโุดูุฏุ
* GPU ฺฺฏููู ุตุฏูุง warp ุฑุง ูุฏุฑุช ูโฺฉูุฏุ
* ฺุฑุง GPU ูุงุฒ ุจู latency ูพุงู ูุฏุงุฑุฏุ
* ฺุฑุง GPU ุฏุฑ ูพููุงูโุณุงุฒ latency ุจโุฑูุจ ุงุณุชุ
* ู ฺฺฏููู ูโุชูุงูุฏ kernel ุฎูุฏ ุฑุง ฺฉุงูู ุชุญูู ฺฉูุฏุ

ุงู ูุตู ุจู ุงุณูุงุฏูุง ุจุฎุด scheduling ุงุดุงุฑู ุฏุงุฑุฏ.


---

# ฑฐ.ฑ. ุฒูุงู ฺฉู kernel launch ูโฺฉูุฏุ ฺู ุงุชูุงู ูโุงูุชุฏุ

ูุซูุงู:

```cuda
convolve<<<grid, block>>>(...);
```

GPU ูุฑุงุญู ุฒุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ:

1. Host ฺฉ ุฏุณุชูุฑ (command) ุจู GPU ูโูุฑุณุชุฏ:
   "ุงู kernel ุฑุง ุจุง ุงู ุชูุธูุงุช ุงุฌุฑุง ฺฉู."

2. GPU command ุฑุง ุฏุฑุงูุช ูโฺฉูุฏ

3. GPU ฺฉ **ุตู ฺฉุงุฑ** (work queue) ุงุฌุงุฏ ูโฺฉูุฏ
   ุดุงูู ุชูุงู blockูุง kernel

4. Scheduler GPU blockูุง ุฑุง ุจู SMูุง **allocate** ูโฺฉูุฏ

5. ูุฑ SM ุชุง ุฌุง ฺฉู ูโุชูุงูุฏ block ุฌุง ูโุฏูุฏ
   (ุจุงุชูุฌู ุจู ูุญุฏูุฏุช ุฑุฌุณุชุฑ + ุญุงูุธู shared)

6. blockูุง ฺฉู ุฌุง ููโุดููุฏ ุฏุฑ ุตู ูโูุงููุฏ ุชุง SM ุขุฒุงุฏ ุดูุฏ

---

# ฑฐ.ฒ. ูุซุงู ุงุณูุงุฏ: GPU ูุฑุถ ุจุง ฒ SM

(ุจุณุงุฑ ููู!)

ุฏุฑ ุงุณูุงุฏ ุจูุงุจุฑ ฺฉ ูุซุงู ูุฑุถ:

* ูุฑ SM ุธุฑูุช:

  * 384 thread
  * 1.5 KB shared memory
    ุฏุงุฑุฏ


kernel ุดูุง:

* block size = 128 thread
* shared memory per block = 520 bytes
  (ูุซุงู ฺฉุงููููุดู)


ูุฑ SM ูโุชูุงูุฏ ฺูุฏ block ุงุฌุฑุง ฺฉูุฏุ

ูุญุงุณุจู:

### ูุญุฏูุฏุช 1: ุธุฑูุช thread

```
384 / 128 = 3 block ูุงุจูโุงุฌุฑุง
```

### ูุญุฏูุฏุช 2: ุธุฑูุช shared memory

```
1.5 KB = 1536 bytes
520 bytes per block
1536 / 520 = ููุท 2 block!
```

ูพุณ ูุญุฏูุฏุช ูุงูุน shared memory ุงุณุช.

**ฺฉ SM ููุท ฒ block ุงุฌุฑุง ูโฺฉูุฏ.**

---

# ฑฐ.ณ. ูุฑุขูุฏ ุฒูุงูโุจูุฏ blockูุง

ฺูู ูุฑ SM ุฏู block ูโุชูุงูุฏ ุงุฌุฑุง ฺฉูุฏุ ุงุฌุฑุง 1000 block:

* ุงุจุชุฏุง SM0 โ block 0 ู block 2
* SM1 โ block 1 ู block 3
* ููุช block 0 ุชูุงู ุดุฏุ block 4 ูุงุฑุฏ SM0 ูโุดูุฏ
* ููุช block 2 ุชูุงู ุดุฏุ block 5 ูุงุฑุฏ SM0 ูโุดูุฏ
* ูููโุทูุฑ ุงุฏุงูู ุชุง 1000 block ุงุฌุฑุง ุดูุฏ
  (ฺฉุงููุงู ุดุจู ุงุณูุงุฏูุง 57โ66)

GPU ููุดู:

> SMูุง ุฑุง ุชุง ุญุฏ ููฺฉู ูพุฑ ูฺฏู ูโุฏุงุฑุฏ
> ุชุง warpูุง ุจุฑุง latency hiding ุขูุงุฏู ุจุงุดูุฏ.

---

# ฑฐ.ด. warp scheduling ุฏุฑูู SM

ุฏุฑ ูุฑ SM:

* block โ ฺูุฏ warp
* SM warpูุง ฺฉู **ุขูุงุฏู ุงุฌุฑุง ูุณุชูุฏ** ุฑุง ุฏุฑ ฺฉ ุตู ูฺฏู ูโุฏุงุฑุฏ
* warp scheduler ุฏุฑ ูุฑ clock:

### ฺฉ warp ุขูุงุฏู ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ

โ ุฏุณุชูุฑ ุจุนุฏ warp ุงุฌุฑุง ูโุดูุฏ

ุงฺฏุฑ warp:

* ููุชุธุฑ Load ุงุฒ global memory ุจุงุดุฏ
* ุง ฺฉ Synchronization ุฏุงุดุชู ุจุงุดุฏ
  โ warp ยซุบุฑ ุขูุงุฏูยป ุดุฏู
  โ warp ุฏฺฏุฑ ุงูุชุฎุงุจ ูโุดูุฏ

ุจู ุงู ุฑูุด GPU:

> ุชุฃุฎุฑ ุญุงูุธู ุฑุง ูพููุงู ูโฺฉูุฏ
> ู throughput ุฑุง ุจุงูุง ูฺฏู ูโุฏุงุฑุฏ

---

# ฑฐ.ต. warpูุง ูุนุงู = occupancy

ุงฺฏุฑ ููุท ธ warp ูุนุงู ุจุงุดูุฏ:

* latency hide ฺฉู
* ุณุฑุนุช ฺฉู

ุงฺฏุฑ ถด warp ูุนุงู ุจุงุดูุฏ:

* latency ฺฉุงูู ูพููุงู
* ฺฉุงุฑุง ุนุงู

Occupancy ููุงุณุจ ูุนูููุงู:

* 40ูช ุชุง 80ูช ุงุณุช
* 100ูช ููุดู ูุงุฒู ูุณุช (ุจุณุชู ุจู kernel)

---

# ฑฐ.ถ. ุฑูุชุงุฑ ูุงูุน ุฏุฑูู SM ููฺฏุงู ุงุฌุฑุง ฺฉ warp

ูุฑุถ ฺฉูุฏ warp ุฏุณุชูุฑูุง ุฒุฑ ุฑุง ุงุฌุฑุง ูโฺฉูุฏ:

1. Load X
2. Add
3. Store
4. Branch
5. Load Y

ุงฺฏุฑ ุฏุณุชูุฑ 1 (Load X) ุงุฒ DRAM ุจุฎูุงูุฏ:

* ฒฐฐ ุชุง ถฐฐ ุณฺฉู ุทูู ูโฺฉุดุฏ
* warp ุงุฒ ูุณุช "ready" ุฎุงุฑุฌ ูโุดูุฏ
* warp scheduler ููุฑุงู warp ุฏฺฏุฑ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ
* ุงู ุฑููุฏ ุงุฏุงูู ูโุงุจุฏ ุชุง ุฏุงุฏู ุจุงุฏ

ููุช ุฏุงุฏู ุจุฑุณุฏ:

* warp ุฏูุจุงุฑู ุจู ุตู "ready" ูโุฑูุฏ
* ุฏูุจุงุฑู ุฒูุงูโุจูุฏ ูโุดูุฏ

ุจู ููู ุฏูู GPU:

> **ูฺโููุช ุจฺฉุงุฑ ููโูุงูุฏุ ูฺฏุฑ occupancy ุฎู ฺฉู ุจุงุดุฏ.**

---

# ฑฐ.ท. ุงุฌุฑุง ุณูุณููโูุฑุงุชุจ kernel

1. Host โ launch kernel
2. GPU โ ุตู block ุงุฌุงุฏ ูโฺฉูุฏ
3. SM0, SM1, ..., SMn โ blockูุง ุฑุง ูโฺฏุฑูุฏ
4. ูุฑ block:

   * threadูุงุด ุฑุง ูโุณุงุฒุฏ
   * warpูุง ุฑุง ุชุดฺฉู ูโุฏูุฏ
     (thread 0โ31 โ warp0ุ thread 32โ63 โ warp1ุ โฆ)
5. warp scheduler ุฏุณุชูุฑูุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
6. ููุช block ุชูุงู ุดุฏ:

   * shared memory ุขุฒุงุฏ ูโุดูุฏ
   * ุฑุฌุณุชุฑูุง ุขุฒุงุฏ ูโุดูุฏ
   * block ุจุนุฏ ุงุฒ ุตู ูุงุฑุฏ ูโุดูุฏ
7. ููุช ููู blockูุง ุงุฌุฑุง ุดุฏูุฏุ kernel ุชูุงู ูโุดูุฏ

---

# ฑฐ.ธ. ฺุฑุง block ุจุงุฏ ุฑู ฺฉ SM ุจุงู ุจูุงูุฏุ

ุฏู ุฏูู ููู:

### ฑ) Shared Memory

ุจู threadูุง block ูุดุชุฑฺฉ ุงุณุช
โ ุจุงุฏ ุฏุฑ ฺฉ SM ุจุงุดุฏ.

### ฒ) Sync

`__syncthreads()`
โ ุงูฺฉุงู ูุฏุงุฑุฏ ุจู ฺูุฏ SM ููุงููฺฏ ุดูุฏ
โ ูพุณ block ุจุงุฏ ุฑู ููุท ฺฉ SM ุงุฌุฑุง ุดูุฏ.

### ูุชุฌู:

> block ฺฉ ูุงุญุฏ atomic scheduling ุงุณุช.

---

# ฑฐ.น. ฺุฑุง CUDA blockูุง ุฑุง ูุณุชูู ุทุฑุงุญ ฺฉุฑุฏู ุงุณุชุ

ุงฺฏุฑ blockูุง ุจู ูู ูุงุจุณุชู ุจุงุดูุฏ:

* ุงุฌุฑุง ุขูโูุง ุฑู SMูุง ูุฎุชูู ููฺฉู ูุณุช
* ุงูุนุทุงู ุฒูุงูโุจูุฏ ุงุฒ ุจู ูโุฑูุฏ
* GPU scalability ุงุฒ ุจู ูโุฑูุฏ

ุจูุงุจุฑุงู CUDA ูโฺฏูุฏ:

> blockูุง ุจุงุฏ ูุณุชูู ุจุงุดูุฏ
> ูฺฏุฑ ุงูฺฉู atomic ุง global synchronization ุงุณุชูุงุฏู ุดูุฏ (ฺฉู ุชูุตู ููโุดูุฏ)

ุงู ุทุฑุงุญ ุจุงุนุซ ูโุดูุฏ:

* ููุงู kernel ุฑู GPU ุถุนู ูู ุงุฌุฑุง ุดูุฏ
* ุฑู GPU ูู ูู ุงุฌุฑุง ุดูุฏ
* ุจุฏูู ุชุบุฑ ฺฉุฏ

ุงู ุฏูู ูุญุจูุจุช CUDA ุงุณุช.

---

# ฑฐ.ฑฐ. ุฌูุนโุจูุฏ ูุตู ฑฐ

1. kernel launch ุจุงุนุซ ุงุฌุงุฏ grid ุจุฒุฑฺฏ blockูุง ูโุดูุฏ.
2. blockูุง ูุงุญุฏ ุฒูุงูโุจูุฏ ูุณุชูุฏ ู ุฑู SM ุงุฌุฑุง ูโุดููุฏ.
3. ูุฑ block ุจู warpูุง ุชูุณู ูโุดูุฏ.
4. warp scheduler ุจุฑ ุงุณุงุณ ุขูุงุฏูโุจูุฏู warpุ warpูุง ูุฎุชูู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.
5. warpูุง ููุชุธุฑ memory stall ูโุดููุฏ ู warpูุง ุฏฺฏุฑ ุฌุงฺฏุฒู ูโุดููุฏ.
6. occupancy ุจุงูุง latency ุฑุง ูพููุงู ูโฺฉูุฏ.
7. shared memory ู register usage ุชุนู ูโฺฉููุฏ ฺูุฏ block ููุฒูุงู ุงุฌุฑุง ุดููุฏ.
8. blockูุง ุญุชูุงู ุฑู ฺฉ SM ุงุฌุฑุง ูโุดููุฏ ฺูู shared memory ู sync ูุงุฒ ุฏุงุฑูุฏ.
9. kernelูุง ุฑู GPUูุง ูุฎุชูู ุจุฏูู ุชุบุฑ ุงุฌุฑุง ูโุดููุฏ ุจูโุฎุงุทุฑ ุงุณุชููุงู blockูุง.

---


---

# ```markdown

# ูุตู ฑฑ โ ุจุฑูุงููโููุณ ุฏุฑ ุณุทุญ Warp: ุณุฑุนโุชุฑู ุดฺฉู ุงุฑุชุจุงุท ุฏุฑ GPU

ุงู ูุตู ฺฉ ุงุฒ ุญุฑููโุงโุชุฑู ู ูููโุชุฑู ูุตูโูุง CUDA ุงุณุช.

* ุงฺฏุฑ ุจุชูุงูุฏ ุฏุฑ ุณุทุญ **warp** ุจุฑูุงูู ุจููุณุฏุ
* ุณุฑุนุช kernelูุงุชุงู ฺฏุงู ฒx ุชุง ฑฐx ุงูุฒุงุด ูพุฏุง ูโฺฉูุฏุ
* ุจุฏูู ูุงุฒ ุจู shared memoryุ
* ู ุจุฏูู ูุฒููู synchronization.

ุฏุฑ ุงู ูุตูุ ุจูโุตูุฑุช ฺฉุงููุงู ุณุงุฏูุ ุงูุง ุนูู ู ุนูู ุชูุถุญ ูโุฏูู:

* warp-level primitives ฺู ูุณุชูุฏุ
* ฺุฑุง ุงุฑุชุจุงุท ุฏุฑูู warp ุณุฑุนโุชุฑู ุนููุงุช CUDA ุงุณุชุ
* warp shuffle ฺุณุชุ
* warp vote ฺุณุชุ
* ฺฺฏููู ุจุฏูู shared memory ุจู threadูุง ุฏุงุฏู ุฌุงุจูโุฌุง ฺฉููุ
* ฺฉุงุฑุจุฑุฏูุง ูุงูุน (prefix sum, reduction, scan, matrix operations)
* ููุงุณูู warp-level ุจุง shared memory

---

# ฑฑ.ฑ. ุงุฏุขูุฑ: warp ฺุณุชุ

ุฏุฑ ูุตู ท ฺฏูุชู:

* warp = ฺฏุฑูู ุงุฒ **ณฒ thread**
* ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ูุงูุน ุงุฌุฑุง GPU ุงุณุช
* warp ููุดู ฺฉ ุฏุณุชูุฑ **ฺฉุณุงู** ุฑุง ุงุฌุฑุง ูโฺฉูุฏ (SIMT)
* threadูุง ฺฉ warp **ุฏุฑ ฺฉูุงุฑ ฺฉุฏฺฏุฑ ุฑู ฺฉ SIMD unit** ุงุฌุฑุง ูโุดููุฏ

ูฺฉุชูู ุทูุง:

> ฺูู threadูุง warp ููุดู ููโุฒูุงู ูุณุชูุฏุ
> **synchronization ุฏุฑ warp ูุงุฒู ูุณุช!**

ุจุฑุฎูุงู shared memory ฺฉู ุจุงุฏ `__syncthreads()` ุจุฒูุฏุ
ุฏุฑ warp-level programming ุดูุง ุจู ูฺ sync ูุงุฒ ูุฏุงุฑุฏ.

ุงู ุจุงุนุซ ูโุดูุฏ warp-level ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุฒ shared memory ุจุงุดุฏ.

---

# ฑฑ.ฒ. ฺุฑุง warp-level programming ุณุฑุนโุชุฑ ุงุฒ shared memory ุงุณุชุ

### Shared memory:

* ุจุณุงุฑ ุณุฑุน ุงุณุช
* ุงูุง:

  * ุจุงุฏ ุฏุงุฏู ุจู shared memory ููุดุชู ุดูุฏ
  * ุณูพุณ warp sync ุดูุฏ
  * ุณูพุณ ุฏุงุฏู ุฎูุงูุฏู ุดูุฏ

ุณู ูุฑุญูู ุฏุงุฑุฏ โ ุฒูุงูโุจุฑ
ุฏุฑ ุถูู ููฺฉู ุงุณุช **bank conflict** ุฑุฎ ุฏูุฏ.

### Warp shuffle:

* ุฏุงุฏู **ูุณุชููุงู ุงุฒ ุฑุฌุณุชุฑ thread ุฏฺฏุฑ ฺฏุฑูุชู ูโุดูุฏ**

ุจุฏูู:

* write ุจู shared memory
* read ุงุฒ shared memory
* synchronization
* conflict

ุจู ุงู ุฏูู warp-level operations ุณุฑุนโุชุฑู ููุน ุงุฑุชุจุงุท ุฏุฑ CUDA ูุณุชูุฏ.

---

# ฑฑ.ณ. warp shuffle ฺุณุชุ

CUDA primitiveูุง ุฒุฑ ุฑุง ุฏุงุฑุฏ:

```cuda
__shfl_sync(mask, value, srcLane);
__shfl_up_sync(mask, value, delta);
__shfl_down_sync(mask, value, delta);
__shfl_xor_sync(mask, value, laneMask);
```

ุงุฏู ุจุณุงุฑ ุณุงุฏู:

> ุจู thread ุงุฌุงุฒู ูโุฏูุฏ ููุฏุงุฑ ููุฌูุฏ ุฏุฑ **ุฑุฌุณุชุฑ** thread ุฏฺฏุฑ ุฑุง ูุณุชููุงู ุจุฎูุงูุฏ.

ุงู ุนู:

* ุฏุงุฏู ุงุฒ ุฑุฌุณุชุฑ โ ุฑุฌุณุชุฑ ููุชูู ูโุดูุฏ
* shared memory ุญุฐู ูโุดูุฏ
* latency ุจุณุงุฑ ูพุงู ุงุณุช

### ูุซุงู: ฺฏุฑูุชู ููุฏุงุฑ thread 0 ุชูุณุท ูููู threadูุง warp

```cuda
int x = __shfl_sync(0xffffffff, myValue, 0);
```

* 0xffffffff ุนู ูููู threadูุง ูุนุงูโุงูุฏ
* threadูุง ููุฏุงุฑ `myValue` ุฏุฑ lane ุตูุฑ ุฑุง ูโฺฏุฑูุฏ

---

# ฑฑ.ด. ูุซุงู: reduction ุณุฑุน ุจุง warp shuffle

### ูุณุฎูู shared memory (ฺฉูุฏุชุฑ)

```cuda
__shared__ float tmp[32];

tmp[threadIdx.x] = val;
__syncthreads();

if (threadIdx.x < 16) tmp[threadIdx.x] += tmp[threadIdx.x + 16];
__syncthreads();
...
```

ูุงุฒ ุฏุงุฑุฏ ุจู:

* write
* sync
* read
* sync
* read
* sync
* โฆ

### ูุณุฎูู warp-shuffle (ุจุณุงุฑ ุณุฑุน)

```cuda
float x = val;
for (int offset = 16; offset > 0; offset /= 2)
    x += __shfl_down_sync(0xffffffff, x, offset);
```

ุจุฏูู shared memory
ุจุฏูู sync
ููู ุฏุฑ ุฑุฌุณุชุฑ
ุจุณุงุฑ ุณุฑุน

---

# ฑฑ.ต. warp vote ฺุณุชุ

ฺฏุงู ูุงุฒู ุงุณุช threadูุง ฺฉ warp ุฑุฃ (vote) ุจุฏููุฏ:

* ุขุง ูููู threadูุง ฺฉ ุดุฑุท ุฑุง ุฏุงุฑูุฏุ
* ุขุง ุญุฏุงูู ฺฉ thread ุดุฑุท ุฑุง ุฏุงุฑุฏุ
* ุขุง ูุงุณฺฉ ุงุฒ threadูุง ูุนุงู ูโุฎูุงููุ

Primitiveูุง vote:

```cuda
__all_sync(mask, pred);
__any_sync(mask, pred);
__ballot_sync(mask, pred);
```

ฺฉุงุฑุจุฑุฏ ูุซุงู:

---

### ูุซุงู: ฺฺฉ ฺฉุฑุฏู ุขุง ฺฉู warp ุดุฑุท ุฎุงุต ุฏุงุฑุฏุ

```cuda
if (__all_sync(0xffffffff, x > 0)) {
    // ููู xูุง ูุซุจุช ุจูุฏูุฏ
}
```

### ูุซุงู: ุขุง warp ุจู ุดุงุฎูู if ูุงุฑุฏ ุดูุฏุ

```cuda
if (__any_sync(0xffffffff, x < 0)) {
    // ุญุฏุงูู ฺฉ thread ููุฏุงุฑ ููู ุฏุงุฑุฏ
}
```

### ูุซุงู: ุจู ุฏุณุช ุขูุฑุฏู mask threadูุง ฺฉู ุดุฑุท ุฏุงุฑูุฏ:

```cuda
unsigned mask = __ballot_sync(0xffffffff, x == 0);
```

ุงู ฺฉ **ุนุฏุฏ ณฒ-ุจุช** ุงุณุชุ
ูุฑ ุจุช ูุชุนูู ุจู ฺฉ thread ุงุณุช.

---

# ฑฑ.ถ. ฺุฑุง ballot ููู ุงุณุชุ

ุฒุฑุง ballot ุงุณุงุณ ุณุงุฎุช ุงูฺฏูุฑุชูโูุง ูพุดุฑูุชู ุงุณุช:

* prefix sum
* compact
* filtering
* sorting primitives
* sparse matrix processing
* stream compaction

ูุซุงู:
ุงฺฏุฑ ุจุฎูุงูุฏ warp ุจูููุฏ:

ยซุฏุฑ ุจู threadูุง warpุ ฺู threadูุง ฺฉ ฺฉุงุฑ ุฎุงุต ุงูุฌุงู ูโุฏููุฏุยป

ballot ูพุงุณุฎ ุงุณุช.

---

# ฑฑ.ท. ููุงุณู warp-shuffle ุจุง shared memory

| ูฺฺฏ               | Shared Memory | Warp Shuffle   |
| ------------------- | ------------- | -------------- |
| ุณุฑุนุช                | ุณุฑุน          | **ุจุณุงุฑ ุณุฑุน** |
| ูุงุฒ ุจู sync        | **ุจูู**       | **ุฎุฑ**        |
| ุฎุทุฑ bank conflict   | **ุจูู**       | ุฎุฑ            |
| ุฏุณุชุฑุณ cross-thread | ุจูู           | ููุท ุฏุฑ warp    |
| ุงูุนุทุงู              | ุจุงูุง          | ูุญุฏูุฏ ุจู warp  |

ูุชุฌู:

> ุจุฑุง ุงุฑุชุจุงุท warp-level ุงุฒ shuffle ุงุณุชูุงุฏู ฺฉูุฏ
> ุจุฑุง block-level ุงุฒ shared memory
> ุจุฑุง grid-level ุงุฒ global memory

ุงู ุณู ุณุทุญ ุฑุง ูุจุงุฏ ุงุดุชุจุงู ฺฉูู.

---

# ฑฑ.ธ. ุฌูุนโุจูุฏ ูุตู ฑฑ

1. warp ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ุงุฌุฑุง ุงุณุช.
2. ุงุฑุชุจุงุท ุฏุฑูู warp ูุงุฒ ุจู sync ูุฏุงุฑุฏ.
3. warp shuffle ุงูฺฉุงู ุชุจุงุฏู ุฑุฌุณุชุฑ ุจู ุฑุฌุณุชุฑ ุฑุง ูโุฏูุฏ.
4. shuffle ุณุฑุนโุชุฑู ุฑูุด ุงุฑุชุจุงุท ุงุณุช.
5. vote ุจุฑุง ุฑุฃโฺฏุฑ ุฏุฑูู warp ุถุฑูุฑ ุงุณุช.
6. ุจุณุงุฑ ุงุฒ ุงูฺฏูุฑุชูโูุง HPC ุจุง ุงู primitiveูุง ููุดุชู ูโุดููุฏ.
7. shuffle ุฌุงฺฏุฒู shared memory ุจุฑุง ุงุฑุชุจุงุทุงุช ฺฉูฺฺฉ ุงุณุช.

ุงฺฏุฑ warp-level programming ุฑุง ุงุฏ ุจฺฏุฑุฏุ
ุฏุฑูุง ุฏูุง CUDA ุญุฑููโุง ุจู ุฑู ุดูุง ุจุงุฒ ูโุดูุฏ.

---

# ูุตู ฑฒ โ ุฎุทุงูุง ุฑุงุฌุ Race Conditionูุง ู Atomicูุง ุฏุฑ CUDA

ุฏุฑ CUDA ูุฒุงุฑุงู thread ููโุฒูุงู ุงุฌุฑุง ูโุดููุฏ.
ูุฑ ุงุดุชุจุงู ฺฉูฺฺฉ ูโุชูุงูุฏ:

* ุฎุฑูุฌ ุฑุง ุฎุฑุงุจ ฺฉูุฏ
* kernel ุฑุง crash ฺฉูุฏ
* ุง ฺฉ bug ูุงุฏุฑ ู ูพููุงู ุงุฌุงุฏ ฺฉูุฏ

ุฏุฑ ุงู ูุตู:

* ุฎุทุฑูุงฺฉโุชุฑู ุฎุทุงูุง ุฑุง ูุนุฑู ูโฺฉูู
* memory model CUDA ุฑุง ุชูุถุญ ูโุฏูู
* atomic operations ุฑุง ุจุฑุฑุณ ูโฺฉูู
* ู ูุซุงูโูุง ุงุณูุงุฏูุง ุฑุง ุชุญูู ูโฺฉูู.

---

# ฑฒ.ฑ. Race Condition ฺุณุชุ

Race Condition ุนู:

> ุฏู ุง ฺูุฏ thread **ููโุฒูุงู** ุจู ฺฉ ุฎุงููู ุญุงูุธู ูโููุณูุฏ.

ูุซุงู:

```cuda
C[i] = C[i] + 1;
```

ุงฺฏุฑ ฺูุฏ thread ฺฉ ููุฏุงุฑ ูุดุชุฑฺฉ ุฑุง ุงูุฒุงุด ุฏููุฏ:

* ูุฑ thread ููุฏุงุฑ ูุฏู ุฑุง ูโุฎูุงูุฏ
* ุฑู ุขู ุงูุฒุงุด ูโุฏูุฏ
* ู ูโููุณุฏ
  โ ูุชุฌูู ููุง ุบูุท ูโุดูุฏ

---

# ฑฒ.ฒ. ูุซุงู ุงุณูุงุฏ: histogram (ุฏุฑุณุช ู ุงูู)

ุฏุฑ ุงุณูุงุฏ ฺฏูุชู ุดุฏู:
ุงุณุชูุงุฏู ุงุฒ `atomicAdd` ุจุฑุง histogram **ูุฌุงุฒ** ุงุณุช.


ูุซูุงู:

```cuda
atomicAdd(&counts[A[i]], 1);
```

ฺุฑุง ุงูู ุงุณุชุ

* atomicAdd ุชุถูู ูโฺฉูุฏ ุนููุงุช read-modify-write
  **ุงุชู** ุงุฌุฑุง ุดูุฏ
  (ูู ุจุง ุฏุฎุงูุช thread ุฏฺฏุฑ)

ุฎุทุฑุงุช race condition ุงุฒ ุจู ูโุฑูุฏ.

CUDA capability:

> atomic ุฑู global memory ู shared memory ููุฌูุฏ ุงุณุช.

---

# ฑฒ.ณ. atomic operations ุฏููุงู ฺู ูโฺฉููุฏุ

ุจู ุฒุจุงู ุณุงุฏู:

```cuda
atomicAdd(addr, x);
```

ฺฉุงุฑูุง ุฒุฑ ุฑุง **ุจูโุตูุฑุช ุงุชู** ุงูุฌุงู ูโุฏูุฏ:

1. ููุฏุงุฑ *ูุฏู* ุฑุง ุงุฒ `addr` ูโุฎูุงูุฏ
2. ููุฏุงุฑ ุฌุฏุฏ = ูุฏู + x ุฑุง ูุญุงุณุจู ูโฺฉูุฏ
3. ููุฏุงุฑ ุฌุฏุฏ ุฑุง ุฏุฑ `addr` ูโููุณุฏ
4. ููุฏุงุฑ ูุฏู ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ

ุฏุฑ ุงู ูุฏุช:

* ูฺ thread ุฏฺฏุฑ ููโุชูุงูุฏ ูุณุท ฺฉุงุฑ ุนููุงุช ุฎูุฏุด ุฑุง ุงูุฌุงู ุฏูุฏ

---

# ฑฒ.ด. ฺุฑุง atomics ฺฉูุฏุชุฑ ูุณุชูุฏุ

ุฒุฑุง:

* ุฏุณุชุฑุณ ุจู ฺฉ ุฎุงููู ูุดุชุฑฺฉุ serialization ุงุฌุงุฏ ูโฺฉูุฏ
* ูููู threadูุง ููุชุธุฑ ูโูุงููุฏ
* warp ฺฉูุฏ ูโุดูุฏ
* ุจู ูพููุงโุจุงูุฏ ุญุงูุธู ูุงุจุณุชู ุงุณุช

ุงูุง ููฺูุงู:

* atomic ุชููุง ุฑูุด ุงูู ุจุฑุง update ฺฉ ุฎุงููู ูุดุชุฑฺฉ ุงุณุช
* ุจุฑุง histogramุ countersุ flags ุถุฑูุฑ ูุณุชูุฏ

CUDA ููฺูู primitiveูุง ูุงููุฏ:

* atomicCAS
* atomicMin
* atomicMax
* atomicExch

ุฏุงุฑุง ุงุณุช.

---

# ฑฒ.ต. ุฎุทุง ุจุณุงุฑ ุฎุทุฑูุงฺฉ: ูุงุจุณุชฺฏ ุจู blockูุง

ุฏุฑ ุงุณูุงุฏ ุขูุฏู ุงุณุช:
ุงู ฺฉุฏ ูุงุฏุฑุณุช ุงุณุช:


```cuda
atomicAdd(&myFlag, 1);

while (atomicAdd(&myFlag, 0) == 0) { }
```

ฺุฑุงุ

ุฒุฑุง:

* block0 ู block1 ููฺฉู ุงุณุช **ูฺ ููุช ููโุฒูุงู** ุงุฌุฑุง ูุดููุฏ
* scheduler ุขุฒุงุฏ ุงุณุช blockูุง ุฑุง ูุฑ ุทูุฑ ุฎูุงุณุช ุงุฌุฑุง ฺฉูุฏ
* ููฺฉู ุงุณุช block1 ุฒูุฏุชุฑ ุงุฌุฑุง ุดูุฏ
* ููฺฉู ุงุณุช block0 ุงุตูุงู ุชุง ุฎู ุฏุฑ ุงุฌุฑุง ูุดูุฏ

ุจูุงุจุฑุงู:

> ูุจุงุฏ ุจู blockูุง ุงุฒ synchronization ุงุณุชูุงุฏู ุดูุฏ
> ูฺฏุฑ ุงุฒ ุทุฑู kernel-level sync (ฺฉู ูุฌูุฏ ูุฏุงุฑุฏ!)
> ุง ุงุฒ atomicูุง ุฎุงุต ู ุงูฺฏูุฑุชูโูุง ููุงุฒ (grid sync)
> ุง launched kernels ุฌุฏุงฺฏุงูู

ุจูุชุฑ ุงุณุช blockูุง CUDA **ูุณุชูู** ุจุงุดูุฏ.

---

# ฑฒ.ถ. Memory Model ุฏุฑ CUDA

CUDA ุณู ุณุทุญ memory ุฏุงุฑุฏ:

1. **per-thread**

   * local registers
   * local memory

2. **per-block**

   * shared memory

3. **device-wide global memory**

   * ุชูุงู blockูุง ูโุชูุงููุฏ ุจุฎูุงููุฏ/ุจููุณูุฏ

ุงูุง ูฺ ููุน **ุณูฺฉ ุฌูุงู** (global sync) ูุฌูุฏ ูุฏุงุฑุฏ.

ููุท three sync levels ุฏุงุฑู:

### Level 1) sync ุฏุฑูู warp

โ implicit (ูุงุฒ ูุณุช ุจุฒูุฏ)

### Level 2) sync ุฏุฑูู block

โ `__syncthreads()`

### Level 3) sync ุจู kernelูุง

โ kernel finish = global sync

ุนู:

> ุงฺฏุฑ blockูุง ูุงุฒ ุจู sync ุฏุงุฑูุฏุ
> ุจุงุฏ kernel ุฑุง ุชูุงู ฺฉูุฏ ู kernel ุฌุฏุฏ launch ฺฉูุฏ.

---

# ฑฒ.ท. Memory Fence

CUDA primitiveูุง memory fence ุฏุงุฑุฏ:

```cuda
__threadfence_block();
__threadfence();
```

ฺฉุงุฑุจุฑุฏ:

* ุชุถูู ูโฺฉูุฏ ูููู writeูุง ฺฉุงูู ุดููุฏ
* ูุจู ุงุฒ ุงูฺฉู thread ุงุฏุงูู ุฏูุฏ

ุงูุง ุงู **sync ูุณุช**.

ุงู ููุท ุชุฑุชุจ writeูุง ุฑุง enforce ูโฺฉูุฏ.

---

# ฑฒ.ธ. ุฌูุนโุจูุฏ ูุตู ฑฒ

1. Race Condition = ููุดุชู ููโุฒูุงู ฺูุฏ thread ุฑู ฺฉ ุฎุงููู memory.
2. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุขู ุจุงุฏ ุงุฒ atomicูุง ุงุณุชูุงุฏู ฺฉูุฏ.
3. atomicูุง ุฏุฑุณุช ูู ฺฉูุฏ ูุณุชูุฏ.
4. blockูุง ูุจุงุฏ ุจุง ูู sync ุดููุฏ (design rule).
5. ููุท sync ุงูู ุจู threadูุง ฺฉ block ุงุณุช.
6. warp-level communication ูุงุฒ ุจู sync ูุฏุงุฑุฏ.
7. global sync ููุท ููฺฏุงู ูพุงุงู kernel ูุฌูุฏ ุฏุงุฑุฏ.
8. ุจุฑุง ฺฉุงุฑูุง ูพฺุฏู ุจุงุฏ algorithmูุง ููุงุฒ ุฏุฑุณุช ุงุณุชูุงุฏู ุดูุฏ.

---


---

# ```markdown

# ูุตู ฑณ โ ุชฺฉูฺฉโูุง ูพุดุฑูุชูู CUDA: Occupancyุ Register Tuningุ Launch Bounds ู Performance Tuning

ุฏุฑ ุงู ูุตู ุจู ูุฑุญููโุง ูุงุฑุฏ ูโุดูู ฺฉู ุงฺฉุซุฑ ุจุฑูุงููโููุณุงู CUDA ุญุช ูพุณ ุงุฒ ุณุงูโูุง ุชุฌุฑุจูุ ุฏููุงู ุขู ุฑุง ุฏุฑฺฉ ููโฺฉููุฏ.
ุงู ูุตู ฺฉุงููุงู ูพุดุฑูุชู ุงุณุช ุงูุง ุทูุฑ ุชูุถุญ ุฏุงุฏู ุดุฏู ฺฉู ูุฑ ุฏุงูุดุฌู ุจุชูุงูุฏ ุขู ุฑุง ุจูููุฏ ู ุงุณุชูุงุฏู ฺฉูุฏ.

---

# ฑณ.ฑ. ฺุฑุง ุงู ููุถูุนุงุช ููู ูุณุชูุฏุ

ููุช kernelูุง ุณุงุฏู ูโููุณุฏ (ูุซูุงู vector add)ุ GPU ููุดู ุณุฑุน ุงุณุช.
ุงูุง ููุช:

* shared memory ุฒุงุฏ ูุตุฑู ฺฉูุฏ
* register ุฒุงุฏ ูุตุฑู ฺฉูุฏ
* warp divergence ุงุฌุงุฏ ฺฉูุฏ
* blockูุง ุจุฒุฑฺฏ ุชุนุฑู ฺฉูุฏ

ุฏุฑ ุงู ุตูุฑุช GPU:

* occupancy ฺฉู ูโุดูุฏ
* warp idle ุฒุงุฏ ูโุดูุฏ
* latency hiding ุถุนู ูโุดูุฏ
* throughput ูพุงู ูโุขุฏ

ุงู ูุตู ุจู ุดูุง ุงุฏ ูโุฏูุฏ **ฺฺฏููู GPU ุฑุง ฺฉุงููุงู ูพูุฑ ฺฉูู**.

---


# ฑณ.ฒ. Occupancy ฺุณุชุ (ุชูุถุญ ุนูู ู ุณุงุฏู)
<div dir="rtl">
Occupancy = ุชุนุฏุงุฏ warpูุง ูุนุงู ุฏุฑ ฺฉ SM
ุชูุณู ุจุฑ
ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ warpูุง ููฺฉู
</div>

ูุซุงู:

* ฺฉ SM ูุฑุถ ูโุชูุงูุฏ **ถด warp** ูฺฏู ุฏุงุฑุฏ
* kernel ุดูุง **ณฒ warp** ูุนุงู ุฏุงุฑุฏ
  ูพุณ:

```
occupancy = 32 / 64 = 50%
```

### ฺุฑุง occupancy ููู ุงุณุชุ

ุฒุฑุง warpูุง ูุนุงู:

* ููุช warp A ููุชุธุฑ ุญุงูุธู ุงุณุช
* warp B ุจุงุฏ ุฌุงฺฏุฒู ุดูุฏ

ุงฺฏุฑ warp ุฏฺฏุฑ ููุฌูุฏ ูุจุงุดุฏ โ GPU ุจฺฉุงุฑ ูโุดูุฏ โ ุณุฑุนุช ฺฉู.

ุจูุงุจุฑุงู:

> Occupancy = ุชูุงู GPU ุจุฑุง ูพููุงู ฺฉุฑุฏู latency.

---

# ฑณ.ณ. ฺู ฺุฒูุง occupancy ุฑุง ฺฉุงูุด ูโุฏูุฏุ

ุณู ุนุงูู ุจุณุงุฑ ููู:

---

## ฑ) Register Pressure (ูุตุฑู ุฒุงุฏ ุฑุฌุณุชุฑ)

ูุฑ thread ุชุนุฏุงุฏ ุฑุฌุณุชุฑ ูุตุฑู ูโฺฉูุฏ.
ุฏุฑ V100:

* ูุฑ SM ุญุฏูุฏ **ฒตถ KB** ุฑุฌุณุชุฑ ุฏุงุฑุฏ.

ุงฺฏุฑ kernel ุดูุง ถฐ ุฑุฌุณุชุฑ per thread ูุตุฑู ฺฉูุฏ:

* ุชุนุฏุงุฏ threadูุง ฺฉู SM ูโุชูุงูุฏ ูฺฏู ุฏุงุฑุฏ ฺฉุงูุด ูโุงุจุฏ
* ุฏุฑ ูุชุฌู warpูุง ฺฉูุชุฑ ูุนุงู ุฎูุงููุฏ ุจูุฏ

> kernelูุง ฺฉู 80โ100 ุฑุฌุณุชุฑ ูุตุฑู ูโฺฉููุฏ ูุนูููุงู occupancy ฺฉู ุฏุงุฑูุฏ.

---

## ฒ) Shared Memory Pressure

ุงฺฏุฑ kernel ุดูุง per-block ูุงุฒ ุฏุงุดุชู ุจุงุดุฏ:

```text
shared memory = 64 KB
```

ูู:

* SM ุฏุฑ V100 ููุท 128 KB shared memory ุฏุงุฑุฏ

ูพุณ SM ููุท:

```
2 block ุฏุฑ ุขูู ูุงุญุฏ
```

ูโุชูุงูุฏ ุงุฌุฑุง ฺฉูุฏ.

ุงฺฏุฑ shared memory per-block = 96 KB
โ ููุท **1 block** per SM

ุงู ุนู occupancy ุฎู ูพุงู!

---

## ณ) Block Size ุงูุชุฎุงุจ ูุดุฏู ุฏุฑุณุช

Block size ุจุงุฏ:

* ูุถุฑุจ ุงุฒ 32 ุจุงุดุฏ (ุฏูู: warp = 32 thread)
* ูุนูููุงู ุจู 128 ุชุง 512 ุงูุชุฎุงุจ ูโุดูุฏ
* block ุฎู ฺฉูฺฺฉ โ warp ฺฉู โ occupancy ฺฉู
* block ุฎู ุจุฒุฑฺฏ โ register/shared ุฒุงุฏ ูุตุฑู ูโุดูุฏ โ occupancy ฺฉู

ูพุณ block size ุจููู ููู ุงุณุช.

---

# ฑณ.ด. register spilling ฺุณุชุ

ุงฺฏุฑ kernel ุงุฒ ุฑุฌุณุชุฑ ุฒุงุฏ ุงุณุชูุงุฏู ฺฉูุฏ:

* ฺฉุงููพุงูุฑ ุฑุฌุณุชุฑูุง ุฑุง ุจู **local memory** ุงูุชูุงู ูโุฏูุฏ
* local memory ุฏุฑ ูุงูุน global memory ุงุณุช (ุฎู ฺฉูุฏ)

ุงู ูพุฏุฏู ุฑุง **spilling** ูโฺฏููุฏ.

ูุชุฌูู ุขู:

* latency ุฒุงุฏ
* bandwidth ุจุดุชุฑ
* ฺฉุงูุด ุดุฏุฏ performance

### ฺฺฏููู ุงุฒ spilling ุฌููฺฏุฑ ฺฉููุ

* ุงุณุชูุงุฏู ฺฉูุชุฑ ุงุฒ ุณุงุฎุชุงุฑูุง ุจุฒุฑฺฏ ุฏุฑูู kernel
* ฺฉุงูุด variableูุง ุบุฑ ุถุฑูุฑ
* ุงุฌุชูุงุจ ุงุฒ recursion
* ุงุณุชูุงุฏู ุงุฒ `__restrict__` ุฏุฑ pointerูุง
* ุงุณุชูุงุฏู ุงุฒ launch bounds (ุจุนุฏุงู ฺฏูุชู ูโุดูุฏ)

---

# ฑณ.ต. Launch Bounds ฺุณุชุ

CUDA ูโุชูุงูุฏ ููฺฏุงู ฺฉุงููพุงู kernel ุฑุง optimize ฺฉูุฏ ุงฺฏุฑ ุจุฏุงูุฏ:

* block size ุดูุง ุชูุฑุจุงู ฺูุฏุฑ ุงุณุช
* ุชุนุฏุงุฏ block per SM ฺูุฏุฑ ุงุณุช

ูุซุงู:

```cuda
__launch_bounds__(256, 2)
__global__ void kernel(...) {
    ...
}
```

ูุนู:

* kernel ุจุง block size = 256 ุจูููโุณุงุฒ ุดูุฏ
* ุชุตููุงุช register allocation ุจุง ูุฑุถ ุงูฺฉู ฒ block ุฏุฑ ูุฑ SM ุงุฌุฑุง ูโุดูุฏ ุงูุฌุงู ุดูุฏ

ุงู ุจุงุนุซ ูโุดูุฏ:

* register pressure ฺฉูุชุฑู ุดูุฏ
* occupancy ุจูุชุฑ ุดูุฏ

---

# ฑณ.ถ. ุชูุธู block size (Tuning Strategy)

ูุงูููโูุง ุนูู:

---

### โ Block Size ุชูุตูโุดุฏู:

* **128**
* **256** โ ูุนูููโุชุฑู
* **512** โ ููุงูุน ฺฉู register ฺฉู ูุตุฑู ูโุดูุฏ

ุจุดุชุฑ GPUูุง ุจุง block size = 256 ุนุงู ฺฉุงุฑ ูโฺฉููุฏ (ูุงููู ุชุฌุฑุจ CUDA developers ุฏุฑ NVIDIA).

---

### โ Block Size ูุจุงุฏ ุฎู ฺฉูฺฺฉ ุจุงุดุฏ

ูุซุงู:

```text
blockDim = 32
```

ุงู ุนู ููุท **ฑ warp** per block.

ุงฺฏุฑ ูุฑ block ููุท ฺฉ warp ุฏุงุดุชู ุจุงุดุฏ:

* sync ฺฉุงุฑุง ูุฏุงุฑุฏ
* shared memory ุงุณุชูุงุฏู ููโุดูุฏ
* occupancy ฺฉู ูโุดูุฏ
* ุฒูุงูโุจูุฏ ุจุฏ ูโุดูุฏ

---

### โ Block Size ุฎู ุจุฒุฑฺฏ ูู ุจุฏ ุงุณุช

ูุซุงู:

```text
blockDim = 2048
```

ุงู:

* register pressure ุงุฌุงุฏ ูโฺฉูุฏ
* shared memory per-thread ููฺฉู ุงุณุช ุฒุงุฏ ุดูุฏ
* occupancy ุฑุง ฺฉู ูโฺฉูุฏ

---

# ฑณ.ท. ุงูฺฏูุฑุชูโูุง ุญุฑููโุง ุจุฑุง ุงูุชุฎุงุจ block size

ฑ) ุงุฒ ูพุฑููุงูุฑ NVIDIA Nsight Compute ฺฉูฺฉ ุจฺฏุฑุฏ
ฒ) ุงุฒ occupancy calculator ุงุณุชูุงุฏู ฺฉูุฏ
ณ) block ูุง 256 ู 512 ุฑุง ุงูุชุญุงู ฺฉูุฏ
ด) register usage ุฑุง ุจุฑุฑุณ ฺฉูุฏ
ต) ุงฺฏุฑ register ุฒุงุฏ ุงุณุชุ block size ุฑุง ฺฉุงูุด ุฏูุฏ
ถ) ุงฺฏุฑ latency-bound ูุณุชุฏุ occupancy ุฑุง ุงูุฒุงุด ุฏูุฏ
ท) ุงฺฏุฑ compute-bound ูุณุชุฏุ occupancy ุงููุช ฺฉูุชุฑ ุฏุงุฑุฏ

---

# ฑณ.ธ. ุขุง ููุดู occupancy ุจุงูุง ุฎูุจ ุงุณุชุ

ูู.

GPU ุฏู ุญุงูุช ุฏุงุฑุฏ:

* **Memory-Bound** (ุงฺฉุซุฑุช kernelูุง)
  โ occupancy ุจุงูุง ุจุณุงุฑ ฺฉูฺฉ ูโฺฉูุฏ
  โ latency hiding ููู ุงุณุช

* **Compute-Bound**
  โ occupancy ฺฉู ูู ฺฉุงู ุงุณุช
  โ ฺูู compute units ุงุดุจุงุน ูุณุชูุฏุ memory bottleneck ูุณุช

ูุซุงู compute-bound:

* ูุงุชุฑุณโุถุฑุจ
* Tensor Core kernels
* ุนููุงุช FP16

ุฏุฑ compute-bound kernelsุ occupancy ุญุช 20ูช ูู ฺฉุงู ุงุณุช.

---

# ฑณ.น. Summary of tuning (ููุงูู ุทูุง)

1. block size = 128 ุง 256
2. ุชุง ุฌุง ููฺฉู ุงุฒ shared memory ุงุณุชูุงุฏู ฺฉูุฏ
3. ุงุฒ bank conflict ูพุฑูุฒ ฺฉูุฏ
4. register pressure ุฑุง ฺฉุงูุด ุฏูุฏ
5. divergence ุฑุง ฺฉู ฺฉูุฏ
6. coalesced memory access ุฑุง ุชุถูู ฺฉูุฏ
7. occupancy ุฑุง ุชุง ุญุฏ ููุงุณุจ ุจุงูุง ุจุจุฑุฏ (ูู ูุฒููุงู ุจุดูู)
8. warp-level programming ุฑุง ุชูุฑู ฺฉูุฏ
9. launch bounds ุจุฑุง ฺฉูุชุฑู ุจูุชุฑ ุฑุฌุณุชุฑ ุงุณุชูุงุฏู ฺฉูุฏ
10. ูพุฑููุงู ฺฉุฑุฏู ุฑุง ูุฑุงููุด ูฺฉูุฏ

---

# ูุตู ฑด โ ุฌูุนโุจูุฏ ุนูู ูุนูุงุฑ GPU ู CUDA (ฺฉ ุฏุฏ ฺฉู ู ูููุฏุณ)

ุจุนุฏ ุงุฒ ฑณ ูุตูุ ุงฺฉููู ุขูุงุฏู ูุณุชู ฺฉ ูฺฏุงู ฺฉุงููุงู ูููุฏุณ ู ฺฉูพุงุฑฺู ุจู GPU ู CUDA ุงุฑุงุฆู ฺฉูู.
ุงู ูุตู ุจู ุฏุงูุดุฌู ฺฉูฺฉ ูโฺฉูุฏ ุงู ุณุคุงู ุฑุง ูพุงุณุฎ ุฏูุฏ:

> GPU ุฏููุงู ฺุณุช ู ฺฺฏููู ุจุงุฏ ุจู ุขู ูฺฉุฑ ฺฉููุ

ู ููฺูู:

> CUDA ุฏููุงู ฺุณุช ู ฺฺฏููู ุจุงุฏ ุฑู ุขู ุจุฑูุงููโููุณ ฺฉููุ

---

# ฑด.ฑ. GPU = ูพุฑุฏุงุฒูุฏูู ููุงุฒ ูุจุชู ุจุฑ throughput (ูู latency)

CPU ุทุฑุงุญ ุดุฏู ุจุฑุง:

* latency ฺฉู
* ฺฉูุชุฑู ุฏูู
* ุงุฌุฑุง branching
* ุนููุงุช ูพฺุฏู
* pipeline ุนูู
* cacheโูุง ุจุฒุฑฺฏ ู ูพฺุฏู

GPU ุทุฑุงุญ ุดุฏู ุจุฑุง:

* throughput ุจุงูุง
* ุนููุงุช ุชฺฉุฑุงุฑ ุฑู ุฏุงุฏูโูุง ุฒุงุฏ
* latency hiding
* ุงุฌุฑุง ููุงุฒ ุนุธู
* branch ฺฉู
* pipeline ฺฉูโุนูู
* shared memory ูุงุจู ุจุฑูุงููโุฑุฒ

ูพุณ:

> GPU ฺฉ CPU ุจุฒุฑฺฏ ูุณุช.
> GPU ฺฉ ุณุณุชู massively-parallel ุงุณุช.

---

# ฑด.ฒ. SPMD: ูุฏู ุจุฑูุงููโููุณ ูุดุชุฑฺฉ CPU ู GPU

ISPC ุฑู CPU ู CUDA ุฑู GPU **ูุฑ ุฏู SPMD ูุณุชูุฏ**.

* ฺฉ ุจุฑูุงูู ููุดุชู ูโุดูุฏ
* ูุฒุงุฑุงู ูุณุฎูู ูุณุชูู ุงุฒ ุจุฑูุงูู ุฑู ุฏุงุฏูโูุง ูุฎุชูู ุงุฌุฑุง ูโุดูุฏ
* CPU ุขู ุฑุง ุจุง SIMD ุงุฌุฑุง ูโฺฉูุฏ
* GPU ุขู ุฑุง ุจุง SIMT ุงุฌุฑุง ูโฺฉูุฏ

ุฏุฑ ูุงูุน:

| CPU                            | GPU                              |
| ------------------------------ | -------------------------------- |
| SPMD โ SIMD                    | SPMD โ SIMT                      |
| program instances = SIMD lanes | program instances = threads/warp |

---

# ฑด.ณ. Warp = ูุณุชูู ุงุฌุฑุง GPU

warp:

* 32 thread
* ูุงุญุฏ ุงุฌุฑุง ูุงูุน
* ููู ฺฉ ุฏุณุชูุฑ ุฑุง ููุฑุงู ุงุฌุฑุง ูโฺฉููุฏ
* divergence ุจุฏ ุงุณุช
* shuffle ุณุฑุน ุงุณุช
* vote ุจุฑุง ุนููุงุช ููุทู ูุดุชุฑฺฉ ุงุณุช

Warp ูููโุชุฑู ููููู ุฏุฑ GPU ุงุณุช.

---

# ฑด.ด. ุญุงูุธู ุฏุฑ GPU: ูููโุชุฑู ุนุงูู performance

ุฏุฑ GPU:

* compute ูุฑุงูุงู ุงุณุช
* memory ูุญุฏูุฏุช ุฏุงุฑุฏ
* latency ุฒุงุฏ ุงุณุช
* bandwidth ุจุณุงุฑ ุฒุงุฏ (HBM2 โ 900GB/s ุฏุฑ V100)
* ูู ฺฉุงู ูุณุช

ูพุณ ุจุฑูุงููโููุณ ุจุงุฏ:

* coalesced access ุฏุงุดุชู ุจุงุดุฏ
* shared memory ุงุณุชูุงุฏู ฺฉูุฏ
* reuse ุฏุงุฏู ุฑุง ุจู ุญุฏุงฺฉุซุฑ ุจุฑุณุงูุฏ
* ุงุฑุชุจุงุท warp ุจู warp shuffle ุงูุฌุงู ุฏูุฏ
* ุงุฒ bank conflict ุฌููฺฏุฑ ฺฉูุฏ
* ุงุฒ atomicูุง ุฏุฑ ุญุฏ ูุงุฒู ุงุณุชูุงุฏู ฺฉูุฏ
* syncูุง ุบุฑุถุฑูุฑ ุฑุง ุญุฐู ฺฉูุฏ

---

# ฑด.ต. Scheduler GPU: ููุจ ูพููุงูโุณุงุฒ latency

SM:

* warpูุง ุขูุงุฏู ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ
* warpูุง ููุชุธุฑ ุฑุง ฺฉูุงุฑ ูโฺฏุฐุงุฑุฏ
* warpูุง ุฌุฏุฏ ุฑุง ูุงุฑุฏ ุตู ูโฺฉูุฏ
* ุงู ุนูู ุฏุฑ ฺฉ clock cycle ุงูุฌุงู ูโุดูุฏ

GPU scheduling ุจุณุงุฑ lightweight ุงุณุช.
ุฏุฑ CPUุ context switch ูุฒูู ุฏุงุฑุฏุ
ุฏุฑ GPU ุชูุฑุจุงู ุตูุฑ ุงุณุช.

ูพุณ:

> ูพููุงูโุณุงุฒ latency ุฑูุฒ ููููุช GPU ุงุณุช.

---

# ฑด.ถ. Shared Memory: L1 ูุงุจู ุจุฑูุงููโุฑุฒ

shared memory:

* ุณุฑุนโุชุฑ ุงุฒ DRAM
* ุณุฑุนโุชุฑ ุงุฒ global
* ูุงุจู ุจุฑูุงููโุฑุฒ
* ุจุฑุง tiling ุนุงู ุงุณุช
* ุจุฑุง convolutionุ matrix multiplyุ stencilุ reduction ุญุงุช ุงุณุช

ุงูุง:

* bank conflict ููฺฉู ุงุณุช ุฑุฎ ุฏูุฏ
* ุณุงุฒ ูุญุฏูุฏ ุงุณุช
* shared per-block occupancy ุฑุง ูุญุฏูุฏ ูโฺฉูุฏ

---

# ฑด.ท. CUDA design ุฏุฑ ฺฉ ุฌููู

> CUDA blockูุง ุฑุง **ฺฉุงููุงู ูุณุชูู** ุทุฑุงุญ ูโฺฉูุฏ
> ุชุง GPU ุจุชูุงูุฏ ุขูโูุง ุฑุง ุขุฒุงุฏุงูู ุฑู SMูุง ุฒูุงูโุจูุฏ ฺฉูุฏ
> ู kernel ุฑู GPUูุง ูุฎุชูู ุจุฏูู ุชุบุฑ ุงุฌุฑุง ุดูุฏ.

ุงู ููุณููู ุทุฑุงุญ CUDA ุงุณุช.

---

# ฑด.ธ. ููุงุณูู ููุง CPU vs GPU (ูฺฏุงู ูููุฏุณ)

### CPU:

* ุชุนุฏุงุฏ ูุณุชู ฺฉู
* cache ุจุฒุฑฺฏ
* latency ฺฉู
* branching ูู
* pipeline ูพฺุฏู
* SIMD ูุญุฏูุฏ
* throughput ฺฉู

### GPU:

* ุชุนุฏุงุฏ ูุณุชู ุฒุงุฏ
* cache ฺฉู (ุงูุง shared memory ุฒุงุฏ)
* latency ุฒุงุฏ (ุงูุง ูพููุงูโุณุงุฒ ุฎูุจ)
* branching ฺฉูุฏ
* ุชุนุฏุงุฏ thread ุฒุงุฏ
* throughput ุจุณุงุฑ ุจุงูุง

---

# ฑด.น. ูุทุงูุนูู ุจุดุชุฑ โ ูฺู (ฺฏูุชูู ูุนุฑูู ุฏุฑ ุฏูุง CUDA!)

ุฏุฑ NVIDIA ฺฉ ูููโููู ุทูุฒ ูุฌูุฏ ุฏุงุฑุฏ:

> "CUDA programmers believe in **throughput over latency**."

ุนู:

* ุณุฑุนุช ุฎุงู GPU ุงุฒ ูุฌููุน ุณุฑุนุช ฺูุฏู CPU ุจุณุงุฑ ุจุดุชุฑ ุงุณุช
* ุญุช ุงฺฏุฑ latency ูุฑ load ุฒุงุฏ ุจุงุดุฏ
* warp scheduler ุจูโูุฏุฑ warp ุฏุงุฑุฏ ฺฉู ูฺโููุช ููุชุธุฑ ููโูุงูุฏ

ุงู ุชูุงูุช ููุณู ฺฉูุฏ ุฏุฑฺฉ CUDA ุงุณุช.

---

# ฑด.ฑฐ. ูุชุฌูู ฺฉู ุฏุฑุณ (ุงุฒ ูุตู ฑ ุชุง ฑด)

ุงฺฏุฑ ุงู ฑด ูุตู ุฑุง ูููุฏู ุจุงุดุฏ:

* ุชูุงูุช latency ู bandwidth ุฑุง ูโูููุฏ
* locality ู reuse ุฏุงุฏู ุฑุง ูโุดูุงุณุฏ
* ISPC ุฑุง ูโูููุฏ
* GPU ุฑุง ุงุฒ ุณุทุญ SM ู warp ุฏุฑฺฉ ฺฉุฑุฏูโุงุฏ
* ุชูุงูุช SIMD/SIMT ุฑุง ูโูููุฏ
* ูโุฏุงูุฏ warp ฺฺฏููู ุงุฌุฑุง ูโุดูุฏ
* coalescingุ shared memoryุ bank conflict ุฑุง ูโุดูุงุณุฏ
* occupancyุ register pressure ุฑุง ุชุญูู ูโฺฉูุฏ
* ูโุชูุงูุฏ kernelูุง CUDA ุฑุง ุจููู ฺฉูุฏ
* ูโุชูุงูุฏ ูุงููุฏ ฺฉ ูููุฏุณ NVIDIA ูฺฉุฑ ฺฉูุฏ

ุงู ุณุทุญ ุฏุฑุณ ุชูุฑุจุงู ูุนุงุฏู ฺฉ ุฏุฑุณ ฺฉุงูู **GPU Programming** ุฏุฑ ุฏุงูุดฺฏุงูโูุง ุจุฑุชุฑ (Stanford, CMU, UIUC) ุงุณุช.

---


---

# ```markdown

# ูุตู ฑต โ ููุงุณูู ุนูู ISPC ู CUDA: ุงุฌุฑุง SPMD ุฑู CPU vs GPU

ุฏุฑ ุงู ูุตูุ ูโุฎูุงูู ุนููุงู ุจูููู:

* ฺุฑุง ISPC (SPMD ุฑู CPU) ููุฏ ุงุณุชุ
* ฺุฑุง CUDA (SPMD ุฑู GPU) ฺูุฏู ุจุฑุงุจุฑ ุณุฑุนโุชุฑ ุงุณุชุ
* ุชูุงูุช ุณุงุฎุชุงุฑ ุจู CPU ู GPU ฺุณุชุ
* ุชูุงูุช SIMD vs SIMT ฺุณุชุ
* ฺูโฺุฒูุง ุฏุฑ ISPC ุดุจู CUDA ุงุณุชุ ู ฺูโฺุฒูุง ฺฉุงููุงู ูุชูุงูุชุ
* ฺู ุงูฺฏูุฑุชูโูุง ุจุฑุง CPU ุจูุชุฑูุฏุ ู ฺู ุงูฺฏูุฑุชูโูุง ุจุฑุง GPUุ
* ฺุฑุง ISPC ููโุชูุงูุฏ ุจู ุงูุฏุงุฒูู CUDA ุณุฑุน ุจุงุดุฏุ

---

# ฑต.ฑ. ISPC ู CUDA ูุฑ ุฏู SPMD ูุณุชูุฏ

ุฏุฑ ูุฏู SPMD:

* ฺฉ ุจุฑูุงูู ููุดุชู ูโุดูุฏ
* ฺูุฏู ูุณุฎูู ูุณุชูู ุงุฒ ุจุฑูุงูู ุฑู ุฏุงุฏูโูุง ูุฎุชูู ุงุฌุฑุง ูโุดูุฏ
* ูุฑ ูุณุฎู ุฑุง ฺฉ "program instance" ุง "thread" ูุฑุถ ฺฉูุฏ

ุฏุฑ ISPC:

* program instance = lane SIMD
* execution unit = ุขุฏุฑุณโุฏู SIMD
* mask = ุชุนู threadูุง ูุนุงู
* gang = ูุฌููุนูู laneูุง

ุฏุฑ CUDA:

* program instance = thread
* execution unit = warp (SIMT)
* warp ุนู laneูุง ูุงูุน GPU

### ูุชุฌูู ููู:

> ูุฏู ุจุฑูุงููโููุณ ุดุจู ุงุณุชุ
> ุงูุง **ุณุฎุชโุงูุฒุงุฑ ุฒุฑ ุขูโูุง ุฒูู ุชุง ุขุณูุงู ูุชูุงูุช ุงุณุช**.

---

# ฑต.ฒ. ุชูุงูุช ุงุตู: SIMD vs SIMT

| ููููู                    | ISPC / CPU                               | CUDA / GPU                                  |
| ------------------------ | ---------------------------------------- | ------------------------------------------- |
| ูุฏู ุงุฌุฑุง               | SIMD (Single Instruction, Multiple Data) | SIMT (Single Instruction, Multiple Threads) |
| abstraction              | program instance = lane                  | thread = ููุฌูุฏุช ูุณุชูู                      |
| masking                  | mask-based SIMD execution                | warp divergence + masks                     |
| ุฑุฌุณุชุฑ                   | ูุญุฏูุฏ                                    | ุจุณุงุฑ ุฒุงุฏ                                  |
| ุชุนุฏุงุฏ parallel instances | ุญุฏูุฏ 4โ16                                | ุญุฏูุฏ 1024โ200K                              |
| ูพููุงูโุณุงุฒ latency       | ุณุฎุช                                      | ุจุณุงุฑ ูุคุซุฑ (warp switching)                 |
| branch                   | ฺฉูุฏ ุงูุง ูุงุจู ูุฏุฑุช                      | warp divergence โ ฺฉูุฏ ุฒุงุฏ                 |
| ุณุฑุนุช ุญุงูุธู               | ฺฉู (ุฏูโูุง GB/s)                          | ุจุณุงุฑ ุจุงูุง (ุตุฏูุง GB/s)                      |

ุฏุฑ ISPCุ SIMD ุจู ูุนูุง:

* laneูุง ูุฏุงุชโฺฉููุฏูู ฺฉ ุฏุณุชูุฑ ูุณุชูุฏ
* SIMD ฺฉ ุฑุฌุณุชุฑ 256 ุง 512 ุจุช ุงุณุช
* pipeline SIMD ฺฉูโุชุนุฏุงุฏ ุงุณุช

ุฏุฑ CUDAุ SIMT ุจู ูุนูุง:

* threadูุง abstraction ูุณุชูู ุฏุงุฑูุฏ
* warpูุง ุจุง ุงุฌุฑุง ููุงุฒ laneูุง ุณุงุฎุชู ุดุฏูโุงูุฏ
* warp ูพููุงูโุณุงุฒ latency ุงูุฌุงู ูโุฏูุฏ
* ูุฒุงุฑุงู warp ูุนุงู ูโูุงููุฏ

---

# ฑต.ณ. ุชูุงูุช ุฏุฑ ุญุงูุธู: DRAM vs HBM2

| ูฺฺฏ ุญุงูุธู   | CPU         | GPU                            |
| ------------- | ----------- | ------------------------------ |
| ููุน ุญุงูุธู     | DDR4/DDR5   | HBM2/HBM3                      |
| ูพููุงโุจุงูุฏ    | 20โ50 GB/s  | 500โ2000 GB/s                  |
| latency       | ูพุงูโุชุฑ    | ุจุงูุงุชุฑ ูู ูพููุงูโุดุฏู           |
| ุณุงุณุช caching | ูพฺุฏู      | ูุญุฏูุฏุชุฑ ุงูุง shared memory ุณุฑุน |
| locality      | ุจุณุงุฑ ุญุงุช | ูููโุงูุนุงุฏู ุญุงุช               |

CPU:

* ูพููุงโุจุงูุฏ ฺฉู
* latency ูุณุจุชุงู ูพุงู
* cache ุนูู ู ููุดููุฏ

GPU:

* ูพููุงโุจุงูุฏ ูุฌูู
* latency ุฒุงุฏ โ ูู warp switching ุขู ุฑุง ุญู ูโฺฉูุฏ
* shared memory ุจูโุนููุงู L1 ูุงุจู ุจุฑูุงููโุฑุฒ ุฏุงุฑุฏ

ุงู ฺฉ ุงุฒ ูููโุชุฑู ุฏูุงู ุณุฑุนุช CUDA ุงุณุช:

> GPU ฺูุฏู ุจุฑุงุจุฑ ูพููุงโุจุงูุฏ ุญุงูุธูู CPU ุฑุง ุฏุงุฑุฏ
> ู ุขู ุฑุง ุจุง coalescing ู shared memory ูุฏุฑุช ูโฺฉูุฏ.

---

# ฑต.ด. ุชูุงูุช ุฏุฑ ุชุนุฏุงุฏ Thread / Instance

ุฏุฑ ISPC:

* ุจุฑูุงูู ูุนูููุงู 4 ุชุง 16 instance ููโุฒูุงู ุงุฌุฑุง ูโฺฉูุฏ
* ุจุง ุงุณุชูุงุฏู ุงุฒ AVX2 ุง AVX-512

ุฏุฑ CUDA:

* ฺฉ kernel โ ูุฒุงุฑุงู block โ ููููโูุง thread
* ูุฒุงุฑุงู warp ูุนุงู
* ุตุฏูุง block ุฏุฑ ุตู scheduler
* GPU ุจุทูุฑ ุทุจุน ุจุฑุง parallelism ูุณุน ุทุฑุงุญ ุดุฏู

ูุซุงู:

* CPU โ 16lane ร 8core = 128 instance
* GPU V100 โ 80 SM ร 64 warp ร 32 thread = **163,840 thread ูุนุงู**

ุชูุงูุช **ุณู ูุฑุชุจู ุจุฒุฑฺฏ** ุงุณุช!

---

# ฑต.ต. ูุชุฌูู ุงู ุชูุงูุช ุฏุฑ ุงูฺฏูุฑุชูโูุง

| ููุน ุงูฺฏูุฑุชู                               | ููุงุณุจ CPU/ISPC | ููุงุณุจ CUDA/GPU  |
| ------------------------------------------ | -------------- | --------------- |
| ุดุงุฎูโูุง ุฒุงุฏ (branchy code)               | ุนุงู           | ุถุนู            |
| ูพุฑุฏุงุฒุด ุณุงุฎุชุงุฑ ุฏุงุฏูู ูพฺุฏู (trees, graphs) | ุนุงู           | ุถุนู/ูุชูุณุท      |
| ุญูููโูุง ุชุฑุชุจ ฺฉูฺฺฉ                       | ุณุฑุน           | ููโฺูุฏุงู ฺฉุงุฑุขูุฏ |
| ุนููุงุช massively parallel                  | ุฎูุจ            | ูููโุงูุนุงุฏู      |
| ูุงุชุฑุณโุถุฑุจ                                 | ุฎูุจ            | ุจุณุงุฑ ุณุฑุน      |
| ูพุฑุฏุงุฒุด ุชุตูุฑ                               | ุฎูุจ            | ุจุณุงุฑ ุณุฑุน      |
| convolution                                | ูุชูุณุท          | ุนุงู            |
| vector add                                 | ุฎูุจ            | ุจุณุงุฑ ุณุฑุน      |
| reduction                                  | ุฎูุจ            | ุนุงู            |
| ุดุจูโุณุงุฒ ุนูู                             | ูุชูุณุท          | ุจุณุงุฑ ุนุงู      |

---

# ฑต.ถ. ฺุฑุง CUDA ูุนูููุงู ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุฒ ISPC ุงุณุชุ

ุฏูุงู ูุงูุน:

### ฑ) GPU threadูุง ุจุณุงุฑ ุฒุงุฏ ุฏุงุฑุฏ

โ latency ูพููุงู ูโุดูุฏ
โ ูููู ALUูุง ููุดู ูุดุบููโุงูุฏ

### ฒ) GPU ูพููุงโุจุงูุฏ ุจุงูุง ุฏุงุฑุฏ

โ ููุงุณุจ ุจุฑุง ุจุฑูุงููโูุง data-parallel

### ณ) ูุณุชูโูุง GPU ฺฉูฺฺฉ ู ูุฑุงูุงูโุงูุฏ

โ scale ุจูุชุฑ

### ด) shared memory ูุฌูุฏ ุฏุงุฑุฏ

โ locality ุฏุณุช ุจุฑูุงููโููุณ ุงุณุช

### ต) scheduling ุจุณุงุฑ ุณุจฺฉ

โ ฺฉุงูุชฺฉุณุช ุณูฺ ุงุฒ CPU 100x ุณุฑุนโุชุฑ

### ถ) warp-level parallelism

โ ุงุฑุชุจุงุท threadูุง ุจุณุงุฑ ุณุฑุน

### ท) ุงูฺฏูุฑุชูโูุง ูุงุจู ุชูุณู ุจู ุจูุงฺฉ/ูุงุฑูพ ูุณุชูุฏ

---

# ฑต.ท. ุดุจุงูุชโูุง: ฺุฑุง ISPC ุดุจู CUDA ุงุณุชุ

* ูุฑ ุฏู ุงุฒ SPMD ุงุณุชูุงุฏู ูโฺฉููุฏ
* ูุฑ ุฏู programIndex ุฏุงุฑูุฏ
* ูุฑ ุฏู divergence ุฏุงุฑูุฏ
* ูุฑ ุฏู reduce_add/shuffle ุฏุงุฑูุฏ
* ูุฑ ุฏู ุฑูุชุงุฑ mask-based ุฏุงุฑูุฏ
* ูุฑ ุฏู locality ุฑุง ุญุงุช ูโุฏุงููุฏ
* ูุฑ ุฏู memory-bound ูโุดููุฏ

ISPC:

```
foreach (i in 0..N) 
    y[i] = f(x[i]);
```

CUDA:

```
__global__ kernel(...)
{
    int i = ...;
    y[i] = f(x[i]);
}
```

ุดุจุงูุช ุธุงูุฑ: ุฒุงุฏ
ุดุจุงูุช ูุนูุงุฑ: ฺฉู
ุณุฑุนุช: GPU ุฏูโูุง ุจุฑุงุจุฑ ุณุฑุนโุชุฑ

---

# ฑต.ธ. ุฌูุนโุจูุฏ ูุตู ฑต (Essence)

1. ISPC ู CUDA ูุฑ ุฏู ูุจุชู ุจุฑ SPMD ูุณุชูุฏ.
2. CPU = SIMD + cache ูู + latency ฺฉู
3. GPU = SIMT + warp switching + latency hiding
4. GPU = ูพููุงโุจุงูุฏ ุจุณุงุฑ ุจุฒุฑฺฏ
5. GPU = parallelism ุนุธู
6. CUDA = ุจูุชุฑู ูุฏู ุจุฑุง data-parallel
7. ISPC = ุจูุชุฑู ุฑูุด ุจุฑุง ุงุณุชูุงุฏู ุงุฒ SIMD CPU
8. GPU โ CPU ุจุฒุฑฺฏุ GPU ูุนูุงุฑ ฺฉุงููุงู ูุชูุงูุช ุฏุงุฑุฏ

ุฏุฑฺฉ ุงู ุชูุงูุชโูุง ุจุฑุง ุทุฑุงุญ ุงูฺฏูุฑุชู ุถุฑูุฑ ุงุณุช.

---

# ูุตู ฑถ โ ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ ฺฉุงูู: ุงุฒ ุชุฆูุฑ ุจู ุนูู

ุฏุฑ ุงู ูุตู ฺฉุฏูุง ูุงูุน ูโููุณู ู:

* ุขููุง ุฑุง ุชุญูู ูโฺฉูู
* warp behavior ุฑุง ุจุฑุฑุณ ูโฺฉูู
* ุงูฺฏููุง ุญุงูุธู ุฑุง ุชุญูู ูโฺฉูู
* ูุณุฎูู naรฏve ุฑุง ุจู ูุณุฎูู ุจููู ุชุจุฏู ูโฺฉูู
* ููุงูู shared memoryุ coalescingุ warp shuffleุ occupancy ุงุณุชูุงุฏู ูโุดูุฏ

ุงู ุจุฎุด ุจุฑุง ุชูุฑู ุฏุงูุดุฌูุงู ุนุงู ุงุณุช.

---

# ฑถ.ฑ. ูุซุงู ฑ โ Reduction (ุฌูุน ฺฉ ุขุฑุงู)

## ูุณุฎูู naรฏve

```cuda
__global__
void reduce_naive(float *in, float *out, int N) {
    int i = blockIdx.x * blockDim.x + threadIdx.x;

    if (i < N) atomicAdd(out, in[i]);
}
```

### ูุดฺฉูุงุช:

* atomicAdd ุจุฑุง ูุฑ thread โ ุจุณุงุฑ ฺฉูุฏ
* warp divergence
* bandwidth ูุฏุฑ ูโุฑูุฏ
* scalability ฺฉู

---

## ูุณุฎูู advanced ุจุง warp shuffle

```cuda
__inline__ __device__
float warpReduceSum(float val)
{
    for (int offset = 16; offset > 0; offset /= 2)
        val += __shfl_down_sync(0xffffffff, val, offset);
    return val;
}

__global__
void reduce_optimized(float *in, float *out, int N)
{
    float sum = 0.0f;
    int idx = blockIdx.x * blockDim.x + threadIdx.x;

    // ุฌูุน ูุญู ูุฑ thread
    if (idx < N) sum = in[idx];

    // ุฌูุน ูุฑ warp
    sum = warpReduceSum(sum);

    // ููุท lane ุตูุฑ ุงุฒ ูุฑ warp ุฏุฑ shared memory ุจููุณุฏ
    static __shared__ float shared[32];  // ุญุฏุงฺฉุซุฑ 32 warp

    int warpId = threadIdx.x / 32;
    if ((threadIdx.x % 32) == 0)
        shared[warpId] = sum;

    __syncthreads();

    // Warp 0 ูููู warpูุง ุฑุง ุฌูุน ูโฺฉูุฏ
    if (warpId == 0) {
        sum = (threadIdx.x < (blockDim.x / 32)) ? shared[threadIdx.x] : 0.0f;
        sum = warpReduceSum(sum);

        if (threadIdx.x == 0)
            atomicAdd(out, sum);
    }
}
```

### ูุฒุชโูุง:

* atomic ููุท ฑ ุจุงุฑ per block
* ุงุฑุชุจุงุท warp ุงุฒ shuffle
* shared memory ุจุฑุง ุงุฑุชุจุงุท warpูุง
* coalesced load
* performance ุนุงู

---

# ฑถ.ฒ. ูุซุงู ฒ โ Convolution 1D (shared memory tiling)

## ูุณุฎูู naรฏve:

```cuda
output[i] = input[i] + input[i+1] + input[i+2];
```

### ูุดฺฉูุงุช:

* 3 Load per thread
* bandwidth-bound
* latency ุฒุงุฏ

---

## ูุณุฎูู ุจููู:

```cuda
__global__
void convolve(float *input, float *output, int N)
{
    __shared__ float tile[128+2];

    int i = blockIdx.x * 128 + threadIdx.x;

    // ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ุจู ุตูุฑุช coalesced
    tile[threadIdx.x] = input[i];

    // ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ุงุถุงู
    if (threadIdx.x < 2)
        tile[128 + threadIdx.x] = input[i + 128];

    __syncthreads();

    output[i] = tile[threadIdx.x] +
                 tile[threadIdx.x + 1] +
                 tile[threadIdx.x + 2];
}
```

### ุจูุจูุฏ:

* loadูุง ููุท 130 ุจุงุฑ ูุณุชูุฏ (ุจูโุฌุง 384)
* ุณู ุจุฑุงุจุฑ ุณุฑุนโุชุฑ
* coalesced access
* shared memory reuse
* occupancy ููุงุณุจ

---

# ฑถ.ณ. ูุซุงู ณ โ Matrix Multiply (ูุณุฎูู ุณุงุฏู)

```cuda
__global__
void matmul(float* A, float* B, float* C, int N)
{
    int row = blockIdx.y * blockDim.y + threadIdx.y;
    int col = blockIdx.x * blockDim.x + threadIdx.x;

    float acc = 0;
    for (int k = 0; k < N; k++)
        acc += A[row * N + k] * B[k * N + col];

    C[row * N + col] = acc;
}
```

### ูุดฺฉู:

* ูุฑ thread N ุจุงุฑ load ูโฺฉูุฏ
* ุจุณุงุฑ bandwidth-bound
* ฺฉุงุฑุง ูพุงู

---

# ฑถ.ด. ูุณุฎูู ุจูููู Matrix Multiply ุจุง shared memory

```cuda
#define TILE 16

__global__
void matmul_tiled(float *A, float *B, float *C, int N)
{
    __shared__ float As[TILE][TILE];
    __shared__ float Bs[TILE][TILE];

    int tx = threadIdx.x;
    int ty = threadIdx.y;
    int row = blockIdx.y * TILE + ty;
    int col = blockIdx.x * TILE + tx;

    float acc = 0;

    for (int t = 0; t < N/TILE; t++) {
        As[ty][tx] = A[row*N + t*TILE + tx];
        Bs[ty][tx] = B[(t*TILE + ty)*N + col];
        __syncthreads();

        for (int k = 0; k < TILE; k++)
            acc += As[ty][k] * Bs[k][tx];

        __syncthreads();
    }

    C[row*N + col] = acc;
}
```

### ูุฒุชโูุง:

* ฺฉุงูุด load ุงุฒ N โ N/TILE
* reuse ุดุฏุฏ shared memory
* coalesced access
* ุณุฑุนุช 10x ุชุง 20x ุจุดุชุฑ

---

# ฑถ.ต. ูุซุงู ด โ Histogram (ุฏุฑุณุช ู ุงูู ุจุง atomic)

```cuda
__global__
void histogram(unsigned char *data, int *hist, int N)
{
    int i = blockIdx.x * blockDim.x + threadIdx.x;

    if (i < N)
        atomicAdd(&hist[data[i]], 1);
}
```

### ูฺฉุชู:

* atomic ูุงุฒู ุงุณุช
* shared memory ูโุชูุงูุฏ ุณุฑุนุช ุฑุง ุงูุฒุงุด ุฏูุฏ
* block-level histogram โ ุณูพุณ reduction

---

# ฑถ.ถ. ูุซุงู ต โ Scan (prefix sum) ุจุง warp-level

CUDA ูุณุฎูู ุญุฑููโุง ุงู ุงูฺฏูุฑุชู ุฑุง ุจุฑ ูพุงูู warp shuffle ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ.
(ุฌุฒุฆุงุช ฺฉุงูู scan ูโุชูุงูุฏ ฒต+ ุฎุท ุชูุถุญ ูุงุฒ ุฏุงุดุชู ุจุงุดุฏุ ุงูุฌุง ูุฏู ุณุงุฏู ุขูุฑุฏู ุดุฏู)

```cuda
__inline__ __device__
int warpScan(int val)
{
    for (int offset = 1; offset < 32; offset *= 2)
    {
        int y = __shfl_up_sync(0xffffffff, val, offset);
        if (threadIdx.x >= offset) val += y;
    }
    return val;
}
```

ุงู ุงูฺฏูุฑุชู ฺฉ ุงุฒ ูููโุชุฑู primitives ุฏุฑ CUDA ุงุณุช.

---

# ฑถ.ท. ุฌูุนโุจูุฏ ูุตู ฑถ

ุฏุฑ ุงู ูุตู ฺูุฏ ุชฺฉูฺฉ ฺฉูุฏ ุฑุง ุจุง ูุซุงูโูุง ฺฉุงูู ุงุฏ ฺฏุฑูุชู:

* reduction ุญุฑููโุง ุจุง warp shuffle
* convolution ุจุง shared memory
* ูุงุชุฑุณโุถุฑุจ ูพุดุฑูุชู (tiling)
* histogram ุจุง atomic
* scan ุจุง warp shuffle
* ุงูฺฏููุง coalescing
* warp-level programming
* shared memory reuse

ุงูโูุง ูุณุชูู ุงุตู **CUDA ุญุฑููโุง** ูุณุชูุฏ.

---



---

# ```markdown

# ูุตู ฑท โ ุชูุฑูโูุง ุนูู ููู (ุจุฑุง ุชููุช ููุงุฑุช CUDA ู ูุนูุงุฑ GPU)

ุฏุฑ ุงู ูุตู ูุฌููุนูโุง ุงุฒ ุชูุฑูโูุง ุนูู ุขูุฑุฏู ุดุฏู ุงุณุช ฺฉู ุฏููุงู ูุทุงุจู ุจุง ุงุณุชุงูุฏุงุฑุฏูุง ุฏุงูุดฺฏุงูโูุง ุจุฑุชุฑ (Stanford, CMU, MIT, UIUC) ุทุฑุงุญ ุดุฏูโุงูุฏ. ุงู ุชูุฑูโูุง ุจู ุฏุงูุดุฌู ฺฉูฺฉ ูโฺฉููุฏ:

* ุงุฏฺฏุฑ ุฑุง ุชุซุจุช ฺฉูุฏ
* ุชูุงูุง ุชุญูู performance ูพุฏุง ฺฉูุฏ
* ูููููโูุง warp, block, shared memory ุฑุง ุฏุฑ ุนูู ุจุจูุฏ
* ุชูุงูุช ูุณุฎูู naรฏve ุจุง optimized ุฑุง ุงุญุณุงุณ ฺฉูุฏ

---

# ฑท.ฑ. ุชูุฑู ฑ โ ุชุญูู Coalescing ุฑู ฺฉ Kernel ุณุงุฏู

### ูุณุฆูู:

ฺฉุฏ ุฒุฑ ุฑุง ุฏุฑ CUDA ุจููุณุฏ ู ุงุฌุฑุง ฺฉูุฏ:

```cuda
__global__
void copyKernel(float *in, float *out)
{
    int i = blockIdx.x * blockDim.x + threadIdx.x;
    out[i] = in[i];
}
```

### ูุธุงู:

1. ุงุฌุฑุง kernel ุฑู ุงูุฏุงุฒูโูุง ูุฎุชูู N
2. ุงูุฏุงุฒูโฺฏุฑ bandwidth ูุงูุน
3. ุณูพุณ ุชุบุฑ ุงูฺฏู ุจู:

```cuda
out[i] = in[i * stride];
```

ูStride ุฑุง ุงุฒ 1 ุชุง 32 ุชุบุฑ ุฏูุฏ.

### ูุฏู:

* ูุดุงูุฏูู ูุณุชูู failure coalescing
* ุงูุฏุงุฒูโฺฏุฑ ฺฉุงูุด bandwidth
* ุชุญูู ุชูุงูุช ุงูฺฏููุง ุฏุณุชุฑุณ

---

# ฑท.ฒ. ุชูุฑู ฒ โ ููุดุชู Reduction ุณู ูุณุฎูโุง

ฑ) ูุณุฎูู naรฏve ุจุง atomicAdd
ฒ) ูุณุฎูู block-level ุจุง shared memory
ณ) ูุณุฎูู warp-level ุจุง __shfl_down_sync

### ูุฏู:

* ุฏุฑฺฉ ฺฉุงูุด ุงุณุชูุงุฏู ุงุฒ atomic
* ุฏุฏู ุชูุณู reduction ุจู warp ู block
* ููุงุณูู performance ูุณุฎูโูุง

---

# ฑท.ณ. ุชูุฑู ณ โ ฺฉุงููููุดู ุจุง Shared Memory

### ูุฑุงุญู:

1. ูพุงุฏูโุณุงุฒ naรฏve convolution
2. ุจูููโุณุงุฒ ฺฉุงูู shared memory
3. ุฌููฺฏุฑ ุงุฒ bank conflict
4. ุงุณุชูุงุฏู ุงุฒ tiling 1D ุง 2D
5. ุจุฑุฑุณ occupancy

### ูุฏู:

* ูุดุงูุฏูู 3xโ10x speedup
* ุฏุฑฺฉ deep locality reuse

---

# ฑท.ด. ุชูุฑู ด โ ุชุญูู Warp Divergence

ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```cuda
if (i % 2 == 0)
    out[i] = x[i] * 2.0f;
else
    out[i] = x[i] + 3.0f;
```

ู ุณูพุณ ุดุฑุท ุฑุง ุชุบุฑ ุฏูุฏ:

* ุชุตุงุฏู
* ูุงุจุณุชู ุจู ููุฏุงุฑ
* warp-uniform
* warp-divergent

### ูุฏู:

* ุฏุฏู ุชุฃุซุฑ ูุณุชูู divergence
* ุชุญูู warp execution mask

---

# ฑท.ต. ุชูุฑู ต โ Matrix Multiply ุจุง ุณู ุณุทุญ ุจูููโุณุงุฒ

ฑ) ูุณุฎูู ุณุงุฏู (O(Nยณ) naรฏve)
ฒ) ูุณุฎูู tiled ุจุง shared memory
ณ) ูุณุฎูู tiled ุจุง register tiling
ด) ูุณุฎูู ุงุณุชูุงุฏูโฺฉููุฏู ุงุฒ warp shuffles

### ูุฏู:

* ูุดุงูุฏูู ุงูุฒุงุด performance ุงุฒ 1x โ 4x โ 10x โ 20x
* ุฏุฑฺฉ ุงููุช tiling ู reuse

---

# ฑท.ถ. ุชูุฑู ถ โ Histogram ุจููู (shared + atomic + grid-level reduce)

### ูุฏู:

* ฺฉุงูุด ุชุฑุงูฺฉ atomic
* ุงุณุชูุงุฏู ุงุฒ block-level aggregate
* merge ฺฉุฑุฏู histogramูุง block ุฏุฑ kernel ุฏฺฏุฑ

---

# ฑท.ท. ุชูุฑู ท โ Scan (Prefix Sum) ุจุง ุฏู ุฑูุด

ฑ) shared memory
ฒ) warp-level ููุท ุจุง __shfl_up_sync

### ูุฏู:

* ุงุฏฺฏุฑ ุงูฺฏูุฑุชูโูุง ููุงุฒ ฺฉูุงุณฺฉ
* ููุงุณูู performance ู latency

---

# ฑท.ธ. ุชูุฑู ธ โ Occupancy Tuning

ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑ NVIDIA Nsight Compute:

ฑ) ฺฉ kernel ุงูุชุฎุงุจ ฺฉูุฏ
ฒ) block size ุฑุง ุงุฒ 64 ุชุง 1024 ุชุบุฑ ุฏูุฏ
ณ) ุซุจุช ฺฉูุฏ:

* occupancy
* register usage
* shared memory usage
* achieved bandwidth
* achieved occupancy

### ูุฏู:

* ุงุฏฺฏุฑ ุชุนุงุฏู occupancy ู performance
* ุดูุงุฎุช register pressure

---

# ฑท.น. ุชูุฑู น โ ูุทุงูุนูู Memory Access Patterns

ุงูฺฏููุง ุฒุฑ ุฑุง ุงูุชุญุงู ฺฉูุฏ:

* Structure of Arrays
* Array of Structures
* Matrix row-major vs column-major
* Strided access
* Gather pattern
* Scatter pattern

### ูุฏู:

* ูุดุงูุฏูู ุชูุงูุช performance ุฏุฑ GPU
* ุฏุฑฺฉ ุนุฏู ุชูุงุณุจ GPU ุจุง ุจุนุถ ุงูฺฏููุง

---

# ฑท.ฑฐ. ุชูุฑู ฑฐ โ ุชุญูู Shared Memory Banking

ฑ) ุฏู kernel ุจููุณุฏ:

* ฺฉ bank conflict ุงุฌุงุฏ ฺฉูุฏ
* ุฏฺฏุฑ conflict-free ุจุงุดุฏ

ฒ) ุฒูุงู ุงุฌุฑุง ุขูโูุง ุฑุง ููุงุณู ฺฉูุฏ.

### ูุฏู:

* ููู ุนูู banking
* ูุดุงูุฏู ุงูฺฉู ฺฺฏููู performance 10x ุชุบุฑ ูโฺฉูุฏ

---

# ูุตู ฑธ โ ุงุดุชุจุงูุงุช ุฑุงุฌ ุจุฑูุงููโููุณุงู CUDA ู ูุญููู ุฌููฺฏุฑ ุงุฒ ุขูโูุง

ุฏุฑ ุงู ูุตูุ **ุฎุทุฑูุงฺฉโุชุฑู ู ุฑุงุฌโุชุฑู ุงุดุชุจุงูโูุง ุฏุงูุดุฌูุงู ู ูููุฏุณุงู CUDA** ุฑุง ูุนุฑู ูโฺฉูู.

---

# ฑธ.ฑ. ุงุดุชุจุงู ฑ โ Block Size ุงุดุชุจุงู

ูุซุงูโูุง ุจุฏ:

* blockDim = 30 (ุบุฑ ูุถุฑุจ 32)
* blockDim = 1024 ุจุฏูู ุจุฑุฑุณ register pressure
* blockDim ุฎู ฺฉูฺฺฉ ูุซู 16
* blockDim ุฎู ุจุฒุฑฺฏ ูุซู 2048

### ุฑุงูโุญู:

* ููุดู block size ุฑุง ุจู 128โ512 ู ูุถุฑุจ 32 ุงูุชุฎุงุจ ฺฉูุฏ.

---

# ฑธ.ฒ. ุงุดุชุจุงู ฒ โ ููุดุชู ฺฉุฏ warp-divergent

```cuda
if (threadIdx.x % 2 == 0) ...
```

ุงู ููุฌุฑ ุจู:

* ูุตู warp mask
* ุงุฌุฑุง branchูุง ูุฎุชูู
* ฺฉุงูุด throughput
* ุฏุฑ ููุงุฑุฏ ูพฺุฏู: 3x ุชุง 20x ฺฉูุฏ

### ุฑุงูโุญู:

* ุงฺฏุฑ ุดุฑุท ูโุชูุงูุฏ warp-uniform ุจุงุดุฏุ ุญุชูุงู warp-uniform ุทุฑุงุญ ฺฉูุฏ.
* warp-level coding (ูุซูุงู ballot) ุฑุง ุจูุฏ ุจุงุดุฏ.

---

# ฑธ.ณ. ุงุดุชุจุงู ณ โ ุนุฏู ุงุณุชูุงุฏู ุงุฒ Shared Memory ููุช ูุงุฒู ุงุณุช

Naรฏve convolution:

* 3 load per thread
* ุฏุฑ 128-thread warp: 384 load

Shared-memory convolution:

* ฺฉู warp โ 130 load

### ุฑุงูโุญู:

* ููุดู tiling ุฑุง ุจุฑุฑุณ ฺฉูุฏ
* ุงฺฏุฑ reuse ูุฌูุฏ ุฏุงุฑุฏุ shared memory ุถุฑูุฑ ุงุณุช.

---

# ฑธ.ด. ุงุดุชุจุงู ด โ bank conflict ุฏุงุฏู

ุฏุณุชุฑุณ:

```cuda
shared[i * 32]
```

ุฏุฑ warp 32 thread ููู ุจู ุจุงูฺฉ ฺฉุณุงู ูโุฑููุฏ.

### ูุชุฌู:

* 32x ฺฉูุฏ

### ุฑุงูโุญู:

* padding ุงุถุงูู ฺฉูุฏ
* tile[ty][tx] ุฑุง invert ฺฉูุฏ
* ุง stride ุฑุง ุชุบุฑ ุฏูุฏ.

---

# ฑธ.ต. ุงุดุชุจุงู ต โ atomic ุจุด ุงุฒ ุญุฏ ุงุณุชูุงุฏูโฺฉุฑุฏู

ูุซุงู ุจุฏ:

```cuda
atomicAdd(&hist[data[i]], 1);
```

ุงฺฏุฑ ุฏุงุฏูโูุง uniform ูุจุงุดูุฏ โ hotspot

### ุฑุงูโุญูโูุง:

* block-level histogram
* shared memory + atomic merge
* warp-level prefix sum

---

# ฑธ.ถ. ุงุดุชุจุงู ถ โ ุชุงุจุน ุฏุณุชฺฏุงู ุณูฺฏู ุฏุงุฎู kernel

ูุซู:

* malloc
* printf
* recursion
* ุงุณุชุฏุนุง ุชุงุจุน ุบุฑ-inline

### ุฑุงูโุญู:

* ููุดู device function ุฑุง inline ฺฉูุฏ
* recursion ููููุน
* malloc (ุจูโุฌุฒ cudaMallocManaged) ุฏุฑ kernel ููููุน

---

# ฑธ.ท. ุงุดุชุจุงู ท โ ุงุณุชูุงุฏูู ุจุฏ ุงุฒ Global Memory

ุงฺฏุฑ ุจุฑูุงููโุง global memory intensive ุจุงุดุฏุ GPU ุจูโุดุฏุช ฺฉูุฏ ูโุดูุฏ.

### ุฑุงูโุญู:

* coalesced access
* ุงุณุชูุงุฏู ุงุฒ shared memory
* ุงุณุชูุงุฏู ุงุฒ register tiling
* ุงุณุชูุงุฏู ุงุฒ warp shuffle

---

# ฑธ.ธ. ุงุดุชุจุงู ธ โ ูุงุฏุฏูโฺฏุฑูุชู occupancy

kernelูุง ฺฉู:

* register ุฒุงุฏ ูุตุฑู ูโฺฉููุฏ
* shared ุฒุงุฏ ูุตุฑู ูโฺฉููุฏ
* block size ูุงุฏุฑุณุช ุฏุงุฑูุฏ

ุงุบูุจ occupancy ุจุณุงุฑ ูพุงู ุฏุงุฑูุฏ.

### ุฑุงูโุญู:

* Nsight Compute
* occupancy calculator
* launch bounds

---

# ฑธ.น. ุงุดุชุจุงู น โ ุนุฏู ุชูุฌู ุจู SM scheduling

ุฏุงูุดุฌูุงู ูฺฉุฑ ูโฺฉููุฏ ุงุฌุฑุง blockูุง sequential ุงุณุช.
ุฏุฑุญุงูโฺฉู GPU ูุฑ block ุฑุง **ูุณุชูู** ุงุฌุฑุง ูโฺฉูุฏ.

ุงุณุชูุงุฏู ุงุฒ global sync ุจู blockูุง ููุดู ุงุดุชุจุงู ุงุณุช.

---

# ฑธ.ฑฐ. ุงุดุชุจุงู ฑฐ โ ุงุดุชุจุงู ฺฏุฑูุชู shared memory ุจุง cache

shared memory:

* ูุงุจู ุจุฑูุงููโุฑุฒ ุงุณุช
* ูุงุฒ ุจู ูุงูโูุง sync ุฏุงุฑุฏ
* ุธุฑูุช ูุญุฏูุฏ ุฏุงุฑุฏ

cache:

* ุฎูุฏฺฉุงุฑ ุงุณุช
* ุงูฺฏููุง ุฎุงุต ุฑุง ุจูุชุฑ ูโฺฉูุฏ

ูุจุงุฏ shared memory ุฑุง cache ูุฑุถ ฺฉุฑุฏ.

---

# ูุตู ฑน โ ุงุจุฒุงุฑูุง ูพุฑููุงููฺฏ GPU ู ุงูุฏุงุฒูโฺฏุฑ Performance

ุจุฏูู ูพุฑููุงููฺฏุ ูฺโฺฉุณ ููโุชูุงูุฏ kernel CUDA ุญุฑููโุง ุจููุณุฏ.

ุฏุฑ ุงู ูุตูุ ุงุจุฒุงุฑูุง NVIDIA ุฑุง ูุนุฑู ูโฺฉูู.

---

# ฑน.ฑ. ุงุจุฒุงุฑ NVIDIA Nsight Compute

ุงู ุงุจุฒุงุฑ ุงุตู ุจุฑุง ุชุญูู performance kernel ุงุณุช.

ููุงุฑุฏ ฺฉู ูุดุงู ูโุฏูุฏ:

* occupancy
* memory throughput
* global load efficiency
* shared memory efficiency
* warp stall reasons (memory, execution, sync)
* branch efficiency
* warp divergence
* DRAM throughput
* L2 throughput
* instruction mix
* achieved FLOP
* achieved bandwidth

### ุจุณุงุฑ ููู:

Nsight Compute ุฏููุงู ูุดุงู ูโุฏูุฏ kernel ุดูุง **ฺุฑุง** ฺฉูุฏ ุงุณุช:

* memory-bound
* compute-bound
* latency-bound
* control diverge
* register pressure
* shared memory pressure

---

# ฑน.ฒ. ุงุจุฒุงุฑ NVIDIA Nsight Systems

ุจุฑุง ุชุญูู ุฑูุชุงุฑ ฺฉู ุจุฑูุงูู:

* ุฒูุงู ุงุฌุฑุง
* ุฌุฑุงู ุฏุงุฏู HostโDevice
* concurrency
* stream ุงุณุชูุงุฏู
* overlapping kernel execution
* memory transfer overlap

ุจุฑุง ุจุฑูุงููโูุง ุทููุงู ู pipeline-based ุจุณุงุฑ ููู ุงุณุช.

---

# ฑน.ณ. nvprof (ุงุจุฒุงุฑ ูุฏูโุชุฑ)

ฺฏุฒููโูุง ููุฏ:

```
nvprof --analysis-metrics ...
nvprof --print-gpu-trace
```

ููุงุด:

* ุฒูุงู kernel
* ูุชุฑฺฉโูุง ุญุงูุธู
* occupancy
* performance counters

---

# ฑน.ด. NVTX ุจุฑุง ุนูุงูุชโฺฏุฐุงุฑ

ุฏุฑ ุจุฑูุงููโูุง real-world:

```cpp
nvtxRangePush("mykernel");
kernel<<<...>>>();
nvtxRangePop();
```

ุฏุฑ Nsight Systems ุงู ููุงุฑุฏ ููุงุด ุฏุงุฏู ูโุดูุฏ.

---

# ฑน.ต. ุฑูุด ุงุตูู ูพุฑููุงููฺฏ

ฑ. kernel ุฑุง ุงุฌุฑุง ฺฉูุฏ
ฒ. Nsight Compute ุจุงุฒ ฺฉูุฏ
ณ. ุจุฑุฑุณ ฺฉูุฏ:

* Memory Bound?
* Compute Bound?
* Occupancyุ
* Register Pressureุ
* Shared Pressureุ
* Warp stalls ฺุฑุงุ
* Cache behavior ฺุณุชุ

ด. ูุดฺฉู ุฑุง ุฏูู ุชุดุฎุต ุฏูุฏ
ต. ูุณุฎูู ุฌุฏุฏ kernel ุจููุณุฏ
ถ. ุฏูุจุงุฑู ูพุฑููุงู ฺฉูุฏ

ุงู ฺุฑุฎู โ ุงุณุงุณ GPU optimization ุงุณุช.

---

# ฑน.ถ. ุชุญูู Warp Stall Reasons (ูููโุงูุนุงุฏู ููู)

Nsight Compute ฺฉ ุงุฒ ููุฏุชุฑู ฺฏุฒุงุฑุดโูุง ุฑุง ุงุฑุงุฆู ูโุฏูุฏ:

**Warp Stall Breakdown**

* Stall: Memory Dependency
* Stall: Execution Dependency
* Stall: Synchronization
* Stall: Instruction Fetch
* Stall: Selected but NULL
* Stall: Other

ุงฺฏุฑ:

* Memory Dependency ุจุงูุง ุจุงุดุฏ โ coalescing ูุดฺฉู ุฏุงุฑุฏ
* Execution Dependency ุจุงูุง ุจุงุดุฏ โ ILP ฺฉู ุงุณุช
* Sync stall ุจุงูุง ุจุงุดุฏ โ shared memory ู sync ุฒุงุฏ ูุณุชูุฏ
* Selected but NULL ุจุงูุง ุจุงุดุฏ โ occupancy ูพุงู ุงุณุช
* Other ุจุงูุง ุจุงุดุฏ โ divergence ุณูฺฏู

---

# ฑน.ท. ฺฺฉโูุณุช ูพุฑููุงููฺฏ (ุจูุชุฑ ุงุฒ ูุฑ ฺฉุชุงุจ)

ฑ. global memory coalescedุ
ฒ. shared memory bank conflict ุฏุงุฑุฏุ
ณ. occupancy ููุงุณุจ ุงุณุชุ
ด. register spill ูุฌูุฏ ุฏุงุฑุฏุ
ต. warp divergence ุฒุงุฏ ุงุณุชุ
ถ. instruction mix ูุชุนุงุฏู ุงุณุชุ
ท. memory-bound ุง compute-boundุ
8. atomic hotspot ุฏุงุฑุฏุ
9. loop unrolling ูุงุฒู ุงุณุชุ
10. ILP (instruction level parallelism) ฺฉุงู ุงุณุชุ

---

# ฑน.ธ. ุฌูุนโุจูุฏ ูุตู ฑน

* ูพุฑููุงููฺฏ ูููโุชุฑู ููุงุฑุช CUDA ุงุณุช
* Nsight Compute ุงุตูโุชุฑู ุงุจุฒุงุฑ ุงุณุช
* ุจุงุฏ warp stalls ุฑุง ุชุญูู ฺฉุฑุฏ
* occupancy ุจุงุฏ ฺฉูุชุฑู ู ุจููู ุดูุฏ
* register ู shared memory pressure ฺฉูุชุฑู ุดูุฏ
* coalescingุ shared memoryุ warp-level programming ุงูููุช ุฏุงุฑูุฏ

---

```
```

---

# ```markdown

# ูุตู ฒฐ โ ุฌูุนโุจูุฏ ููุง: ูุนูุงุฑ ฺูุฏโูุณุชูโุงุ ุญุงูุธูุ GPU ู CUDA ุงุฒ ุตูุฑ ุชุง ุณุทุญ ุญุฑููโุง

ุจุนุฏ ุงุฒ ฑน ูุตูุ ุฒูุงู ุขู ุฑุณุฏู ฺฉู ฺฉู ููุงูู ุฑุง **ุฏุฑ ฺฉ ุชุตูุฑ ูุงุญุฏ** ุจุจูู โ
ููุงู ุชุตูุฑ ฺฉู ูููุฏุณุงู NVIDIAุ AMDุ Intel ู ูุญููุงู ุฏุงูุดฺฏุงูโูุง ุจุฑุชุฑ ุฏูุง ุจุง ุขู ูฺฉุฑ ูโฺฉููุฏ.

ุงู ูุตู ยซููุธุฑู ฺฉูยป ุง **The Big Picture** ุฑุง ุงุฑุงุฆู ูโฺฉูุฏ.

---

# ฒฐ.ฑ. ุงุฒ Latency ู Bandwidth ุขุบุงุฒ ฺฉุฑุฏู

ุฏุฑ ูุตูโูุง ฑ ุชุง ด ุฏุฏู:

* ุณุณุชูโูุง ูพุฑุฏุงุฒุด ููุดู ุจู **Latency** ู **Bandwidth** ูุญุฏูุฏ ูโุดููุฏ.
* ุณุฑุนุช ูพุฑุฏุงุฒูุฏูโูุง ุจุณุงุฑ ุฒุงุฏ ุงุณุชุ ุงูุง ุญุงูุธู ฺฉูุฏ ุงุณุช.
* ุงฺฏุฑ ุฏุงุฏู ุจูโูููุน ูุฑุณุฏุ ALU ุจฺฉุงุฑ ูโูุงูุฏ โ **Stall**
* CPU ู GPU ุจุฑุง ููุงุจูู ุจุง ุงู ูุญุฏูุฏุช ูุณุฑูุง ูุชูุงูุช ุฑุง ุงูุชุฎุงุจ ฺฉุฑุฏูุฏ:

### CPU

* ฺฉุงูุด latency
* ุงูุฒุงุด cache
* ูพุดโุจู ุงูุดุนุงุจ
* pipeline ุนูู
* ูพฺุฏฺฏ ุฒุงุฏ

### GPU

* **ุจโุฎุงู ูุณุจุช ุจู latency**
* ุงูุฒุงุด ูุญุดุชูุงฺฉ parallelism
* ูพููุงูโุณุงุฒ latency ุจุง warp switching
* ูพููุงโุจุงูุฏ ฺฏุณุชุฑุฏู
* ุญุงูุธูู shared ูุงุจู ุจุฑูุงููโุฑุฒ

ุงู ุฏู ุฑูฺฉุฑุฏุ ูุนูุงุฑ CPU ู GPU ุฑุง **ุฑุดูโุง ูุชูุงูุช** ฺฉุฑุฏู ุงุณุช.

---

# ฒฐ.ฒ. ูููุฏู ูุนูุงุฑ CPU ู GPU ุฏู ููุณููู ุฌุฏุง ูุณุชูุฏ

| ูฺฺฏ             | CPU           | GPU                       |
| ----------------- | ------------- | ------------------------- |
| ูุฏู               | latency ฺฉู    | throughput ุฒุงุฏ           |
| cache             | ุฎู ุฒุงุฏ     | ฺฉูุ ุงูุง shared memory     |
| branch            | ูู           | ุถุนูุ divergence ุฎุทุฑูุงฺฉ   |
| thread ุณุฎุชโุงูุฒุงุฑ | ฺฉู            | ุจุณุงุฑ ุฒุงุฏ                |
| memory bandwidth  | ูุญุฏูุฏ         | ูููโุงูุนุงุฏู ุฒุงุฏ           |
| ููุงุณุจ ุจุฑุง        | ฺฉุงุฑูุง ูพฺุฏู | ฺฉุงุฑูุง massively parallel |

ูุฑฺฉุฏุงู ุจุฑุง ูุฏู ูุชูุงูุช ุณุงุฎุชู ุดุฏูโุงูุฏ.

---

# ฒฐ.ณ. ูููุฏู ฺุฑุง ุจุฑูุงููโููุณ ุฏุงุฏูโููุงุฒ (SPMD) ุงููุช ุฏุงุฑุฏ

ูุฑ ุฏู ูุฏู ISPC ู CUDA ุจุฑ ูพุงูู SPMD ูุณุชูุฏ:

* ฺฉ ุจุฑูุงูู โ ูุฒุงุฑุงู ูุณุฎู ุฑู ุฏุงุฏูู ูุฎุชูู
* ISPC: ุงุฌุฑุง SPMD ุฑู SIMD ุฏุฑ CPU
* CUDA: ุงุฌุฑุง SPMD ุฑู SIMT ุฏุฑ GPU

SPMD ุณุงุฏูโุชุฑู ู ูุฏุฑุชููุฏุชุฑู ูุฏู ุจุฑุง:

* ฺฏุฑุงูฺฉ
* ูพุฑุฏุงุฒุด ุชุตูุฑ
* ุงุฏฺฏุฑ ุนูู
* ุนูู ูุญุงุณุจุงุช
* ูพุฑุฏุงุฒุด ูุงุชุฑุณ

ุงุณุช.

---

# ฒฐ.ด. ISPC ูพู ุจูุฏ ูุงู CPU ู GPU

ISPC ุจู ูุง ุงุฏ ุฏุงุฏ:

* ุจุฑูุงููโููุณ SPMD ฺฺฏููู ุฑู CPU ุงุฌุฑุง ูโุดูุฏ
* SIMD ฺฺฏููู ุฏุฑ ูุงูุจ ุณุงุฏูโุดุฏู ุจุงู ูโุดูุฏ
* ููุงูู maskุ programIndexุ gang
* reduce_add ู ุนููุงุช cross-instance

ุงูุง ISPC ูุญุฏูุฏ ุงุณุช:

* parallelism ฺฉู (ฺูุฏ ุฏู instance)
* ูพููุงโุจุงูุฏ ฺฉู
* latency ุฒุงุฏ
* register file ฺฉูฺฺฉ

ุฏุฑูุชุฌู ุจุฑุง ุจุณุงุฑ ุงุฒ workloadูุง **GPU ููุงุณุจโุชุฑ** ุงุณุช.

---

# ฒฐ.ต. CUDA ุฏูุง GPGPU ุฑุง ุดฺฉู ุฏุงุฏ

ุฏุฑ ูุตู ถ ูููุฏู:

* GPUูุง ุงููู ููุท shader ุงุฌุฑุง ูโฺฉุฑุฏูุฏ
* Brook ุงููู ูุฏู stream programming ุจูุฏ
* CUDA (2007) ุงูููุงุจ ูุงูุน ุจูุฏ:

CUDA ุงุฑุงุฆู ฺฉุฑุฏ:

* kernel
* thread / block / grid
* shared memory
* warp execution
* atomic ops
* stream scheduling
* ุญุงูุธูู global ุจุง ูพููุงโุจุงูุฏ ุจุงูุง
* ุงุจุฒุงุฑูุง ูพุฑููุงููฺฏ

ู ุงู GPU ุฑุง ุจู ฺฉ **ุงุจุฑุฑุงุงููู ุฏุงุฏูโููุงุฒ** ุชุจุฏู ฺฉุฑุฏ.

---

# ฒฐ.ถ. ูุนูุงุฑโ GPU ุฑุง ูุงูโุจูโูุงู ุฏุฏู

ูุตู ท ฺฉุงููุงู ุณุงุฎุชุงุฑ GPU ุฑุง ุชุดุฑุญ ฺฉุฑุฏ:

* GPU ุงุฒ ฺูุฏู SM ุชุดฺฉู ุดุฏู ุงุณุช
* ูุฑ SM ฺูุฏู warp scheduler ุฏุงุฑุฏ
* warp ููุดู ณฒ thread ุงุณุช
* registers ุจุณุงุฑ ุฒุงุฏูุฏ
* shared memory ุฏุฑูู SM ูุฑุงุฑ ุฏุงุฑุฏ
* DRAM ุจุฒุฑฺฏ ุงูุง ฺฉูุฏ

ุงู ุณุงุฎุชุงุฑ:

> ยซูุฒุงุฑุงู thread ุฏุฑ ุงูุชุธุงุฑ ุญุงูุธู โ warp switching โ ALU ููุดู ูุดุบููยป

ุฑุง ุงูฺฉุงูโูพุฐุฑ ูโฺฉูุฏ.

---

# ฒฐ.ท. ุงุตูู ุทูุง performance ุฑุง ุงุฏ ฺฏุฑูุชู

ุฏุฑ ูุตู นโฑฐ:

### ฑ) ุฏุณุชุฑุณ ููโุชุฑุงุฒ (coalescing)

ุงุฒ ณฒ load โ ฑ load ุชุจุฏู ูโุดูุฏ

### ฒ) shared memory

ุฏุงุฏู ุฑุง ฺฉโุจุงุฑ ูโุฎูุงูุ ฺูุฏ ุจุงุฑ ุงุณุชูุงุฏู ูโฺฉู

### ณ) warp-level programming

ุงุฑุชุจุงุท ุฑุฌุณุชุฑ ุจู ุฑุฌุณุชุฑ ุณุฑุน โ ุจุฏูู sync

### ด) occupancy

ูุฑ SM ุจุงุฏ warp ฺฉุงู ุฏุงุดุชู ุจุงุดุฏ

### ต) register pressure

ูุตุฑู ุฒุงุฏ โ occupancy ฺฉู โ performance ฺฉู

### ถ) shared memory pressure

block ุฒุงุฏ ุงุณุชูุงุฏู ฺฉูุฏ โ SM ููุท ฺฉ block ูโฺฏุฑุฏ

### ท) warp divergence

ุดุงุฎูโูุง ูุฎุชูู โ warp ุฏู ุจุฑุงุจุฑ ฺฉูุฏ ูโุดูุฏ

### ธ) atomicูุง ุฒุงุฏ

serialization โ ฺฉูุฏ ุดุฏุฏ

### น) memory reuse

ูููโุชุฑู ุงุตู ุจูููโุณุงุฒ

### ฑฐ) timeโmemory tradeoff

GPU ุงุฑุฒุงู ูุญุงุณุจู ูโฺฉูุฏุ ฺฏุฑุงู load ูโฺฉูุฏ

---

# ฒฐ.ธ. ุจุง ูุซุงูโูุง ูุงูุน CUDA ูุฏุฑุช GPU ุฑุง ุชุฌุฑุจู ฺฉุฑุฏู

ุฏุฑ ูุตู ฑถ:

* reduction ูพุดุฑูุชู
* convolution ุจุง shared memory
* matrix multiplication ุจุง tiling
* histogram atomic + shared
* scan ุจุง warp shuffle

ุงูโูุง ุงูฺฏูุฑุชูโูุง ูุณุชูุฏ ฺฉู ูููู HPC ู ML ู graphics ุงุณุชูุงุฏู ูโฺฉููุฏ.

---

# ฒฐ.น. ุงุฏ ฺฏุฑูุชู ฺฺฏููู kernelูุง ุฑุง ูพุฑููุงู ฺฉูู

ูุตู ฑน ุงุจุฒุงุฑูุง ฺฉูุฏ ุฑุง ุขููุฒุด ุฏุงุฏ:

* Nsight Compute
* Nsight Systems
* nvprof

ู ููุงุฑุฏ ูุซู:

* warp stall reasons
* achieved occupancy
* achieved bandwidth
* coalescing efficiency
* shared memory transactions
* branch efficiency
* atomic throughput

ฺฉู ุจุฑุง ุจูููโุณุงุฒ ุถุฑูุฑโุงูุฏ.

---

# ฒฐ.ฑฐ. ุชุตูุฑ ููุง (The Big Picture)

GPU ุฑุง ุจุงุฏ ุงูฺฏููู ุฏุฏ:

> ยซฺฉ ุฏุณุชูู ุจุฒุฑฺฏ ุงุฒ ูุงุญุฏูุง ุณุงุฏูู ูุญุงุณุจุงุช ฺฉู ุจุง latencies ุฒุงุฏ ููุงุฌูโุงูุฏุ
> ุงูุง ุจุง ุฏุงุดุชู warpูุง ุฒุงุฏุ ุขูโูุฏุฑ latency ุฑุง ูพููุงู ูโฺฉููุฏ ฺฉู
> throughput ููุง ุจุณุงุฑ ุจุงูุง ูโุดูุฏ.ยป

CPU ุฑุง ุจุงุฏ ุงูฺฏููู ุฏุฏ:

> ยซฺฉ ูุงุญุฏ ุจุณุงุฑ ูพฺุฏูุ ุจุง latency ูพุงูุ ูุฏุฑุช ุฒุงุฏ ุฏุฑ branch ู controlุ
> ุงูุง parallelism ูุญุฏูุฏ.ยป

ู ISPC ุฑุง ุจุงุฏ ุงูฺฏููู ุฏุฏ:

> ยซุฑุงู ุจุฑุง ููุดุชู ุงูฺฏูุฑุชูโูุง ุฏุงุฏูโููุงุฒ ุฑู CPU ุจู ุณุจฺฉ GPU.ยป

---

# ฒฐ.ฑฑ. ุดูุง ุงฺฉููู ฺู ููุงุฑุช ุฏุงุฑุฏุ

ุงฺฏุฑ ฺฉู ุฌุฒูู ุฑุง ูุทุงูุนู ฺฉุฑุฏูโุงุฏุ ุดูุง ุงฺฉููู:

* ุชูุงูุช latency vs bandwidth ุฑุง ูโูููุฏ
* pipeline ู memory hierarchy ุฑุง ูโุดูุงุณุฏ
* ISPC ู SIMD ุฑุง ุฏุฑฺฉ ฺฉุฑุฏูโุงุฏ
* GPU ู SM ู warp ุฑุง ฺฉุงููุงู ูโุดูุงุณุฏ
* thread/block/grid ุฑุง ุชุญูู ูโฺฉูุฏ
* coalescing ุฑุง ุฑุนุงุช ูโฺฉูุฏ
* shared memory tile ุฑุง ุทุฑุงุญ ูโฺฉูุฏ
* warp shuffle ุฑุง ุจู ฺฉุงุฑ ูโฺฏุฑุฏ
* occupancy ู register pressure ุฑุง ฺฉูุชุฑู ูโฺฉูุฏ
* ุจุง ูพุฑููุงูุฑูุง NVIDIA ฺฉุงุฑ ูโฺฉูุฏ
* ูโุชูุงูุฏ kernel ฺฉุงูู ุจููุณุฏ
* ูโุชูุงูุฏ ฺฉุฏุชุงู ุฑุง 10x ุณุฑุนโุชุฑ ฺฉูุฏ
* ูโุชูุงูุฏ ุฑูุชุงุฑ GPU ุฑุง ูุฏู ุฐูู ฺฉูุฏ

ุงู ุฏููุงู ูุนุงุฏู ุณุฑูุตู ุฏุฑุณ ยซCUDA Programming & GPU Architectureยป ุฏุฑ ุฏุงูุดฺฏุงูโูุง ุฑุฏู ฑ ุงุณุช.

---

# ฒฐ.ฑฒ. ูพุดููุงุฏ ูุณุฑ ุงุฏุงูู ุจุฑุง ุดูุง

ุงฺฏุฑ ุจุฎูุงูุฏ ุฏุฑ GPU Programming ุญุฑููโุงโุชุฑ ุดูุฏ:

### ุชูุตูโูุง ุขฺฉุงุฏูฺฉ:

* ูุทุงูุนูู ฺฉุชุงุจ *Programming Massively Parallel Processors*
* ูุทุงูุนูู *CUDA Handbook*
* ฺฏุฑูุชู ุฏูุฑูโูุง CS179 (Stanford)ุ 15-418 (CMU)

### ุชูุตูโูุง ุนูู:

* ุณุงุฎุช mini-project ุจุง CUDA
* ูพุงุฏูโุณุงุฒ CNN layerูุง
* matrix multiply high-performance
* ุงุฏฺฏุฑ CUDA graphs
* ุงุฏฺฏุฑ Tensor Core programming

### ูุณุฑ ุตูุนุช:

* ุงุฏฺฏุฑ PyTorch CUDA_extensions
* ุทุฑุงุญ kernelูุง custom ุจุฑุง ML
* ุงุฏฺฏุฑ Triton (ุฒุจุงู OpenAI ุจุฑุง GPU programming)
* ุงุฏฺฏุฑ HIP ู SYCL ุจุฑุง portability

---

# ฒฐ.ฑณ. ูพุงุงู: ฺฉ ุฌูููู ฺฉูุฏ

> GPU ุจุฑุง latency ุณุงุฎุชู ูุดุฏู ุงุณุชุ
> GPU ุจุฑุง throughput ุณุงุฎุชู ุดุฏู ุงุณุช.
>
> CUDA ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุงู throughput ุฑุง ุฏุฑ ุงุฎุชุงุฑ ุจฺฏุฑุฏ.

ุงู ุฌููู ุฑุงุฒ ุชูุงู ูุจุงุญุซ ุงู ฺฉุชุงุจ ุงุณุช.

---
